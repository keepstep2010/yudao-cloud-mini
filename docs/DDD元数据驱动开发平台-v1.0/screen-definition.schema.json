{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/ddd-metamodel/1.0/screen-definition.schema.json",
  "title": "屏幕定义Schema",
  "description": "前端屏幕、页面、组件的定义Schema - v1.0",
  "version": "1.0.0",
  "type": "object",
  "properties": {
    "version": {
      "type": "string",
      "description": "Schema版本",
      "const": "1.0.0"
    },
    "boundedContextId": {
      "type": "string",
      "pattern": "^bc_[a-zA-Z0-9_]+$",
      "description": "所属限界上下文ID"
    },
    "screens": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/screen"
      },
      "description": "屏幕列表"
    },
    "endpointMappings": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/endpointMapping"
      },
      "description": "端点映射列表，关联屏幕与后端端点"
    },
    "dtoMappings": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/screenDtoMapping"
      },
      "description": "屏幕DTO映射列表"
    }
  },
  "required": ["version", "boundedContextId"],
  "additionalProperties": false,
  "$defs": {
    "screen": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^screen_[a-zA-Z0-9_]+$",
          "description": "屏幕唯一标识"
        },
        "name": {
          "type": "string",
          "description": "屏幕名称"
        },
        "description": {
          "type": "string",
          "description": "屏幕描述"
        },
        "type": {
          "type": "string",
          "enum": ["LIST", "DETAIL", "FORM", "DASHBOARD", "WIZARD", "MODAL"],
          "description": "屏幕类型"
        },
        "route": {
          "type": "string",
          "description": "路由路径"
        },
        "layout": {
          "type": "string",
          "enum": ["SINGLE_COLUMN", "TWO_COLUMN", "THREE_COLUMN", "SIDEBAR", "TABS"],
          "description": "布局类型"
        },
        "responsive": {
          "type": "boolean",
          "description": "是否响应式"
        },
        "pages": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/page"
          },
          "description": "页面列表"
        },
        "navigation": {
          "$ref": "#/$defs/navigation"
        },
        "permissions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "所需权限列表"
        }
      },
      "required": ["id", "name", "type", "route"],
      "additionalProperties": false
    },
    "page": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^page_[a-zA-Z0-9_]+$",
          "description": "页面唯一标识"
        },
        "name": {
          "type": "string",
          "description": "页面名称"
        },
        "description": {
          "type": "string",
          "description": "页面描述"
        },
        "components": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/component"
          },
          "description": "组件列表"
        },
        "actions": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/action"
          },
          "description": "页面操作列表"
        },
        "dataBindings": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/dataBinding"
          },
          "description": "数据绑定列表"
        }
      },
      "required": ["id", "name"],
      "additionalProperties": false
    },
    "component": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^comp_[a-zA-Z0-9_]+$",
          "description": "组件唯一标识"
        },
        "name": {
          "type": "string",
          "description": "组件名称"
        },
        "type": {
          "type": "string",
          "enum": ["FORM", "TABLE", "CHART", "BUTTON", "INPUT", "SELECT", "MODAL", "CARD", "NAVIGATION"],
          "description": "组件类型"
        },
        "description": {
          "type": "string",
          "description": "组件描述"
        },
        "position": {
          "$ref": "#/$defs/position"
        },
        "properties": {
          "type": "object",
          "description": "组件属性"
        },
        "events": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/event"
          },
          "description": "事件列表"
        },
        "validation": {
          "$ref": "#/$defs/validation"
        },
        "styling": {
          "$ref": "#/$defs/styling"
        }
      },
      "required": ["id", "name", "type"],
      "additionalProperties": false
    },
    "form": {
      "type": "object",
      "allOf": [
        {
          "$ref": "#/$defs/component"
        },
        {
          "type": "object",
          "properties": {
            "fields": {
              "type": "array",
              "items": {
                "$ref": "#/$defs/formField"
              },
              "description": "表单字段列表"
            },
            "submitAction": {
              "$ref": "#/$defs/action"
            },
            "resetAction": {
              "$ref": "#/$defs/action"
            },
            "validationRules": {
              "type": "array",
              "items": {
                "$ref": "#/$defs/validationRule"
              },
              "description": "验证规则列表"
            }
          },
          "required": ["fields", "submitAction"]
        }
      ]
    },
    "formField": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^field_[a-zA-Z0-9_]+$",
          "description": "字段唯一标识"
        },
        "name": {
          "type": "string",
          "description": "字段名称"
        },
        "label": {
          "type": "string",
          "description": "字段标签"
        },
        "type": {
          "type": "string",
          "enum": ["TEXT", "NUMBER", "EMAIL", "PASSWORD", "SELECT", "CHECKBOX", "RADIO", "TEXTAREA", "DATE", "FILE"],
          "description": "字段类型"
        },
        "required": {
          "type": "boolean",
          "description": "是否必填"
        },
        "defaultValue": {
          "description": "默认值"
        },
        "placeholder": {
          "type": "string",
          "description": "占位符文本"
        },
        "options": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/fieldOption"
          },
          "description": "选项列表（用于SELECT、RADIO、CHECKBOX）"
        },
        "validation": {
          "$ref": "#/$defs/fieldValidation"
        },
        "dtoMapping": {
          "$ref": "#/$defs/dtoFieldMapping"
        }
      },
      "required": ["id", "name", "type"],
      "additionalProperties": false
    },
    "dtoFieldMapping": {
      "type": "object",
      "properties": {
        "dtoId": {
          "type": "string",
          "pattern": "^dto_[a-zA-Z0-9_]+$",
          "description": "关联的DTO ID"
        },
        "attributeName": {
          "type": "string",
          "description": "DTO中的属性名"
        },
        "dataType": {
          "type": "string",
          "description": "数据类型"
        },
        "transformation": {
          "type": "string",
          "enum": ["DIRECT", "FORMAT", "TRANSFORM", "CUSTOM"],
          "description": "数据转换方式"
        },
        "customTransform": {
          "type": "string",
          "description": "自定义转换逻辑"
        }
      },
      "required": ["dtoId", "attributeName"],
      "additionalProperties": false
    },
    "action": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^action_[a-zA-Z0-9_]+$",
          "description": "操作唯一标识"
        },
        "name": {
          "type": "string",
          "description": "操作名称"
        },
        "type": {
          "type": "string",
          "enum": ["SUBMIT", "RESET", "NAVIGATE", "OPEN_MODAL", "CLOSE_MODAL", "REFRESH", "DELETE", "CUSTOM"],
          "description": "操作类型"
        },
        "description": {
          "type": "string",
          "description": "操作描述"
        },
        "endpointMapping": {
          "$ref": "#/$defs/endpointMapping"
        },
        "confirmation": {
          "type": "boolean",
          "description": "是否需要确认"
        },
        "confirmationMessage": {
          "type": "string",
          "description": "确认消息"
        },
        "successMessage": {
          "type": "string",
          "description": "成功消息"
        },
        "errorMessage": {
          "type": "string",
          "description": "错误消息"
        },
        "loadingState": {
          "type": "boolean",
          "description": "是否显示加载状态"
        }
      },
      "required": ["id", "name", "type"],
      "additionalProperties": false
    },
    "endpointMapping": {
      "type": "object",
      "properties": {
        "endpointId": {
          "type": "string",
          "pattern": "^endpoint_[a-zA-Z0-9_]+$",
          "description": "端点ID"
        },
        "endpointName": {
          "type": "string",
          "description": "端点名称"
        },
        "httpMethod": {
          "type": "string",
          "enum": ["GET", "POST", "PUT", "DELETE", "PATCH"],
          "description": "HTTP方法"
        },
        "url": {
          "type": "string",
          "description": "端点URL"
        },
        "requestDto": {
          "type": ["string", "null"],
          "pattern": "^dto_[a-zA-Z0-9_]+$",
          "description": "请求DTO ID"
        },
        "responseDto": {
          "type": ["string", "null"],
          "pattern": "^dto_[a-zA-Z0-9_]+$",
          "description": "响应DTO ID"
        },
        "headers": {
          "type": "object",
          "description": "请求头"
        },
        "timeout": {
          "type": "integer",
          "description": "超时时间（毫秒）"
        },
        "retry": {
          "type": "object",
          "properties": {
            "maxAttempts": {
              "type": "integer",
              "description": "最大重试次数"
            },
            "delay": {
              "type": "integer",
              "description": "重试延迟（毫秒）"
            }
          }
        }
      },
      "required": ["endpointId", "httpMethod", "url"],
      "additionalProperties": false
    },
    "dataBinding": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^binding_[a-zA-Z0-9_]+$",
          "description": "绑定唯一标识"
        },
        "source": {
          "type": "string",
          "enum": ["ENDPOINT", "LOCAL_STORAGE", "SESSION_STORAGE", "CONTEXT", "PROP"],
          "description": "数据源"
        },
        "sourceId": {
          "type": "string",
          "description": "数据源ID"
        },
        "target": {
          "type": "string",
          "description": "目标组件或字段"
        },
        "transformation": {
          "type": "string",
          "description": "数据转换逻辑"
        },
        "refreshOn": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "触发刷新的条件"
        }
      },
      "required": ["id", "source", "target"],
      "additionalProperties": false
    },
    "validation": {
      "type": "object",
      "properties": {
        "required": {
          "type": "boolean",
          "description": "是否必填"
        },
        "minLength": {
          "type": "integer",
          "description": "最小长度"
        },
        "maxLength": {
          "type": "integer",
          "description": "最大长度"
        },
        "pattern": {
          "type": "string",
          "description": "正则表达式模式"
        },
        "min": {
          "type": "number",
          "description": "最小值"
        },
        "max": {
          "type": "number",
          "description": "最大值"
        },
        "customRules": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "自定义验证规则"
        }
      },
      "additionalProperties": false
    },
    "fieldValidation": {
      "type": "object",
      "allOf": [
        {
          "$ref": "#/$defs/validation"
        },
        {
          "type": "object",
          "properties": {
            "asyncValidation": {
              "type": "boolean",
              "description": "是否异步验证"
            },
            "validationEndpoint": {
              "type": "string",
              "description": "异步验证端点"
            }
          }
        }
      ]
    },
    "validationRule": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^rule_[a-zA-Z0-9_]+$",
          "description": "规则唯一标识"
        },
        "type": {
          "type": "string",
          "enum": ["REQUIRED", "LENGTH", "PATTERN", "RANGE", "CUSTOM", "CROSS_FIELD"],
          "description": "规则类型"
        },
        "message": {
          "type": "string",
          "description": "验证失败消息"
        },
        "severity": {
          "type": "string",
          "enum": ["ERROR", "WARNING", "INFO"],
          "description": "严重程度"
        },
        "condition": {
          "type": "string",
          "description": "条件表达式"
        }
      },
      "required": ["id", "type", "message"],
      "additionalProperties": false
    },
    "position": {
      "type": "object",
      "properties": {
        "x": {
          "type": "integer",
          "description": "X坐标"
        },
        "y": {
          "type": "integer",
          "description": "Y坐标"
        },
        "width": {
          "type": "integer",
          "description": "宽度"
        },
        "height": {
          "type": "integer",
          "description": "高度"
        },
        "gridArea": {
          "type": "string",
          "description": "网格区域"
        },
        "zIndex": {
          "type": "integer",
          "description": "层级"
        }
      },
      "additionalProperties": false
    },
    "styling": {
      "type": "object",
      "properties": {
        "cssClass": {
          "type": "string",
          "description": "CSS类名"
        },
        "inlineStyle": {
          "type": "object",
          "description": "内联样式"
        },
        "theme": {
          "type": "string",
          "description": "主题"
        },
        "variant": {
          "type": "string",
          "description": "变体"
        },
        "size": {
          "type": "string",
          "enum": ["SMALL", "MEDIUM", "LARGE"],
          "description": "尺寸"
        }
      },
      "additionalProperties": false
    },
    "event": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^event_[a-zA-Z0-9_]+$",
          "description": "事件唯一标识"
        },
        "name": {
          "type": "string",
          "enum": ["CLICK", "CHANGE", "SUBMIT", "FOCUS", "BLUR", "KEYUP", "KEYDOWN", "MOUSEENTER", "MOUSELEAVE"],
          "description": "事件名称"
        },
        "handler": {
          "type": "string",
          "description": "事件处理器"
        },
        "preventDefault": {
          "type": "boolean",
          "description": "是否阻止默认行为"
        },
        "stopPropagation": {
          "type": "boolean",
          "description": "是否阻止事件冒泡"
        }
      },
      "required": ["id", "name"],
      "additionalProperties": false
    },
    "fieldOption": {
      "type": "object",
      "properties": {
        "value": {
          "description": "选项值"
        },
        "label": {
          "type": "string",
          "description": "选项标签"
        },
        "disabled": {
          "type": "boolean",
          "description": "是否禁用"
        },
        "icon": {
          "type": "string",
          "description": "图标"
        }
      },
      "required": ["value", "label"],
      "additionalProperties": false
    },
    "navigation": {
      "type": "object",
      "properties": {
        "breadcrumbs": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/breadcrumb"
          },
          "description": "面包屑导航"
        },
        "tabs": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/tab"
          },
          "description": "标签页导航"
        },
        "sidebar": {
          "$ref": "#/$defs/sidebar"
        }
      },
      "additionalProperties": false
    },
    "breadcrumb": {
      "type": "object",
      "properties": {
        "label": {
          "type": "string",
          "description": "标签文本"
        },
        "route": {
          "type": "string",
          "description": "路由路径"
        },
        "icon": {
          "type": "string",
          "description": "图标"
        }
      },
      "required": ["label"],
      "additionalProperties": false
    },
    "tab": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^tab_[a-zA-Z0-9_]+$",
          "description": "标签唯一标识"
        },
        "label": {
          "type": "string",
          "description": "标签文本"
        },
        "icon": {
          "type": "string",
          "description": "图标"
        },
        "disabled": {
          "type": "boolean",
          "description": "是否禁用"
        },
        "badge": {
          "type": "string",
          "description": "徽章内容"
        }
      },
      "required": ["id", "label"],
      "additionalProperties": false
    },
    "sidebar": {
      "type": "object",
      "properties": {
        "collapsible": {
          "type": "boolean",
          "description": "是否可折叠"
        },
        "defaultCollapsed": {
          "type": "boolean",
          "description": "默认是否折叠"
        },
        "items": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/sidebarItem"
          },
          "description": "侧边栏项目"
        }
      },
      "additionalProperties": false
    },
    "sidebarItem": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^sidebar_[a-zA-Z0-9_]+$",
          "description": "侧边栏项目唯一标识"
        },
        "label": {
          "type": "string",
          "description": "标签文本"
        },
        "icon": {
          "type": "string",
          "description": "图标"
        },
        "route": {
          "type": "string",
          "description": "路由路径"
        },
        "children": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/sidebarItem"
          },
          "description": "子项目"
        }
      },
      "required": ["id", "label"],
      "additionalProperties": false
    },
    "screenDtoMapping": {
      "type": "object",
      "properties": {
        "screenId": {
          "type": "string",
          "pattern": "^screen_[a-zA-Z0-9_]+$",
          "description": "屏幕ID"
        },
        "dtoId": {
          "type": "string",
          "pattern": "^dto_[a-zA-Z0-9_]+$",
          "description": "DTO ID"
        },
        "mappingType": {
          "type": "string",
          "enum": ["INPUT", "OUTPUT", "BOTH"],
          "description": "映射类型"
        },
        "fieldMappings": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/screenFieldMapping"
          },
          "description": "字段映射列表"
        },
        "transformation": {
          "type": "string",
          "description": "数据转换逻辑"
        }
      },
      "required": ["screenId", "dtoId", "mappingType"],
      "additionalProperties": false
    },
    "screenFieldMapping": {
      "type": "object",
      "properties": {
        "screenFieldId": {
          "type": "string",
          "pattern": "^field_[a-zA-Z0-9_]+$",
          "description": "屏幕字段ID"
        },
        "dtoAttributeName": {
          "type": "string",
          "description": "DTO属性名"
        },
        "dataType": {
          "type": "string",
          "description": "数据类型"
        },
        "required": {
          "type": "boolean",
          "description": "是否必填"
        },
        "defaultValue": {
          "description": "默认值"
        },
        "validation": {
          "$ref": "#/$defs/validation"
        }
      },
      "required": ["screenFieldId", "dtoAttributeName"],
      "additionalProperties": false
    }
  }
}
