{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/ddd-metamodel/2.0/api-definition/full/api-specification.schema.json",
  "title": "API规范完整定义",
  "description": "完整的API规范定义 - 包含所有端点、参数、响应等信息",
  "version": "2.0.0",
  "type": "object",
  "allOf": [
    {
      "$ref": "../fields/common-fields.schema.json"
    }
  ],
  "properties": {
    "openapi": {
      "type": "string",
      "pattern": "^3\\.[0-9]+\\.[0-9]+$",
      "description": "OpenAPI规范版本"
    },
    "info": {
      "type": "object",
      "allOf": [
        {
          "$ref": "../fields/common-fields.schema.json"
        }
      ],
      "properties": {
        "contact": {
          "type": "object",
          "properties": {
            "name": {"type": "string", "maxLength": 100},
            "url": {"type": "string", "format": "uri"},
            "email": {"type": "string", "format": "email"}
          }
        },
        "license": {
          "type": "object",
          "properties": {
            "name": {"type": "string", "maxLength": 100},
            "url": {"type": "string", "format": "uri"}
          },
          "required": ["name"]
        },
        "termsOfService": {
          "type": "string",
          "format": "uri"
        }
      },
      "required": ["title", "version"]
    },
    "servers": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "url": {"type": "string", "format": "uri"},
          "description": {"type": "string", "maxLength": 200},
          "variables": {
            "type": "object",
            "patternProperties": {
              "^[a-zA-Z][a-zA-Z0-9_]*$": {
                "type": "object",
                "properties": {
                  "enum": {"type": "array", "items": {"type": "string"}},
                  "default": {"type": "string"},
                  "description": {"type": "string", "maxLength": 200}
                },
                "required": ["default"]
              }
            }
          }
        },
        "required": ["url"]
      },
      "minItems": 1
    },
    "paths": {
      "type": "object",
      "patternProperties": {
        "^/": {
          "type": "object",
          "patternProperties": {
            "^(get|put|post|delete|options|head|patch|trace)$": {
              "type": "object",
              "allOf": [
                {"$ref": "../fields/endpoint-fields.schema.json"}
              ],
              "properties": {
                "parameters": {
                  "type": "array",
                  "items": {
                    "$ref": "../fields/parameter-fields.schema.json"
                  }
                },
                "requestBody": {
                  "type": "object",
                  "properties": {
                    "description": {"type": "string", "maxLength": 500},
                    "content": {
                      "type": "object",
                      "patternProperties": {
                        "^[a-zA-Z0-9][a-zA-Z0-9!#$&\\-\\^_]*\\/[a-zA-Z0-9][a-zA-Z0-9!#$&\\-\\^_.]*$": {
                          "type": "object",
                          "properties": {
                            "schema": {"type": "object"},
                            "examples": {"type": "object"}
                          }
                        }
                      }
                    },
                    "required": {"type": "boolean", "default": false}
                  }
                },
                "responses": {
                  "type": "object",
                  "patternProperties": {
                    "^([1-5][0-9]{2}|default)$": {
                      "allOf": [
                        {"$ref": "../fields/response-fields.schema.json"}
                      ],
                      "properties": {
                        "description": {"type": "string", "maxLength": 500},
                        "content": {
                          "type": "object",
                          "patternProperties": {
                            "^[a-zA-Z0-9][a-zA-Z0-9!#$&\\-\\^_]*\\/[a-zA-Z0-9][a-zA-Z0-9!#$&\\-\\^_.]*$": {
                              "type": "object",
                              "properties": {
                                "schema": {"type": "object"},
                                "examples": {"type": "object"}
                              }
                            }
                          }
                        }
                      },
                      "required": ["description"]
                    }
                  },
                  "minProperties": 1
                }
              },
              "required": ["responses"]
            }
          }
        }
      }
    },
    "components": {
      "type": "object",
      "properties": {
        "schemas": {"type": "object"},
        "responses": {"type": "object"},
        "parameters": {"type": "object"},
        "examples": {"type": "object"},
        "requestBodies": {"type": "object"},
        "headers": {"type": "object"},
        "securitySchemes": {"type": "object"},
        "links": {"type": "object"},
        "callbacks": {"type": "object"}
      }
    },
    "security": {
      "type": "array",
      "items": {
        "type": "object"
      }
    }
  },
  "required": ["openapi", "info", "paths"],
  "additionalProperties": false
}
