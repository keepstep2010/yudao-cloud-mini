<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDD平台 - 简易编辑器</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            height: 100vh;
        }

        .header {
            background: #fff;
            border-bottom: 1px solid #e8e8e8;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 18px;
            color: #333;
            font-weight: 600;
        }

        .header .actions {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 6px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            background: #fff;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn:hover {
            border-color: #40a9ff;
            color: #40a9ff;
        }

        .btn.primary {
            background: #1890ff;
            border-color: #1890ff;
            color: #fff;
        }

        .btn.primary:hover {
            background: #40a9ff;
        }

        .container {
            height: calc(100vh - 65px);
            display: flex;
        }

        .sidebar {
            width: 300px;
            background: #fff;
            border-right: 1px solid #e8e8e8;
            padding: 20px;
            overflow-y: auto;
        }

        .content {
            flex: 1;
            background: #fff;
            padding: 20px;
            overflow-y: auto;
            position: relative;
        }

        .property-panel {
            width: 280px;
            background: #fff;
            border-left: 1px solid #e8e8e8;
            padding: 20px;
            overflow-y: auto;
            display: none;
        }

        .property-panel.active {
            display: block;
        }

        .component-item {
            padding: 8px 12px;
            margin: 4px 0;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .component-item:hover {
            background: #e9ecef;
            border-color: #1890ff;
        }

        .schema-editor {
            width: 100%;
            height: 200px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            resize: vertical;
            margin-top: 10px;
        }

        .status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 4px;
            color: #fff;
            font-size: 14px;
            z-index: 9999;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s;
        }

        .status.show {
            opacity: 1;
            transform: translateX(0);
        }

        .status.success {
            background: #52c41a;
        }

        .status.error {
            background: #ff4d4f;
        }

        .page-content {
            padding: 20px;
            background: white;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .component-btn {
            display: block;
            width: 100%;
            padding: 4px 8px;
            margin: 2px 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .component-btn:hover {
            background: #f0f8ff;
            border-color: #1890ff;
        }

        #loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .loading-content {
            text-align: center;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1890ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #666;
            font-size: 14px;
        }

        /* 拖拽相关样式 */
        .drag-placeholder {
            border: 2px dashed #1890ff;
            background: rgba(24, 144, 255, 0.1);
            min-height: 40px;
            margin: 4px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #1890ff;
            font-size: 12px;
            border-radius: 4px;
        }

        .drag-over {
            background: rgba(24, 144, 255, 0.2);
            border-color: #1890ff;
        }

        .component-item[draggable="true"] {
            cursor: grab;
        }

        .component-item[draggable="true"]:active {
            cursor: grabbing;
        }

        .component-editable.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .drop-zone {
            min-height: 100px;
            border: 2px dashed transparent;
            padding: 8px;
            margin: 4px 0;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .drop-zone.drag-over {
            border-color: #1890ff;
            background: rgba(24, 144, 255, 0.1);
        }

        .drop-zone:empty::before {
            content: '拖拽组件到此处';
            color: #999;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 80px;
        }

        /* 表单构建器样式 */
        .form-builder-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 3000;
        }

        .form-builder-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .form-builder-modal {
            background: white;
            border-radius: 8px;
            width: 90%;
            height: 90%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .form-builder-header {
            padding: 16px 20px;
            border-bottom: 1px solid #e8e8e8;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .form-builder-header h3 {
            margin: 0;
            font-size: 18px;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: #666;
        }

        .form-builder-body {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .form-builder-sidebar {
            width: 250px;
            border-right: 1px solid #e8e8e8;
            padding: 16px;
            overflow-y: auto;
        }

        .form-builder-sidebar h4 {
            margin: 0 0 12px;
            font-size: 14px;
            color: #666;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }

        .field-types {
            margin-bottom: 24px;
        }

        .field-type {
            padding: 8px 12px;
            margin: 4px 0;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            cursor: grab;
            font-size: 14px;
            transition: all 0.2s;
        }

        .field-type:hover {
            background: #e9ecef;
            border-color: #1890ff;
        }

        .field-type:active {
            cursor: grabbing;
        }

        .validation-rules {
            margin-bottom: 16px;
        }

        .rule-item {
            margin: 8px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .rule-item label {
            font-size: 13px;
            cursor: pointer;
        }

        .rule-value {
            width: 60px;
            padding: 2px 6px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 12px;
        }

        .form-builder-main {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
        }

        .form-preview {
            min-height: 400px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 16px;
        }

        .form-drop-zone {
            min-height: 360px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-drop-zone.drag-over {
            border-color: #1890ff;
            background: rgba(24, 144, 255, 0.1);
            color: #1890ff;
        }

        .form-field {
            margin: 12px 0;
            padding: 12px;
            border: 1px solid #e8e8e8;
            border-radius: 6px;
            background: white;
            transition: all 0.2s;
        }

        .form-field:hover {
            border-color: #1890ff;
        }

        .form-field.selected {
            border-color: #1890ff;
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
        }

        .field-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .field-header label {
            font-weight: 600;
            color: #333;
        }

        .field-actions {
            display: flex;
            gap: 4px;
        }

        .field-btn {
            background: none;
            border: none;
            padding: 4px;
            cursor: pointer;
            border-radius: 3px;
            font-size: 12px;
        }

        .field-btn:hover {
            background: #f0f0f0;
        }

        .field-content input,
        .field-content textarea,
        .field-content select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-builder-properties {
            width: 280px;
            border-left: 1px solid #e8e8e8;
            padding: 16px;
            overflow-y: auto;
        }

        .form-builder-properties h4 {
            margin: 0 0 16px;
            font-size: 14px;
            color: #666;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }

        .property-group {
            margin-bottom: 16px;
        }

        .property-group label {
            display: block;
            margin-bottom: 6px;
            font-size: 13px;
            color: #666;
            font-weight: 500;
        }

        .property-group input {
            width: 100%;
            padding: 6px 10px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 13px;
        }

        .property-actions {
            margin-top: 20px;
        }

        .form-builder-footer {
            padding: 16px 20px;
            border-top: 1px solid #e8e8e8;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .code-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 4000;
        }

        .code-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .code-modal {
            background: white;
            border-radius: 8px;
            width: 80%;
            max-width: 800px;
            max-height: 80%;
            display: flex;
            flex-direction: column;
        }

        .code-header {
            padding: 16px 20px;
            border-bottom: 1px solid #e8e8e8;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .code-body {
            padding: 20px;
            flex: 1;
            overflow: auto;
        }

        .code-footer {
            padding: 16px 20px;
            border-top: 1px solid #e8e8e8;
            text-align: right;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 20px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #1890ff;
        }

        input:checked + .slider:before {
            transform: translateX(20px);
        }

        /* 属性检查器样式 */
        .property-inspector {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 350px;
            height: calc(100vh - 20px);
            background: white;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            z-index: 2000;
            display: none;
            flex-direction: column;
        }

        .property-inspector.show {
            display: flex;
        }

        .inspector-header {
            padding: 16px;
            border-bottom: 1px solid #e8e8e8;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .inspector-header h3 {
            margin: 0;
            font-size: 16px;
            color: #333;
        }

        .inspector-body {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .inspector-section {
            margin-bottom: 20px;
        }

        .inspector-section h4 {
            margin: 0 0 12px;
            font-size: 14px;
            color: #666;
            border-bottom: 1px solid #eee;
            padding-bottom: 6px;
        }

        .property-item {
            margin-bottom: 12px;
        }

        .property-item label {
            display: block;
            margin-bottom: 4px;
            font-size: 13px;
            color: #666;
            font-weight: 500;
        }

        .property-item input,
        .property-item select,
        .property-item textarea {
            width: 100%;
            padding: 6px 10px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 13px;
        }

        .property-item textarea {
            min-height: 60px;
            resize: vertical;
        }

        .property-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .property-checkbox input {
            width: auto;
        }

        .property-tabs {
            display: flex;
            border-bottom: 1px solid #e8e8e8;
            margin-bottom: 16px;
        }

        .property-tab {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            font-size: 13px;
            color: #666;
        }

        .property-tab.active {
            color: #1890ff;
            border-bottom-color: #1890ff;
        }

        .property-tab:hover {
            color: #1890ff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .json-editor {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 12px;
            min-height: 120px;
            font-size: 12px;
        }

        .color-picker-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-preview {
            width: 24px;
            height: 24px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }

        .binding-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 8px;
            margin: 4px 0;
        }

        .binding-item h5 {
            margin: 0 0 6px;
            font-size: 12px;
            color: #666;
        }

        .binding-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .mini-btn {
            padding: 4px 8px;
            font-size: 12px;
            border: 1px solid #d9d9d9;
            border-radius: 3px;
            background: white;
            cursor: pointer;
        }

        .mini-btn:hover {
            border-color: #1890ff;
            color: #1890ff;
        }

        /* 代码生成器样式 */
        .code-generator {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 3500;
            display: none;
        }

        .code-generator.show {
            display: flex;
        }

        .generator-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .generator-modal {
            background: white;
            border-radius: 12px;
            width: 95%;
            height: 95%;
            max-width: 1400px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.4);
        }

        .generator-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e8e8e8;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px 12px 0 0;
        }

        .generator-header h3 {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
        }

        .generator-body {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .generator-sidebar {
            width: 280px;
            border-right: 1px solid #e8e8e8;
            background: #fafafa;
            overflow-y: auto;
        }

        .generator-config {
            padding: 20px;
        }

        .config-section {
            margin-bottom: 24px;
            background: white;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .config-section h4 {
            margin: 0 0 16px;
            color: #333;
            font-size: 14px;
            font-weight: 600;
            border-bottom: 2px solid #1890ff;
            padding-bottom: 8px;
        }

        .config-item {
            margin-bottom: 12px;
        }

        .config-item label {
            display: block;
            margin-bottom: 6px;
            font-size: 13px;
            color: #666;
            font-weight: 500;
        }

        .config-item select,
        .config-item input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 6px;
            font-size: 13px;
            transition: border-color 0.3s;
        }

        .config-item select:focus,
        .config-item input:focus {
            border-color: #1890ff;
            outline: none;
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
        }

        .generator-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .generator-tabs {
            display: flex;
            border-bottom: 1px solid #e8e8e8;
            background: #f8f9fa;
        }

        .generator-tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-size: 14px;
            color: #666;
            transition: all 0.3s;
            position: relative;
        }

        .generator-tab.active {
            color: #1890ff;
            border-bottom-color: #1890ff;
            background: white;
        }

        .generator-tab:hover {
            color: #1890ff;
            background: #f0f0f0;
        }

        .generator-content {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .code-output {
            flex: 1;
            overflow: auto;
            padding: 20px;
            background: #f8f9fa;
        }

        .code-editor {
            width: 100%;
            height: 100%;
            min-height: 400px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            background: #1e1e1e;
            color: #d4d4d4;
            border: none;
            border-radius: 8px;
            padding: 20px;
            resize: none;
        }

        .generation-options {
            padding: 16px 20px;
            border-top: 1px solid #e8e8e8;
            background: white;
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .generate-btn {
            background: linear-gradient(135deg, #52c41a 0%, #73d13d 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .generate-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(82, 196, 26, 0.3);
        }

        .validation-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            max-width: 900px;
            height: 80%;
            background: white;
            border-radius: 12px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.3);
            z-index: 4000;
            display: none;
            flex-direction: column;
        }

        .validation-panel.show {
            display: flex;
        }

        .validation-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e8e8e8;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .validation-body {
            flex: 1;
            overflow: auto;
            padding: 24px;
        }

        .validation-result {
            margin-bottom: 20px;
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #52c41a;
            background: #f6ffed;
        }

        .validation-result.error {
            border-left-color: #ff4d4f;
            background: #fff2f0;
        }

        .validation-result.warning {
            border-left-color: #faad14;
            background: #fffbe6;
        }

        .result-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .result-message {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }

        .validation-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-item {
            flex: 1;
            text-align: center;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e8e8e8;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #1890ff;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
        }

        .card {
            background: white;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .grid {
            display: grid;
            gap: 16px;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .alert {
            padding: 12px 16px;
            border-radius: 4px;
            margin-bottom: 16px;
        }

        .alert.info {
            background: #e6f7ff;
            border: 1px solid #91d5ff;
            color: #0050b3;
        }

        .alert.success {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #389e0d;
        }

        .stat-card {
            text-align: center;
            padding: 20px;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        /* 新增组件样式 */
        .panel-card { border-left: 4px solid #1890ff; }
        .service-card { background: #f8f9fa; }
        .action-button .btn { 
            width: 100%; margin: 4px 0; padding: 8px 16px; 
            border: none; border-radius: 4px; cursor: pointer; 
        }
        .action-button .btn.primary { background: #1890ff; color: white; }
        .action-button .btn.info { background: #13c2c2; color: white; }
        .action-button .btn.success { background: #52c41a; color: white; }
        .action-button .btn.warning { background: #faad14; color: white; }
        .property-list { background: #fafafa; padding: 16px; border-radius: 6px; }
        .list-container { margin: 8px 0; }
        .badge { padding: 4px 8px; border-radius: 12px; font-size: 12px; }
        .badge-success { background: #f6ffed; color: #52c41a; border: 1px solid #b7eb8f; }
        .badge-default { background: #fafafa; color: #666; border: 1px solid #d9d9d9; }
        .badge-warning { background: #fffbe6; color: #faad14; border: 1px solid #ffe58f; }
        .chart-card { min-height: 400px; }

        /* 实时预览增强样式 */
        .component-editable {
            position: relative;
            border: 2px solid transparent;
            transition: border-color 0.2s;
        }

        .component-editable:hover {
            border-color: #1890ff;
            cursor: pointer;
        }

        .component-editable.selected {
            border-color: #1890ff;
            background: rgba(24, 144, 255, 0.05);
        }

        .component-toolbar {
            position: absolute;
            top: -30px;
            right: 0;
            display: none;
            background: #1890ff;
            border-radius: 4px;
            padding: 4px;
            z-index: 1000;
        }

        .component-editable:hover .component-toolbar,
        .component-editable.selected .component-toolbar {
            display: flex;
        }

        .toolbar-btn {
            background: transparent;
            border: none;
            color: white;
            padding: 4px 8px;
            margin: 0 2px;
            border-radius: 2px;
            cursor: pointer;
            font-size: 12px;
        }

        .toolbar-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .property-form {
            margin-bottom: 16px;
        }

        .property-form label {
            display: block;
            margin-bottom: 4px;
            font-weight: 500;
            color: #333;
        }

        .property-form input,
        .property-form select,
        .property-form textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🎨 DDD平台简易编辑器</h1>
        <div class="actions">
            <button class="btn" onclick="loadDashboard()">📊 仪表板</button>
            <button class="btn" onclick="loadForm()">📝 表单模板</button>
            <button class="btn" onclick="loadCrudTemplate()">🔧 CRUD模板</button>
            <button class="btn" onclick="openFormBuilder()">🏗️ 表单构建器</button>
            <button class="btn" onclick="openPropertyInspector()">🔧 属性检查器</button>
            <button class="btn" onclick="exportSchema()">📤 导出Schema</button>
            <button class="btn" onclick="openImportDialog()">📥 导入Schema</button>
            <button class="btn" onclick="openCodeGenerator()">⚙️ 代码生成器</button>
            <button class="btn" onclick="openValidationPanel()">✅ 模型验证</button>
            <button class="btn" onclick="togglePropertyPanel()">⚙️ 属性面板</button>
            <button class="btn" onclick="clearContent()">🗑️ 清空</button>
            <button class="btn primary" onclick="connectBackend()">🔌 连接后端</button>
        </div>
    </div>

    <div class="container">
        <div class="sidebar">
            <h3>📦 组件库</h3>
            
            <!-- 快速添加工具栏 -->
            <div class="component-toolbar-main" style="margin-bottom: 16px; padding: 8px; background: #f9f9f9; border-radius: 4px;">
                <!-- 这里将由JavaScript动态填充 -->
            </div>
            
            <h4 style="margin: 16px 0 8px; color: #666; font-size: 12px;">基础组件</h4>
            <div class="component-item" draggable="true" data-component-type="alert" onclick="addAlert()">⚠️ 提示框</div>
            <div class="component-item" draggable="true" data-component-type="card" onclick="addCard()">📄 卡片</div>
            <div class="component-item" draggable="true" data-component-type="stat" onclick="addStatCard()">📊 统计卡片</div>
            <div class="component-item" draggable="true" data-component-type="grid" onclick="addGrid()">📐 网格布局</div>
            
            <h4 style="margin: 16px 0 8px; color: #666; font-size: 12px;">表单组件</h4>
            <div class="component-item" draggable="true" data-component-type="form" onclick="addForm()">📝 表单</div>
            <div class="component-item" draggable="true" data-component-type="input-text" onclick="addInputText()">🔤 文本输入</div>
            <div class="component-item" draggable="true" data-component-type="textarea" onclick="addTextarea()">📝 多行文本</div>
            <div class="component-item" draggable="true" data-component-type="select" onclick="addSelect()">📋 下拉选择</div>
            <div class="component-item" draggable="true" data-component-type="date-picker" onclick="addDatePicker()">📅 日期选择器</div>
            <div class="component-item" draggable="true" data-component-type="upload" onclick="addUpload()">📁 文件上传</div>
            <div class="component-item" draggable="true" data-component-type="rich-text" onclick="addRichText()">📝 富文本编辑器</div>
            <div class="component-item" draggable="true" data-component-type="cascader" onclick="addCascader()">📂 级联选择器</div>
            <div class="component-item" draggable="true" data-component-type="number" onclick="addNumberInput()">🔢 数字输入</div>
            <div class="component-item" draggable="true" data-component-type="switch" onclick="addSwitch()">🔘 开关</div>
            <div class="component-item" draggable="true" data-component-type="checkbox" onclick="addCheckbox()">☑️ 复选框</div>
            <div class="component-item" draggable="true" data-component-type="radio" onclick="addRadio()">🔘 单选框</div>
            
            <h4 style="margin: 16px 0 8px; color: #666; font-size: 12px;">数据组件</h4>
            <div class="component-item" draggable="true" data-component-type="table" onclick="addTable()">📋 数据表格</div>
            <div class="component-item" draggable="true" data-component-type="crud" onclick="addCrud()">🔧 CRUD管理</div>
            <div class="component-item" draggable="true" data-component-type="tree" onclick="addTree()">🌳 树形结构</div>
            <div class="component-item" draggable="true" data-component-type="timeline" onclick="addTimeline()">⏰ 时间轴</div>
            <div class="component-item" draggable="true" data-component-type="list" onclick="addList()">📄 列表</div>
            <div class="component-item" draggable="true" data-component-type="pagination" onclick="addPagination()">📖 分页器</div>
            
            <h4 style="margin: 16px 0 8px; color: #666; font-size: 12px;">展示组件</h4>
            <div class="component-item" draggable="true" data-component-type="tag" onclick="addTag()">🏷️ 标签</div>
            <div class="component-item" draggable="true" data-component-type="progress" onclick="addProgress()">📊 进度条</div>
            <div class="component-item" draggable="true" data-component-type="image" onclick="addImage()">🖼️ 图片</div>
            <div class="component-item" draggable="true" data-component-type="divider" onclick="addDivider()">➖ 分割线</div>
            <div class="component-item" draggable="true" data-component-type="status" onclick="addStatus()">🟢 状态标识</div>
            
            <h4 style="margin: 16px 0 8px; color: #666; font-size: 12px;">交互组件</h4>
            <div class="component-item" draggable="true" data-component-type="button" onclick="addButton()">🔘 按钮</div>
            <div class="component-item" draggable="true" data-component-type="button-group" onclick="addButtonGroup()">🔘 按钮组</div>
            <div class="component-item" draggable="true" data-component-type="dropdown-button" onclick="addDropdownButton()">📥 下拉按钮</div>
            <div class="component-item" draggable="true" data-component-type="tabs" onclick="addTabs()">📂 标签页</div>
            <div class="component-item" draggable="true" data-component-type="collapse" onclick="addCollapse()">📁 折叠面板</div>
            
            <h4 style="margin: 16px 0 8px; color: #666; font-size: 12px;">🎯 完整CRUD示例</h4>
            <div class="component-item" onclick="loadUserManagementDemo()" style="background: #fff0f6; border: 2px solid #f759ab; font-weight: bold;">🔥 用户管理系统</div>
            <div class="component-item" onclick="loadProjectManagementDemo()" style="background: #f0f9ff; border: 1px solid #69c0ff;">📂 项目管理系统</div>
            <div class="component-item" onclick="loadOrderManagementDemo()" style="background: #fcffe6; border: 1px solid #95de64;">📋 订单管理系统</div>
            
            <h4 style="margin: 16px 0 8px; color: #666; font-size: 12px;">🔥 DDD屏幕生成器</h4>
            <div class="component-item" onclick="generateListScreen()" style="background: #e6f7ff; border: 1px solid #91d5ff;">📄 列表屏幕</div>
            <div class="component-item" onclick="generateDetailScreen()" style="background: #f6ffed; border: 1px solid #b7eb8f;">👁️ 详情屏幕</div>
            <div class="component-item" onclick="generateEditScreen()" style="background: #fff2e8; border: 1px solid #ffd591;">✏️ 编辑屏幕</div>
            <div class="component-item" onclick="generateDashboardScreen()" style="background: #f9f0ff; border: 1px solid #d3adf7;">📊 仪表板屏幕</div>
            <div class="component-item" onclick="generateWorkflowScreen()" style="background: #fff1f0; border: 1px solid #ffa39e;">🔄 工作流屏幕</div>
            
            <h4 style="margin: 16px 0 8px; color: #666; font-size: 12px;">DDD模板</h4>
            <div class="component-item" onclick="loadTemplate('entity-management')">🏗️ 实体管理</div>
            <div class="component-item" onclick="loadTemplate('domain-design')">🎨 领域设计</div>
            <div class="component-item" onclick="loadTemplate('project-overview')">📊 项目概览</div>
            <div class="component-item" onclick="loadTemplate('entity-configuration')">📝 实体配置</div>
            <div class="component-item" onclick="loadTemplate('model-analysis')">📊 模型分析</div>
            
            <h3 style="margin-top: 20px;">⚙️ Schema编辑器</h3>
            <textarea id="schema-editor" class="schema-editor" placeholder="在此查看和编辑JSON Schema..."></textarea>
            <button class="btn" onclick="applySchema()" style="width: 100%; margin-top: 10px;">🔄 应用Schema</button>
        </div>

        <div class="content" id="content">
            <div class="drop-zone" id="main-drop-zone">
                <div class="page-content">
                    <div style="text-align: center; padding: 60px 20px;">
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; border-radius: 12px;">
                            <h1 style="margin-bottom: 20px; font-size: 2.5rem;">🎨 DDD平台可视化编辑器</h1>
                        <p style="font-size: 1.2rem; opacity: 0.9; margin-bottom: 30px;">简易版本，专注于页面布局和组件管理</p>
                        <p style="opacity: 0.8;">点击左侧组件库开始构建你的页面</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="property-panel" id="property-panel">
            <h3>⚙️ 属性编辑</h3>
            <div id="property-content">
                <p style="color: #666; text-align: center; margin-top: 40px;">选择一个组件来编辑其属性</p>
            </div>
        </div>
    </div>

    <div id="status" class="status"></div>

    <script>
        let currentSchema = {
            type: 'page',
            title: 'DDD平台 - 领域驱动设计编辑器',
            body: [
                {
                    type: 'tpl',
                    tpl: `<div style="text-align: center; padding: 40px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 8px; margin-bottom: 20px;">
                        <h1 style="margin: 0 0 10px 0; font-size: 28px;">🏗️ DDD平台欢迎您</h1>
                        <p style="margin: 0; font-size: 16px; opacity: 0.9;">Domain-Driven Design 领域驱动设计可视化编辑器</p>
                        <p style="margin: 10px 0 0 0; font-size: 14px; opacity: 0.8;">使用左侧工具栏添加DDD组件，构建您的领域模型</p>
                    </div>`
                },
                {
                    type: 'grid',
                    columns: [
                        {
                            md: 4,
                            body: {
                                type: 'card',
                                header: { title: '🏗️ 实体管理', subTitle: 'Entity Management' },
                                body: {
                                    type: 'tpl',
                                    tpl: `<p>管理您的领域实体、聚合根和值对象</p>
                                    <ul style="margin: 10px 0; padding-left: 20px;">
                                        <li>定义实体属性</li>
                                        <li>设置业务规则</li>
                                        <li>管理生命周期</li>
                                    </ul>`
                                }
                            }
                        },
                        {
                            md: 4,
                            body: {
                                type: 'card',
                                header: { title: '⚙️ 服务编排', subTitle: 'Service Orchestration' },
                                body: {
                                    type: 'tpl',
                                    tpl: `<p>设计和管理领域服务</p>
                                    <ul style="margin: 10px 0; padding-left: 20px;">
                                        <li>应用服务</li>
                                        <li>领域服务</li>
                                        <li>基础设施服务</li>
                                    </ul>`
                                }
                            }
                        },
                        {
                            md: 4,
                            body: {
                                type: 'card',
                                header: { title: '🗃️ 仓储模式', subTitle: 'Repository Pattern' },
                                body: {
                                    type: 'tpl',
                                    tpl: `<p>数据访问层抽象</p>
                                    <ul style="margin: 10px 0; padding-left: 20px;">
                                        <li>接口定义</li>
                                        <li>实现分离</li>
                                        <li>测试友好</li>
                                    </ul>`
                                }
                            }
                        }
                    ]
                },
                {
                    type: 'divider',
                    style: { margin: '20px 0' }
                },
                {
                    type: 'tpl',
                    tpl: `<div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #28a745;">
                        <h3 style="margin: 0 0 10px 0; color: #495057;">🚀 快速开始</h3>
                        <p style="margin: 0; color: #6c757d;">点击左侧工具栏中的DDD组件开始构建您的领域模型，或使用顶部菜单导入现有的Schema配置。</p>
                    </div>`
                }
            ]
        };

        // 实时预览增强变量
        let selectedComponent = null;
        let selectedComponentIndex = -1;
        let componentCounter = 0;

        // 组件属性检查器功能
        let propertyInspectorVisible = false;
        let currentInspectedComponent = null;
        let componentBindings = new Map(); // 存储组件数据绑定信息

        // 创建带选项的select元素 - 辅助函数
        function createSelectWithOptions(options, id) {
            const select = document.createElement('select');
            select.id = id;
            
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option.value;
                optionElement.textContent = option.text;
                if (option.selected) {
                    optionElement.selected = true;
                }
                select.appendChild(optionElement);
            });
            
            return select;
        }

        // 显示状态消息
        function showStatus(message, type = 'success') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type} show`;
            
            setTimeout(() => {
                status.classList.remove('show');
            }, 3000);
        }

        // 更新Schema编辑器
        function updateSchemaEditor() {
            document.getElementById('schema-editor').value = JSON.stringify(currentSchema, null, 2);
        }

        // 使组件可编辑
        function makeComponentEditable(element, componentData, index) {
            element.classList.add('component-editable');
            element.setAttribute('data-component-index', index);
            
            // 添加工具栏
            const toolbar = document.createElement('div');
            toolbar.className = 'component-toolbar';
            toolbar.innerHTML = `
                <button class="toolbar-btn" title="编辑">✏️</button>
                <button class="toolbar-btn" title="删除">🗑️</button>
                <button class="toolbar-btn" title="上移">⬆️</button>
                <button class="toolbar-btn" title="下移">⬇️</button>
            `;
            
            // 绑定工具栏事件
            const buttons = toolbar.querySelectorAll('.toolbar-btn');
            buttons[0].onclick = (e) => { e.stopPropagation(); selectComponent(element, componentData, index); };
            buttons[1].onclick = (e) => { e.stopPropagation(); deleteComponent(index); };
            buttons[2].onclick = (e) => { e.stopPropagation(); moveComponent(index, -1); };
            buttons[3].onclick = (e) => { e.stopPropagation(); moveComponent(index, 1); };
            
            element.style.position = 'relative';
            element.appendChild(toolbar);
            
            // 点击选择
            element.addEventListener('click', (e) => {
                e.stopPropagation();
                selectComponent(element, componentData, index);
            });
        }

        // 添加新组件
        function addComponent(type) {
            const newComponent = createComponentTemplate(type);
            currentSchema.body = currentSchema.body || [];
            currentSchema.body.push(newComponent);
            renderContent();
            showStatus(`已添加${type}组件`, 'success');
        }

        // 获取所有组件方法
        function getAllComponents() {
            const allComponents = [];
            
            function traverseSchema(schema, path = '') {
                if (schema && typeof schema === 'object') {
                    if (schema.type) {
                        allComponents.push({
                            type: schema.type,
                            name: schema.name || schema.title || schema.label,
                            path: path,
                            schema: schema
                        });
                    }
                    
                    // 递归遍历子组件
                    if (schema.body) {
                        if (Array.isArray(schema.body)) {
                            schema.body.forEach((item, index) => {
                                traverseSchema(item, `${path}.body[${index}]`);
                            });
                        } else {
                            traverseSchema(schema.body, `${path}.body`);
                        }
                    }
                    
                    if (schema.columns && Array.isArray(schema.columns)) {
                        schema.columns.forEach((item, index) => {
                            traverseSchema(item, `${path}.columns[${index}]`);
                        });
                    }
                }
            }
            
            traverseSchema(currentSchema);
            return allComponents;
        }

        // 获取所有实体
        function getAllEntities() {
            const entities = [];
            
            function traverseSchema(schema) {
                if (schema && typeof schema === 'object') {
                    // 检查是否是实体组件
                    if (schema.type === 'card' && schema.header && schema.header.title && 
                        (schema.header.title.includes('实体') || schema.header.title.includes('Entity'))) {
                        const formBody = schema.body && schema.body.body;
                        if (formBody && Array.isArray(formBody)) {
                            const nameField = formBody.find(field => field.name === 'name');
                            const typeField = formBody.find(field => field.name === 'type');
                            if (nameField) {
                                entities.push({
                                    name: nameField.value || '未命名实体',
                                    type: typeField ? typeField.value : 'entity',
                                    schema: schema
                                });
                            }
                        }
                    }
                    
                    // 递归遍历
                    if (schema.body) {
                        if (Array.isArray(schema.body)) {
                            schema.body.forEach(item => traverseSchema(item));
                        } else {
                            traverseSchema(schema.body);
                        }
                    }
                    
                    if (schema.columns && Array.isArray(schema.columns)) {
                        schema.columns.forEach(item => traverseSchema(item));
                    }
                }
            }
            
            traverseSchema(currentSchema);
            return entities;
        }

        // 获取所有服务
        function getAllServices() {
            const services = [];
            
            function traverseSchema(schema) {
                if (schema && typeof schema === 'object') {
                    // 检查是否是服务组件
                    if (schema.type === 'card' && schema.header && schema.header.title && 
                        (schema.header.title.includes('服务') || schema.header.title.includes('Service'))) {
                        const formBody = schema.body && schema.body.body;
                        if (formBody && Array.isArray(formBody)) {
                            const nameField = formBody.find(field => field.name === 'serviceName');
                            const typeField = formBody.find(field => field.name === 'serviceType');
                            if (nameField) {
                                services.push({
                                    name: nameField.value || '未命名服务',
                                    type: typeField ? typeField.value : 'domain_service',
                                    schema: schema
                                });
                            }
                        }
                    }
                    
                    // 递归遍历
                    if (schema.body) {
                        if (Array.isArray(schema.body)) {
                            schema.body.forEach(item => traverseSchema(item));
                        } else {
                            traverseSchema(schema.body);
                        }
                    }
                    
                    if (schema.columns && Array.isArray(schema.columns)) {
                        schema.columns.forEach(item => traverseSchema(item));
                    }
                }
            }
            
            traverseSchema(currentSchema);
            return services;
        }

        // 创建实体选择器对话框
        function showEntitySelector(callback, fieldName) {
            const entities = getAllEntities();
            
            if (entities.length === 0) {
                showStatus('当前页面没有找到任何实体组件，请先添加实体组件', 'warning');
                return;
            }
            
            const entitiesHtml = entities.map((entity, index) => `
                <div class="entity-item" style="border: 1px solid #e8e8e8; border-radius: 6px; padding: 12px; margin-bottom: 8px; cursor: pointer;" onclick="selectEntity(${index})">
                    <div style="font-weight: bold; color: #1890ff; margin-bottom: 4px;">${entity.name}</div>
                    <div style="color: #666; font-size: 12px;">类型: ${entity.type === 'aggregate_root' ? '聚合根' : entity.type === 'entity' ? '实体' : '值对象'}</div>
                </div>
            `).join('');
            
            const modalHtml = `
                <div class="entity-selector-modal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 8px; padding: 24px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="margin: 0; color: #1890ff;">🎯 选择关联实体</h3>
                            <button onclick="closeEntitySelector()" style="background: none; border: none; font-size: 20px; cursor: pointer; color: #999;">&times;</button>
                        </div>
                        <div style="margin-bottom: 16px;">
                            <input type="text" placeholder="搜索实体..." style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" onkeyup="filterEntities(this.value)">
                        </div>
                        <div id="entitiesContainer">
                            ${entitiesHtml}
                        </div>
                    </div>
                </div>
            `;
            
            // 添加到页面
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // 存储回调函数和字段名
            window.entitySelectorCallback = callback;
            window.currentFieldName = fieldName;
            window.availableEntities = entities;
        }

        // 选择实体
        function selectEntity(index) {
            const entity = window.availableEntities[index];
            if (window.entitySelectorCallback) {
                window.entitySelectorCallback(entity);
            } else if (window.currentFieldName) {
                // 后备方案：直接设置字段值
                const input = document.querySelector(`[name="${window.currentFieldName}"]`);
                if (input) {
                    if (input.tagName === 'TEXTAREA' && window.currentFieldName === 'childEntities') {
                        // 对于子实体列表，追加而不是替换
                        const current = input.value || '';
                        const newValue = current ? current + '\n' + entity.name : entity.name;
                        input.value = newValue;
                    } else {
                        input.value = entity.name;
                    }
                }
            }
            closeEntitySelector();
        }

        // 关闭实体选择器
        function closeEntitySelector() {
            const modal = document.querySelector('.entity-selector-modal');
            if (modal) {
                modal.remove();
            }
            delete window.entitySelectorCallback;
            delete window.currentFieldName;
            delete window.availableEntities;
        }

        // 过滤实体
        function filterEntities(keyword) {
            const entities = document.querySelectorAll('.entity-item');
            entities.forEach(entity => {
                const name = entity.querySelector('div').textContent.toLowerCase();
                if (name.includes(keyword.toLowerCase())) {
                    entity.style.display = 'block';
                } else {
                    entity.style.display = 'none';
                }
            });
        }

        // 创建服务选择器对话框
        function showServiceSelector(callback) {
            const services = getAllServices();
            
            if (services.length === 0) {
                showStatus('当前页面没有找到任何服务组件，请先添加服务组件', 'warning');
                return;
            }
            
            const servicesHtml = services.map((service, index) => `
                <div class="service-item" style="border: 1px solid #e8e8e8; border-radius: 6px; padding: 12px; margin-bottom: 8px; cursor: pointer;" onclick="selectService(${index})">
                    <div style="font-weight: bold; color: #52c41a; margin-bottom: 4px;">${service.name}</div>
                    <div style="color: #666; font-size: 12px;">类型: ${service.type === 'application_service' ? '应用服务' : service.type === 'domain_service' ? '领域服务' : '基础设施服务'}</div>
                </div>
            `).join('');
            
            const modalHtml = `
                <div class="service-selector-modal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 8px; padding: 24px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="margin: 0; color: #52c41a;">⚙️ 选择关联服务</h3>
                            <button onclick="closeServiceSelector()" style="background: none; border: none; font-size: 20px; cursor: pointer; color: #999;">&times;</button>
                        </div>
                        <div style="margin-bottom: 16px;">
                            <input type="text" placeholder="搜索服务..." style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" onkeyup="filterServices(this.value)">
                        </div>
                        <div id="servicesContainer">
                            ${servicesHtml}
                        </div>
                    </div>
                </div>
            `;
            
            // 添加到页面
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // 存储回调函数
            window.serviceSelectorCallback = callback;
            window.availableServices = services;
        }

        // 选择服务
        function selectService(index) {
            const service = window.availableServices[index];
            if (window.serviceSelectorCallback) {
                window.serviceSelectorCallback(service);
            }
            closeServiceSelector();
        }

        // 关闭服务选择器
        function closeServiceSelector() {
            const modal = document.querySelector('.service-selector-modal');
            if (modal) {
                modal.remove();
            }
            delete window.serviceSelectorCallback;
            delete window.availableServices;
        }

        // 过滤服务
        function filterServices(keyword) {
            const services = document.querySelectorAll('.service-item');
            services.forEach(service => {
                const name = service.querySelector('div').textContent.toLowerCase();
                if (name.includes(keyword.toLowerCase())) {
                    service.style.display = 'block';
                } else {
                    service.style.display = 'none';
                }
            });
        }

        // 简化的选择器调用函数
        function selectEntityForField(fieldName) {
            showEntitySelector(null, fieldName);
        }

        function selectEntityForRepository() {
            selectEntityForField('entityType');
        }

        function selectEntityForService() {
            selectEntityForField('dependentEntities');
        }

        function selectEntityForAggregateRoot() {
            selectEntityForField('rootEntity');
        }

        function addEntityToAggregate() {
            selectEntityForField('childEntities');
        }

        // 创建组件模板
        function createComponentTemplate(type) {
            const templates = {
                // DDD核心组件
                'entity': {
                    type: 'card',
                    header: { title: '实体 - Entity', subTitle: 'DDD核心业务对象' },
                    body: {
                        type: 'form',
                        mode: 'horizontal',
                        body: [
                            { type: 'input-text', name: 'name', label: '实体名称', required: true },
                            { type: 'textarea', name: 'description', label: '实体描述', rows: 3 },
                            { type: 'select', name: 'type', label: '实体类型', options: [
                                { label: '聚合根', value: 'aggregate_root' },
                                { label: '实体', value: 'entity' },
                                { label: '值对象', value: 'value_object' }
                            ]}
                        ]
                    }
                },
                'service': {
                    type: 'card',
                    header: { title: '领域服务 - Domain Service', subTitle: 'DDD业务逻辑服务' },
                    body: {
                        type: 'form',
                        mode: 'horizontal',
                        body: [
                            { type: 'input-text', name: 'serviceName', label: '服务名称', required: true },
                            { type: 'textarea', name: 'description', label: '服务描述', rows: 3 },
                            { type: 'select', name: 'serviceType', label: '服务类型', options: [
                                { label: '应用服务', value: 'application_service' },
                                { label: '领域服务', value: 'domain_service' },
                                { label: '基础设施服务', value: 'infrastructure_service' }
                            ]},
                            { 
                                type: 'group',
                                label: '依赖实体',
                                body: [
                                    { 
                                        type: 'input-text', 
                                        name: 'dependentEntities', 
                                        placeholder: '点击选择按钮选择依赖的实体',
                                        readOnly: true
                                    },
                                    { 
                                        type: 'button', 
                                        label: '选择实体', 
                                        level: 'primary',
                                        size: 'sm',
                                        actionType: 'url',
                                        url: 'javascript:selectEntityForService()'
                                    }
                                ]
                            }
                        ]
                    }
                },
                'repository': {
                    type: 'card',
                    header: { title: '仓储 - Repository', subTitle: 'DDD数据访问抽象' },
                    body: {
                        type: 'form',
                        mode: 'horizontal',
                        body: [
                            { type: 'input-text', name: 'repositoryName', label: '仓储名称', required: true },
                            { 
                                type: 'group',
                                label: '关联实体',
                                body: [
                                    { 
                                        type: 'input-text', 
                                        name: 'entityType', 
                                        placeholder: '点击选择实体按钮选择关联的实体',
                                        required: true,
                                        readOnly: true
                                    },
                                    { 
                                        type: 'button', 
                                        label: '选择实体', 
                                        level: 'primary',
                                        size: 'sm',
                                        actionType: 'url',
                                        url: 'javascript:selectEntityForRepository()'
                                    }
                                ]
                            },
                            { type: 'textarea', name: 'methods', label: '仓储方法', rows: 4, placeholder: '如：findById, save, delete 等' }
                        ]
                    }
                },
                'aggregate': {
                    type: 'card',
                    header: { title: '聚合根 - Aggregate Root', subTitle: 'DDD聚合边界定义' },
                    body: {
                        type: 'form',
                        mode: 'horizontal',
                        body: [
                            { type: 'input-text', name: 'aggregateName', label: '聚合名称', required: true },
                            { type: 'textarea', name: 'description', label: '聚合描述', rows: 3 },
                            { 
                                type: 'group',
                                label: '聚合根实体',
                                body: [
                                    { 
                                        type: 'input-text', 
                                        name: 'rootEntity', 
                                        placeholder: '点击选择按钮选择聚合根实体',
                                        required: true,
                                        readOnly: true
                                    },
                                    { 
                                        type: 'button', 
                                        label: '选择聚合根', 
                                        level: 'primary',
                                        size: 'sm',
                                        actionType: 'url',
                                        url: 'javascript:selectEntityForAggregateRoot()'
                                    }
                                ]
                            },
                            { 
                                type: 'group',
                                label: '包含实体',
                                body: [
                                    { 
                                        type: 'textarea', 
                                        name: 'childEntities', 
                                        placeholder: '聚合内的子实体列表（一行一个）',
                                        rows: 3
                                    },
                                    { 
                                        type: 'button', 
                                        label: '添加实体', 
                                        level: 'info',
                                        size: 'sm',
                                        actionType: 'url',
                                        url: 'javascript:addEntityToAggregate()'
                                    }
                                ]
                            },
                            { type: 'textarea', name: 'businessRules', label: '业务规则', rows: 3, placeholder: '描述聚合的业务不变量和规则' }
                        ]
                    }
                },
                'form': {
                    type: 'form',
                    title: '新建表单',
                    mode: 'horizontal',
                    body: [
                        { type: 'input-text', name: 'name', label: '名称', required: true },
                        { type: 'textarea', name: 'description', label: '描述', rows: 3 }
                    ],
                    actions: [
                        { type: 'submit', label: '提交', level: 'primary' },
                        { type: 'reset', label: '重置' }
                    ]
                },
                'crud': {
                    type: 'crud',
                    api: '/api/sample',
                    syncLocation: false,
                    title: 'CRUD数据管理',
                    headerToolbar: [
                        { type: 'button', label: '新增', actionType: 'dialog', level: 'primary' }
                    ],
                    columns: [
                        { name: 'id', label: 'ID', sortable: true },
                        { name: 'name', label: '名称', searchable: true },
                        { name: 'status', label: '状态', type: 'status' },
                        { name: 'createTime', label: '创建时间', type: 'datetime' },
                        { type: 'operation', label: '操作', buttons: [
                            { label: '编辑', level: 'link' },
                            { label: '删除', level: 'link', className: 'text-danger' }
                        ]}
                    ]
                },
                'table': {
                    type: 'table',
                    title: '数据表格',
                    data: {
                        items: [
                            { id: 1, name: '示例数据1', status: '正常', createTime: '2024-01-01 10:00:00' },
                            { id: 2, name: '示例数据2', status: '异常', createTime: '2024-01-02 11:00:00' }
                        ]
                    },
                    columns: [
                        { name: 'id', label: 'ID' },
                        { name: 'name', label: '名称' },
                        { name: 'status', label: '状态', type: 'status' },
                        { name: 'createTime', label: '创建时间' }
                    ]
                },
                'chart': {
                    type: 'chart',
                    title: '图表统计',
                    api: '/api/chart',
                    config: {
                        type: 'line',
                        data: {
                            labels: ['1月', '2月', '3月', '4月', '5月', '6月'],
                            datasets: [{
                                label: '数据趋势',
                                data: [12, 19, 3, 5, 2, 3],
                                borderColor: 'rgb(75, 192, 192)',
                                tension: 0.1
                            }]
                        }
                    }
                },
                'tpl': {
                    type: 'tpl',
                    tpl: '<div class="alert alert-info">模板内容：<strong>${title | default: "默认标题"}</strong><br>描述：${description | default: "暂无描述"}</div>'
                },
                'input-text': {
                    type: 'input-text',
                    name: 'textInput',
                    label: '文本输入',
                    placeholder: '请输入文本'
                },
                'textarea': {
                    type: 'textarea',
                    name: 'textareaInput',
                    label: '多行文本',
                    placeholder: '请输入多行文本'
                },
                'select': {
                    type: 'select',
                    name: 'selectInput',
                    label: '选择器',
                    options: [
                        { label: '选项1', value: 'option1' },
                        { label: '选项2', value: 'option2' }
                    ]
                },
                'button': {
                    type: 'button',
                    label: '按钮',
                    level: 'primary'
                },
                'divider': {
                    type: 'divider'
                }
            };
            
            return templates[type] || { type: type, label: '未知组件' };
        }

        // 显示加载状态
        function showLoading(message = '正在加载...') {
            const loadingDiv = document.getElementById('loading');
            if (loadingDiv) {
                loadingDiv.querySelector('.loading-text').textContent = message;
                loadingDiv.style.display = 'flex';
            }
        }

        // 隐藏加载状态
        function hideLoading() {
            const loadingDiv = document.getElementById('loading');
            if (loadingDiv) {
                loadingDiv.style.display = 'none';
            }
        }

        // 初始化页面
        function initializePage() {
            try {
                showLoading('初始化编辑器...');
                
                // 设置默认Schema
                if (!currentSchema.body) {
                    currentSchema.body = [];
                }
                
                // 初始化组件工具栏
                initializeComponentToolbar();
                
                // 初始化拖拽功能
                initializeDragAndDrop();
                
                // 渲染内容
                renderContent();
                
                hideLoading();
                showStatus('编辑器初始化完成', 'success');
            } catch (error) {
                console.error('初始化失败:', error);
                hideLoading();
                showStatus('初始化失败: ' + error.message, 'error');
            }
        }

        // 初始化组件工具栏
        function initializeComponentToolbar() {
            const toolbar = document.querySelector('.component-toolbar-main');
            if (!toolbar) return;
            
            const components = [
                // DDD核心组件
                { type: 'entity', label: '实体', icon: '🏗️', category: 'DDD核心' },
                { type: 'aggregate', label: '聚合根', icon: '🎯', category: 'DDD核心' },
                { type: 'service', label: '领域服务', icon: '⚙️', category: 'DDD核心' },
                { type: 'repository', label: '仓储', icon: '�️', category: 'DDD核心' },
                
                // 界面组件
                { type: 'form', label: '表单', icon: '📝', category: '界面组件' },
                { type: 'crud', label: 'CRUD', icon: '📊', category: '界面组件' },
                { type: 'table', label: '表格', icon: '📋', category: '界面组件' },
                { type: 'chart', label: '图表', icon: '�', category: '界面组件' },
                
                // 输入组件
                { type: 'input-text', label: '文本框', icon: '✏️', category: '输入组件' },
                { type: 'textarea', label: '文本域', icon: '📝', category: '输入组件' },
                { type: 'select', label: '选择器', icon: '📋', category: '输入组件' },
                { type: 'button', label: '按钮', icon: '🔘', category: '输入组件' },
                
                // 布局组件
                { type: 'tpl', label: '模板', icon: '📄', category: '布局组件' },
                { type: 'divider', label: '分割线', icon: '➖', category: '布局组件' }
            ];
            
            // 按分类组织组件
            const categories = {};
            components.forEach(comp => {
                if (!categories[comp.category]) {
                    categories[comp.category] = [];
                }
                categories[comp.category].push(comp);
            });
            
            let toolbarHTML = '';
            Object.keys(categories).forEach(category => {
                toolbarHTML += `<div style="margin-bottom: 12px;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 6px; font-weight: bold;">${category}</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 4px;">`;
                
                categories[category].forEach(comp => {
                    toolbarHTML += `<button class="component-btn" onclick="addComponent('${comp.type}')" title="添加${comp.label}" 
                        style="padding: 4px 8px; margin: 0; font-size: 12px; min-width: auto;">
                        ${comp.icon} ${comp.label}
                    </button>`;
                });
                
                toolbarHTML += '</div></div>';
            });
            
            toolbar.innerHTML = toolbarHTML;
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', initializePage);

        // 拖拽功能相关
        let draggedElement = null;
        let draggedComponentType = null;

        // 初始化拖拽功能
        function initializeDragAndDrop() {
            // 为组件项添加拖拽事件
            document.querySelectorAll('.component-item[draggable="true"]').forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
            });

            // 为拖拽区域添加事件
            const dropZone = document.getElementById('main-drop-zone');
            if (dropZone) {
                dropZone.addEventListener('dragover', handleDragOver);
                dropZone.addEventListener('drop', handleDrop);
                dropZone.addEventListener('dragenter', handleDragEnter);
                dropZone.addEventListener('dragleave', handleDragLeave);
            }
        }

        // 拖拽开始
        function handleDragStart(e) {
            draggedElement = e.target;
            draggedComponentType = e.target.getAttribute('data-component-type');
            e.target.classList.add('dragging');
            
            // 设置拖拽数据
            e.dataTransfer.setData('text/plain', draggedComponentType);
            e.dataTransfer.effectAllowed = 'copy';
        }

        // 拖拽结束
        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedElement = null;
            draggedComponentType = null;
        }

        // 拖拽经过
        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'copy';
        }

        // 拖拽进入
        function handleDragEnter(e) {
            e.preventDefault();
            e.target.classList.add('drag-over');
        }

        // 拖拽离开
        function handleDragLeave(e) {
            e.target.classList.remove('drag-over');
        }

        // 拖拽放置
        function handleDrop(e) {
            e.preventDefault();
            e.target.classList.remove('drag-over');
            
            const componentType = e.dataTransfer.getData('text/plain');
            if (componentType) {
                addComponent(componentType);
                showStatus(`已通过拖拽添加${componentType}组件`, 'success');
            }
        }

        // 组件内部拖拽（重新排序）
        function enableComponentReordering() {
            const components = document.querySelectorAll('.component-editable');
            components.forEach(comp => {
                comp.draggable = true;
                comp.addEventListener('dragstart', handleComponentDragStart);
                comp.addEventListener('dragover', handleComponentDragOver);
                comp.addEventListener('drop', handleComponentDrop);
            });
        }

        // 组件拖拽开始
        function handleComponentDragStart(e) {
            e.dataTransfer.setData('text/component-index', e.target.getAttribute('data-component-index'));
            e.target.style.opacity = '0.5';
        }

        // 组件拖拽经过
        function handleComponentDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        // 组件拖拽放置
        function handleComponentDrop(e) {
            e.preventDefault();
            e.target.style.opacity = '';
            
            const fromIndex = parseInt(e.dataTransfer.getData('text/component-index'));
            const toIndex = parseInt(e.target.getAttribute('data-component-index'));
            
            if (fromIndex !== toIndex && !isNaN(fromIndex) && !isNaN(toIndex)) {
                reorderComponents(fromIndex, toIndex);
            }
        }

        // 表单构建器功能
        function openFormBuilder() {
            showFormBuilderDialog();
        }

        // 显示表单构建器对话框
        function showFormBuilderDialog() {
            const dialog = document.createElement('div');
            dialog.className = 'form-builder-dialog';
            dialog.innerHTML = `
                <div class="form-builder-overlay">
                    <div class="form-builder-modal">
                        <div class="form-builder-header">
                            <h3>🏗️ 高级表单构建器</h3>
                            <button class="close-btn" onclick="closeFormBuilder()">&times;</button>
                        </div>
                        <div class="form-builder-body">
                            <div class="form-builder-sidebar">
                                <h4>字段类型</h4>
                                <div class="field-types">
                                    <div class="field-type" data-type="input-text">📝 文本输入</div>
                                    <div class="field-type" data-type="input-email">✉️ 邮箱</div>
                                    <div class="field-type" data-type="input-password">🔒 密码</div>
                                    <div class="field-type" data-type="input-number">🔢 数字</div>
                                    <div class="field-type" data-type="textarea">📄 多行文本</div>
                                    <div class="field-type" data-type="select">📋 下拉选择</div>
                                    <div class="field-type" data-type="checkbox">☑️ 复选框</div>
                                    <div class="field-type" data-type="radio">🔘 单选框</div>
                                    <div class="field-type" data-type="switch">🔀 开关</div>
                                    <div class="field-type" data-type="date">📅 日期</div>
                                    <div class="field-type" data-type="datetime">⏰ 日期时间</div>
                                    <div class="field-type" data-type="file">📎 文件上传</div>
                                </div>
                                <h4>验证规则</h4>
                                <div class="validation-rules">
                                    <div class="rule-item">
                                        <label><input type="checkbox" value="required"> 必填</label>
                                    </div>
                                    <div class="rule-item">
                                        <label><input type="checkbox" value="email"> 邮箱格式</label>
                                    </div>
                                    <div class="rule-item">
                                        <label><input type="checkbox" value="phone"> 手机号码</label>
                                    </div>
                                    <div class="rule-item">
                                        <label><input type="checkbox" value="minLength"> 最小长度</label>
                                        <input type="number" placeholder="长度" class="rule-value">
                                    </div>
                                    <div class="rule-item">
                                        <label><input type="checkbox" value="maxLength"> 最大长度</label>
                                        <input type="number" placeholder="长度" class="rule-value">
                                    </div>
                                </div>
                            </div>
                            <div class="form-builder-main">
                                <div class="form-preview" id="form-preview">
                                    <div class="form-drop-zone">
                                        <p>拖拽字段到此处构建表单</p>
                                    </div>
                                </div>
                            </div>
                            <div class="form-builder-properties">
                                <h4>字段属性</h4>
                                <div id="field-properties">
                                    <p>选择一个字段查看属性</p>
                                </div>
                            </div>
                        </div>
                        <div class="form-builder-footer">
                            <button class="btn" onclick="previewForm()">👀 预览表单</button>
                            <button class="btn" onclick="generateFormCode()">💾 生成代码</button>
                            <button class="btn primary" onclick="applyFormToEditor()">✅ 应用到编辑器</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(dialog);
            initializeFormBuilder();
        }

        // 初始化表单构建器
        function initializeFormBuilder() {
            const fieldTypes = document.querySelectorAll('.field-type');
            const dropZone = document.querySelector('.form-drop-zone');
            
            // 为字段类型添加拖拽功能
            fieldTypes.forEach(fieldType => {
                fieldType.draggable = true;
                fieldType.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('field-type', e.target.getAttribute('data-type'));
                });
            });
            
            // 为放置区域添加拖拽接收功能
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('drag-over');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
                
                const fieldType = e.dataTransfer.getData('field-type');
                if (fieldType) {
                    addFieldToForm(fieldType);
                }
            });
        }

        // 添加字段到表单
        function addFieldToForm(fieldType) {
            const formPreview = document.getElementById('form-preview');
            const fieldId = 'field_' + Date.now();
            
            const fieldConfig = getFieldConfig(fieldType);
            const fieldElement = createFieldElement(fieldId, fieldConfig);
            
            // 如果是第一个字段，清空提示文本
            const dropZone = formPreview.querySelector('.form-drop-zone');
            if (dropZone && dropZone.querySelector('p')) {
                dropZone.innerHTML = '';
            }
            
            formPreview.appendChild(fieldElement);
            
            // 为字段添加点击选择功能
            fieldElement.addEventListener('click', () => {
                selectFormField(fieldId, fieldConfig);
            });
        }

        // 获取字段配置
        function getFieldConfig(fieldType) {
            const configs = {
                'input-text': { label: '文本输入', placeholder: '请输入文本', type: 'input-text' },
                'input-email': { label: '邮箱', placeholder: '请输入邮箱', type: 'input-email' },
                'input-password': { label: '密码', placeholder: '请输入密码', type: 'input-password' },
                'input-number': { label: '数字', placeholder: '请输入数字', type: 'input-number' },
                'textarea': { label: '多行文本', placeholder: '请输入内容', type: 'textarea', rows: 3 },
                'select': { label: '下拉选择', type: 'select', options: [
                    { label: '选项1', value: 'option1' },
                    { label: '选项2', value: 'option2' }
                ]},
                'checkbox': { label: '复选框', type: 'checkbox' },
                'radio': { label: '单选框', type: 'radio', options: [
                    { label: '选项1', value: 'option1' },
                    { label: '选项2', value: 'option2' }
                ]},
                'switch': { label: '开关', type: 'switch' },
                'date': { label: '日期', type: 'input-date' },
                'datetime': { label: '日期时间', type: 'input-datetime' },
                'file': { label: '文件上传', type: 'input-file' }
            };
            
            return configs[fieldType] || configs['input-text'];
        }

        // 创建字段元素
        function createFieldElement(fieldId, config) {
            const fieldDiv = document.createElement('div');
            fieldDiv.className = 'form-field';
            fieldDiv.setAttribute('data-field-id', fieldId);
            
            fieldDiv.innerHTML = `
                <div class="field-header">
                    <label>${config.label}</label>
                    <div class="field-actions">
                        <button class="field-btn" onclick="editField('${fieldId}')" title="编辑">✏️</button>
                        <button class="field-btn" onclick="deleteField('${fieldId}')" title="删除">🗑️</button>
                    </div>
                </div>
                <div class="field-content">
                    ${renderFieldPreview(config)}
                </div>
            `;
            
            return fieldDiv;
        }

        // 渲染字段预览
        function renderFieldPreview(config) {
            switch (config.type) {
                case 'input-text':
                case 'input-email':
                case 'input-password':
                case 'input-number':
                    return `<input type="${config.type.replace('input-', '')}" placeholder="${config.placeholder}" disabled>`;
                case 'textarea':
                    return `<textarea placeholder="${config.placeholder}" rows="${config.rows || 3}" disabled></textarea>`;
                case 'select':
                    const options = config.options.map(opt => `<option value="${opt.value}">${opt.label}</option>`).join('');
                    return `<select disabled>${options}</select>`;
                case 'checkbox':
                    return `<input type="checkbox" disabled> ${config.label}`;
                case 'radio':
                    return config.options.map(opt => 
                        `<label><input type="radio" name="radio_${Date.now()}" value="${opt.value}" disabled> ${opt.label}</label>`
                    ).join('<br>');
                case 'switch':
                    return `<label class="switch"><input type="checkbox" disabled><span class="slider"></span></label>`;
                case 'input-date':
                case 'input-datetime':
                    return `<input type="${config.type.replace('input-', '')}" disabled>`;
                case 'input-file':
                    return `<input type="file" disabled>`;
                default:
                    return `<input type="text" placeholder="${config.placeholder}" disabled>`;
            }
        }

        // 选择表单字段
        function selectFormField(fieldId, config) {
            // 移除其他字段的选中状态
            document.querySelectorAll('.form-field').forEach(field => {
                field.classList.remove('selected');
            });
            
            // 添加当前字段的选中状态
            const fieldElement = document.querySelector(`[data-field-id="${fieldId}"]`);
            fieldElement.classList.add('selected');
            
            // 显示字段属性
            showFieldProperties(fieldId, config);
        }

        // 显示字段属性
        function showFieldProperties(fieldId, config) {
            const propertiesPanel = document.getElementById('field-properties');
            
            // 预计算checked状态
            const checkedState = config.required ? ' checked="checked"' : '';
            
            propertiesPanel.innerHTML = `
                <div class="property-group">
                    <label>字段名称</label>
                    <input type="text" id="field-name-${fieldId}" value="${config.name || ''}" placeholder="字段名称">
                </div>
                <div class="property-group">
                    <label>标签文本</label>
                    <input type="text" id="field-label-${fieldId}" value="${config.label}" placeholder="标签文本">
                </div>
                <div class="property-group">
                    <label>占位符</label>
                    <input type="text" id="field-placeholder-${fieldId}" value="${config.placeholder || ''}" placeholder="占位符">
                </div>
                <div class="property-group">
                    <label><input type="checkbox" id="field-required-${fieldId}"${checkedState}> 必填字段</label>
                </div>
                <div class="property-actions">
                    <button class="btn" onclick="updateFieldProperties('${fieldId}')">更新属性</button>
                </div>
            `;
        }

        // 更新字段属性
        function updateFieldProperties(fieldId) {
            const name = document.getElementById(`field-name-${fieldId}`).value;
            const label = document.getElementById(`field-label-${fieldId}`).value;
            const placeholder = document.getElementById(`field-placeholder-${fieldId}`).value;
            const required = document.getElementById(`field-required-${fieldId}`).checked;
            
            // 更新字段显示
            const fieldElement = document.querySelector(`[data-field-id="${fieldId}"]`);
            const labelElement = fieldElement.querySelector('label');
            labelElement.textContent = label + (required ? ' *' : '');
            
            showStatus('字段属性已更新', 'success');
        }

        // 删除字段
        function deleteField(fieldId) {
            if (confirm('确定要删除这个字段吗？')) {
                const fieldElement = document.querySelector(`[data-field-id="${fieldId}"]`);
                fieldElement.remove();
                
                // 清空属性面板
                document.getElementById('field-properties').innerHTML = '<p>选择一个字段查看属性</p>';
                
                showStatus('字段已删除', 'info');
            }
        }

        // 生成表单代码
        function generateFormCode() {
            const fields = Array.from(document.querySelectorAll('.form-field')).map(fieldElement => {
                const fieldId = fieldElement.getAttribute('data-field-id');
                const label = fieldElement.querySelector('label').textContent.replace(' *', '');
                const type = fieldElement.querySelector('input, textarea, select').type || 'text';
                
                return {
                    type: type === 'text' ? 'input-text' : type,
                    name: fieldId,
                    label: label,
                    required: label.includes('*')
                };
            });
            
            const formSchema = {
                type: 'form',
                title: '自定义表单',
                body: fields
            };
            
            // 显示生成的代码
            const codeDialog = document.createElement('div');
            codeDialog.className = 'code-dialog';
            codeDialog.innerHTML = `
                <div class="code-overlay">
                    <div class="code-modal">
                        <div class="code-header">
                            <h3>生成的表单代码</h3>
                            <button onclick="this.closest('.code-dialog').remove()">&times;</button>
                        </div>
                        <div class="code-body">
                            <textarea readonly style="width: 100%; height: 300px; font-family: monospace;">${JSON.stringify(formSchema, null, 2)}</textarea>
                        </div>
                        <div class="code-footer">
                            <button class="btn" onclick="copyToClipboard(this)">📋 复制代码</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(codeDialog);
        }

        // 应用表单到编辑器
        function applyFormToEditor() {
            const fields = Array.from(document.querySelectorAll('.form-field')).map(fieldElement => {
                const fieldId = fieldElement.getAttribute('data-field-id');
                const label = fieldElement.querySelector('label').textContent.replace(' *', '');
                const type = fieldElement.querySelector('input, textarea, select').type || 'text';
                
                return {
                    type: type === 'text' ? 'input-text' : type,
                    name: fieldId,
                    label: label,
                    required: label.includes('*')
                };
            });
            
            if (fields.length === 0) {
                showStatus('请先添加字段到表单', 'error');
                return;
            }
            
            // 生成完整的表单Schema
            const formSchema = {
                type: 'form',
                title: '自定义表单',
                mode: 'horizontal',
                body: fields,
                actions: [
                    {
                        type: 'submit',
                        label: '提交',
                        level: 'primary'
                    },
                    {
                        type: 'reset',
                        label: '重置'
                    }
                ]
            };
            
            // 添加到当前Schema
            currentSchema.body = currentSchema.body || [];
            currentSchema.body.push(formSchema);
            
            // 关闭表单构建器
            closeFormBuilder();
            
            // 重新渲染
            renderContent();
            
            showStatus('表单已添加到编辑器', 'success');
        }

        // 关闭表单构建器
        function closeFormBuilder() {
            const dialog = document.querySelector('.form-builder-dialog');
            if (dialog) {
                dialog.remove();
            }
        }

        // 复制到剪贴板
        function copyToClipboard(button) {
            const textarea = button.closest('.code-modal').querySelector('textarea');
            textarea.select();
            document.execCommand('copy');
            showStatus('代码已复制到剪贴板', 'success');
        }

        // 属性检查器功能
        function openPropertyInspector() {
            const inspector = document.getElementById('propertyInspector');
            inspector.classList.add('show');
            propertyInspectorVisible = true;
            
            if (selectedComponent) {
                loadComponentProperties(selectedComponent);
            } else {
                showStatus('请先选择一个组件', 'warning');
            }
        }

        function closePropertyInspector() {
            const inspector = document.getElementById('propertyInspector');
            inspector.classList.remove('show');
            propertyInspectorVisible = false;
        }

        function switchInspectorTab(tabElement, tabName) {
            // 切换标签激活状态
            document.querySelectorAll('.property-tab').forEach(tab => tab.classList.remove('active'));
            tabElement.classList.add('active');
            
            // 切换内容显示
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        function loadComponentProperties(component) {
            currentInspectedComponent = component;
            
            // 加载基础属性
            document.getElementById('component-type').value = component.type || '';
            document.getElementById('component-name').value = component.name || '';
            document.getElementById('component-title').value = component.title || component.label || '';
            document.getElementById('component-description').value = component.description || '';
            
            // 加载显示控制
            document.getElementById('component-visible').checked = component.visible !== false;
            document.getElementById('component-disabled').checked = component.disabled === true;
            document.getElementById('component-hidden').checked = component.hidden === true;
            
            // 加载样式属性
            document.getElementById('component-class').value = component.className || '';
            document.getElementById('component-style').value = component.style ? JSON.stringify(component.style) : '';
            document.getElementById('component-width').value = component.width || '';
            document.getElementById('component-height').value = component.height || '';
            
            // 加载外观设置
            if (component.style) {
                document.getElementById('component-bg-color').value = component.style.backgroundColor || '#ffffff';
                document.getElementById('component-text-color').value = component.style.color || '#333333';
                document.getElementById('component-border').value = component.style.border || '';
                document.getElementById('component-radius').value = component.style.borderRadius || '';
            }
            
            // 加载数据绑定
            document.getElementById('component-api').value = component.api || '';
            document.getElementById('component-source').value = component.source || '';
            document.getElementById('component-data').value = component.data ? JSON.stringify(component.data) : '';
            
            // 加载事件处理
            document.getElementById('component-onclick').value = component.onClick || '';
            document.getElementById('component-ondblclick').value = component.onDoubleClick || '';
            document.getElementById('component-onhover').value = component.onHover || '';
            document.getElementById('component-onchange').value = component.onChange || '';
            document.getElementById('component-onfocus').value = component.onFocus || '';
            document.getElementById('component-onblur').value = component.onBlur || '';
            
            // 加载字段绑定
            loadFieldBindings(component);
            
            showStatus('组件属性已加载', 'success');
        }

        function loadFieldBindings(component) {
            const bindingsContainer = document.getElementById('field-bindings');
            bindingsContainer.innerHTML = '';
            
            const bindings = componentBindings.get(component) || [];
            
            if (bindings.length === 0) {
                bindingsContainer.innerHTML = '<p style="color: #999; font-size: 13px;">暂无字段绑定</p>';
                return;
            }
            
            bindings.forEach((binding, index) => {
                const bindingElement = document.createElement('div');
                bindingElement.className = 'binding-item';
                
                // 预先计算选择状态
                const textSelected = binding.type === 'text' ? ' selected="selected"' : '';
                const numberSelected = binding.type === 'number' ? ' selected="selected"' : '';
                const dateSelected = binding.type === 'date' ? ' selected="selected"' : '';
                const imageSelected = binding.type === 'image' ? ' selected="selected"' : '';
                const linkSelected = binding.type === 'link' ? ' selected="selected"' : '';
                
                bindingElement.innerHTML = `
                    <h5>绑定 ${index + 1}</h5>
                    <div style="display: flex; gap: 8px; margin-bottom: 6px;">
                        <input type="text" placeholder="字段名" value="${binding.field}" 
                               onchange="updateBinding(${index}, 'field', this.value)" style="flex: 1;">
                        <input type="text" placeholder="绑定路径" value="${binding.path}" 
                               onchange="updateBinding(${index}, 'path', this.value)" style="flex: 1;">
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <select onchange="updateBinding(${index}, 'type', this.value)" style="flex: 1;">
                            <option value="text"${textSelected}>文本</option>
                            <option value="number"${numberSelected}>数字</option>
                            <option value="date"${dateSelected}>日期</option>
                            <option value="image"${imageSelected}>图片</option>
                            <option value="link"${linkSelected}>链接</option>
                        </select>
                        <button class="mini-btn" onclick="removeBinding(${index})" style="color: #ff4d4f;">删除</button>
                    </div>
                `;
                bindingsContainer.appendChild(bindingElement);
            });
        }

        function addFieldBinding() {
            if (!currentInspectedComponent) return;
            
            const bindings = componentBindings.get(currentInspectedComponent) || [];
            bindings.push({
                field: '',
                path: '',
                type: 'text'
            });
            componentBindings.set(currentInspectedComponent, bindings);
            
            loadFieldBindings(currentInspectedComponent);
        }

        function updateBinding(index, property, value) {
            if (!currentInspectedComponent) return;
            
            const bindings = componentBindings.get(currentInspectedComponent) || [];
            if (bindings[index]) {
                bindings[index][property] = value;
                componentBindings.set(currentInspectedComponent, bindings);
            }
        }

        function removeBinding(index) {
            if (!currentInspectedComponent) return;
            
            const bindings = componentBindings.get(currentInspectedComponent) || [];
            bindings.splice(index, 1);
            componentBindings.set(currentInspectedComponent, bindings);
            
            loadFieldBindings(currentInspectedComponent);
        }

        function clearBindings() {
            if (!currentInspectedComponent) return;
            
            componentBindings.set(currentInspectedComponent, []);
            loadFieldBindings(currentInspectedComponent);
        }

        function applyInspectorChanges() {
            if (!currentInspectedComponent) {
                showStatus('没有选中的组件', 'error');
                return;
            }
            
            try {
                // 应用基础属性
                currentInspectedComponent.name = document.getElementById('component-name').value;
                currentInspectedComponent.title = document.getElementById('component-title').value;
                currentInspectedComponent.description = document.getElementById('component-description').value;
                
                // 应用显示控制
                currentInspectedComponent.visible = document.getElementById('component-visible').checked;
                currentInspectedComponent.disabled = document.getElementById('component-disabled').checked;
                currentInspectedComponent.hidden = document.getElementById('component-hidden').checked;
                
                // 应用样式属性
                currentInspectedComponent.className = document.getElementById('component-class').value;
                
                const styleText = document.getElementById('component-style').value;
                if (styleText) {
                    try {
                        currentInspectedComponent.style = JSON.parse(styleText);
                    } catch (e) {
                        console.warn('样式JSON格式错误:', e);
                    }
                } else {
                    currentInspectedComponent.style = {};
                }
                
                currentInspectedComponent.width = document.getElementById('component-width').value;
                currentInspectedComponent.height = document.getElementById('component-height').value;
                
                // 应用外观设置
                if (!currentInspectedComponent.style) currentInspectedComponent.style = {};
                currentInspectedComponent.style.backgroundColor = document.getElementById('component-bg-color').value;
                currentInspectedComponent.style.color = document.getElementById('component-text-color').value;
                currentInspectedComponent.style.border = document.getElementById('component-border').value;
                currentInspectedComponent.style.borderRadius = document.getElementById('component-radius').value;
                
                // 应用数据绑定
                currentInspectedComponent.api = document.getElementById('component-api').value;
                currentInspectedComponent.source = document.getElementById('component-source').value;
                
                const dataText = document.getElementById('component-data').value;
                if (dataText) {
                    try {
                        currentInspectedComponent.data = JSON.parse(dataText);
                    } catch (e) {
                        console.warn('数据JSON格式错误:', e);
                    }
                }
                
                // 应用事件处理
                currentInspectedComponent.onClick = document.getElementById('component-onclick').value;
                currentInspectedComponent.onDoubleClick = document.getElementById('component-ondblclick').value;
                currentInspectedComponent.onHover = document.getElementById('component-onhover').value;
                currentInspectedComponent.onChange = document.getElementById('component-onchange').value;
                currentInspectedComponent.onFocus = document.getElementById('component-onfocus').value;
                currentInspectedComponent.onBlur = document.getElementById('component-onblur').value;
                
                // 重新渲染页面
                renderContent();
                
                showStatus('组件属性已应用', 'success');
            } catch (error) {
                console.error('应用属性失败:', error);
                showStatus('应用属性失败: ' + error.message, 'error');
            }
        }

        function resetInspectorProperties() {
            if (!currentInspectedComponent) return;
            
            // 重置为默认值
            const defaultComponent = getDefaultComponentProps(currentInspectedComponent.type);
            Object.assign(currentInspectedComponent, defaultComponent);
            
            // 重新加载属性
            loadComponentProperties(currentInspectedComponent);
            
            // 重新渲染
            renderContent();
            
            showStatus('组件属性已重置', 'success');
        }

        function getDefaultComponentProps(type) {
            const defaults = {
                'page': { type: 'page', title: '页面', body: [] },
                'card': { type: 'card', header: { title: '卡片标题' }, body: '卡片内容' },
                'form': { type: 'form', title: '表单', body: [] },
                'input-text': { type: 'input-text', label: '文本', name: 'text' },
                'textarea': { type: 'textarea', label: '多行文本', name: 'textarea' },
                'select': { type: 'select', label: '选择器', name: 'select', options: [] },
                'table': { type: 'table', title: '数据表格', columns: [] },
                'alert': { type: 'alert', body: '提示信息', level: 'info' },
                'button': { type: 'button', label: '按钮', actionType: 'button' },
                'crud': { type: 'crud', api: '/api/data', columns: [] }
            };
            return defaults[type] || { type: type };
        }

        // Schema导出导入功能
        let schemaVersions = JSON.parse(localStorage.getItem('ddd-schema-versions') || '[]');

        function exportSchema() {
            const exportData = {
                version: generateVersion(),
                timestamp: new Date().toISOString(),
                schema: currentSchema,
                metadata: {
                    title: currentSchema.title || '未命名页面',
                    description: '由DDD平台编辑器生成',
                    components: countComponents(currentSchema),
                    bindings: Array.from(componentBindings.entries())
                }
            };

            // 保存到历史版本
            schemaVersions.unshift(exportData);
            if (schemaVersions.length > 10) {
                schemaVersions = schemaVersions.slice(0, 10);
            }
            localStorage.setItem('ddd-schema-versions', JSON.stringify(schemaVersions));

            // 下载JSON文件
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { 
                type: 'application/json' 
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ddd-schema-${exportData.version}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showStatus(`Schema已导出 (版本: ${exportData.version})`, 'success');
        }

        function generateVersion() {
            const now = new Date();
            return `v${now.getFullYear()}.${(now.getMonth() + 1).toString().padStart(2, '0')}.${now.getDate().toString().padStart(2, '0')}-${now.getHours().toString().padStart(2, '0')}${now.getMinutes().toString().padStart(2, '0')}`;
        }

        function countComponents(schema) {
            let count = 0;
            if (schema.body && Array.isArray(schema.body)) {
                count += schema.body.length;
                schema.body.forEach(component => {
                    if (component.body && Array.isArray(component.body)) {
                        count += countComponents(component);
                    }
                });
            }
            return count;
        }

        function openImportDialog() {
            const importDialog = document.createElement('div');
            importDialog.className = 'form-builder-dialog';
            importDialog.innerHTML = `
                <div class="form-builder-overlay">
                    <div class="form-builder-modal" style="height: 70%; max-width: 900px;">
                        <div class="form-builder-header">
                            <h3>📥 导入Schema</h3>
                            <button class="close-btn" onclick="closeImportDialog()">×</button>
                        </div>
                        <div class="form-builder-body" style="flex-direction: column;">
                            <div class="property-tabs">
                                <div class="property-tab active" onclick="switchImportTab(this, 'file')">文件导入</div>
                                <div class="property-tab" onclick="switchImportTab(this, 'history')">历史版本</div>
                                <div class="property-tab" onclick="switchImportTab(this, 'template')">模板库</div>
                            </div>
                            
                            <!-- 文件导入 -->
                            <div class="tab-content active" id="import-file-tab" style="padding: 20px;">
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: bold;">选择JSON文件</label>
                                    <input type="file" id="schema-file-input" accept=".json" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: bold;">或粘贴JSON内容</label>
                                    <textarea id="schema-text-input" placeholder="在此粘贴Schema JSON内容..." style="width: 100%; height: 200px; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace; font-size: 13px;"></textarea>
                                </div>
                                <div>
                                    <div class="property-checkbox">
                                        <input type="checkbox" id="merge-schema">
                                        <label for="merge-schema">合并到当前Schema（不选择则替换）</label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 历史版本 -->
                            <div class="tab-content" id="import-history-tab" style="padding: 20px;">
                                <div id="version-list">
                                    <p style="color: #999;">加载历史版本中...</p>
                                </div>
                            </div>
                            
                            <!-- 模板库 -->
                            <div class="tab-content" id="import-template-tab" style="padding: 20px;">
                                <div id="template-list">
                                    <p style="color: #999;">加载模板库中...</p>
                                </div>
                            </div>
                        </div>
                        <div class="form-builder-footer">
                            <button class="btn" onclick="importSchema()" style="background: #52c41a; color: white;">导入Schema</button>
                            <button class="btn" onclick="closeImportDialog()">取消</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(importDialog);
            
            // 加载历史版本和模板
            setTimeout(() => {
                loadVersionHistory();
                loadTemplateLibrary();
                setupFileInput();
            }, 100);
        }

        function switchImportTab(tabElement, tabName) {
            document.querySelectorAll('.property-tab').forEach(tab => tab.classList.remove('active'));
            tabElement.classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById('import-' + tabName + '-tab').classList.add('active');
        }

        function setupFileInput() {
            const fileInput = document.getElementById('schema-file-input');
            fileInput.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('schema-text-input').value = e.target.result;
                    };
                    reader.readAsText(file);
                }
            });
        }

        function loadVersionHistory() {
            const versionList = document.getElementById('version-list');
            if (schemaVersions.length === 0) {
                versionList.innerHTML = '<p style="color: #999;">暂无历史版本</p>';
                return;
            }
            
            const versionsHtml = schemaVersions.map((version, index) => `
                <div class="version-item" style="border: 1px solid #e8e8e8; border-radius: 6px; padding: 12px; margin-bottom: 8px; cursor: pointer;" onclick="selectVersion(${index})">
                    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 6px;">
                        <strong style="color: #1890ff;">${version.version}</strong>
                        <span style="color: #999; font-size: 12px;">${new Date(version.timestamp).toLocaleString()}</span>
                    </div>
                    <div style="color: #666; font-size: 13px; margin-bottom: 4px;">${version.metadata.title}</div>
                    <div style="color: #999; font-size: 12px;">组件数量: ${version.metadata.components}</div>
                </div>
            `).join('');
            
            versionList.innerHTML = versionsHtml;
        }

        function loadTemplateLibrary() {
            const templateList = document.getElementById('template-list');
            const templates = [
                {
                    name: 'DDD用户聚合',
                    description: '用户领域聚合根设计示例',
                    schema: {
                        type: 'page',
                        title: '用户聚合 - User Aggregate',
                        body: [
                            {
                                type: 'card',
                                header: { title: '👤 用户聚合根', subTitle: 'User Aggregate Root' },
                                body: {
                                    type: 'form',
                                    mode: 'horizontal',
                                    body: [
                                        { type: 'input-text', name: 'userId', label: '用户ID', required: true, disabled: true },
                                        { type: 'input-text', name: 'username', label: '用户名', required: true },
                                        { type: 'input-email', name: 'email', label: '邮箱', required: true },
                                        { type: 'select', name: 'status', label: '状态', options: [
                                            { label: '活跃', value: 'active' },
                                            { label: '禁用', value: 'disabled' },
                                            { label: '待激活', value: 'pending' }
                                        ]},
                                        { type: 'datetime', name: 'createdAt', label: '创建时间', disabled: true },
                                        { type: 'datetime', name: 'lastLoginAt', label: '最后登录', disabled: true }
                                    ]
                                }
                            },
                            {
                                type: 'card',
                                header: { title: '🎯 用户行为事件', subTitle: 'Domain Events' },
                                body: {
                                    type: 'table',
                                    data: {
                                        items: [
                                            { event: 'UserCreated', description: '用户创建事件', status: '已处理' },
                                            { event: 'UserActivated', description: '用户激活事件', status: '已处理' },
                                            { event: 'UserLoggedIn', description: '用户登录事件', status: '已处理' }
                                        ]
                                    },
                                    columns: [
                                        { name: 'event', label: '事件类型' },
                                        { name: 'description', label: '事件描述' },
                                        { name: 'status', label: '状态', type: 'status' }
                                    ]
                                }
                            }
                        ]
                    }
                },
                {
                    name: 'DDD订单处理',
                    description: '订单领域完整业务流程',
                    schema: {
                        type: 'page',
                        title: '订单处理系统',
                        body: [
                            {
                                type: 'grid',
                                columns: [
                                    {
                                        md: 6,
                                        body: {
                                            type: 'card',
                                            header: { title: '📋 订单信息', subTitle: 'Order Entity' },
                                            body: {
                                                type: 'form',
                                                body: [
                                                    { type: 'input-text', name: 'orderId', label: '订单ID', disabled: true },
                                                    { type: 'input-text', name: 'customerId', label: '客户ID', required: true },
                                                    { type: 'input-number', name: 'totalAmount', label: '订单金额', required: true },
                                                    { type: 'select', name: 'status', label: '订单状态', options: [
                                                        { label: '待支付', value: 'pending' },
                                                        { label: '已支付', value: 'paid' },
                                                        { label: '已发货', value: 'shipped' },
                                                        { label: '已完成', value: 'completed' },
                                                        { label: '已取消', value: 'cancelled' }
                                                    ]}
                                                ]
                                            }
                                        }
                                    },
                                    {
                                        md: 6,
                                        body: {
                                            type: 'card',
                                            header: { title: '🛍️ 订单明细', subTitle: 'Order Items' },
                                            body: {
                                                type: 'table',
                                                data: {
                                                    items: [
                                                        { productId: 'P001', productName: '商品A', quantity: 2, price: 99.99 },
                                                        { productId: 'P002', productName: '商品B', quantity: 1, price: 149.99 }
                                                    ]
                                                },
                                                columns: [
                                                    { name: 'productId', label: '商品ID' },
                                                    { name: 'productName', label: '商品名称' },
                                                    { name: 'quantity', label: '数量' },
                                                    { name: 'price', label: '单价', type: 'number' }
                                                ]
                                            }
                                        }
                                    }
                                ]
                            },
                            {
                                type: 'card',
                                header: { title: '⚙️ 订单服务', subTitle: 'Order Domain Services' },
                                body: {
                                    type: 'form',
                                    mode: 'horizontal',
                                    body: [
                                        { type: 'input-text', name: 'serviceName', label: '服务名称', value: 'OrderProcessingService' },
                                        { type: 'textarea', name: 'methods', label: '服务方法', rows: 4, value: 'createOrder()\nprocessPayment()\nshipOrder()\ncancelOrder()' },
                                        { type: 'input-text', name: 'repository', label: '仓储接口', value: 'OrderRepository' }
                                    ]
                                }
                            }
                        ]
                    }
                },
                {
                    name: 'DDD库存管理',
                    description: '库存领域边界上下文',
                    schema: {
                        type: 'page',
                        title: '库存管理系统',
                        body: [
                            {
                                type: 'crud',
                                api: '/api/inventory',
                                title: '库存管理',
                                headerToolbar: [
                                    { type: 'button', label: '入库', actionType: 'dialog', level: 'primary' },
                                    { type: 'button', label: '出库', actionType: 'dialog', level: 'warning' }
                                ],
                                columns: [
                                    { name: 'productId', label: '商品ID', sortable: true },
                                    { name: 'productName', label: '商品名称', searchable: true },
                                    { name: 'currentStock', label: '当前库存', type: 'number' },
                                    { name: 'reservedStock', label: '预占库存', type: 'number' },
                                    { name: 'availableStock', label: '可用库存', type: 'number' },
                                    { name: 'minThreshold', label: '最低阈值', type: 'number' },
                                    { name: 'status', label: '状态', type: 'status' },
                                    { type: 'operation', label: '操作', buttons: [
                                        { label: '调整库存', level: 'link' },
                                        { label: '库存明细', level: 'link' }
                                    ]}
                                ]
                            }
                        ]
                    }
                },
                {
                    name: 'DDD数据仪表板',
                    description: '领域数据统计和可视化',
                    schema: {
                        type: 'page',
                        title: 'DDD业务仪表板',
                        body: [
                            {
                                type: 'grid',
                                columns: [
                                    {
                                        md: 3,
                                        body: {
                                            type: 'stat',
                                            title: '总实体数',
                                            value: '156',
                                            description: '系统中的领域实体总数',
                                            trend: '12.5%',
                                            trendValue: '+20'
                                        }
                                    },
                                    {
                                        md: 3,
                                        body: {
                                            type: 'stat',
                                            title: '活跃聚合',
                                            value: '42',
                                            description: '当前活跃的聚合根',
                                            trend: '8.2%',
                                            trendValue: '+3'
                                        }
                                    },
                                    {
                                        md: 3,
                                        body: {
                                            type: 'stat',
                                            title: '领域事件',
                                            value: '1,234',
                                            description: '本月处理的领域事件',
                                            trend: '15.6%',
                                            trendValue: '+189'
                                        }
                                    },
                                    {
                                        md: 3,
                                        body: {
                                            type: 'stat',
                                            title: '边界上下文',
                                            value: '8',
                                            description: '定义的边界上下文数量',
                                            trend: '0%',
                                            trendValue: '0'
                                        }
                                    }
                                ]
                            },
                            {
                                type: 'chart',
                                title: '领域事件处理趋势',
                                config: {
                                    type: 'line',
                                    data: {
                                        labels: ['1月', '2月', '3月', '4月', '5月', '6月'],
                                        datasets: [{
                                            label: '事件数量',
                                            data: [120, 190, 300, 500, 200, 300],
                                            borderColor: 'rgb(75, 192, 192)',
                                            tension: 0.1
                                        }]
                                    }
                                }
                            }
                        ]
                    }
                }
            ];
            
            const templatesHtml = templates.map((template, index) => `
                <div class="template-item" style="border: 1px solid #e8e8e8; border-radius: 6px; padding: 12px; margin-bottom: 8px; cursor: pointer;" onclick="selectTemplate(${index})">
                    <div style="font-weight: bold; color: #1890ff; margin-bottom: 6px;">${template.name}</div>
                    <div style="color: #666; font-size: 13px;">${template.description}</div>
                </div>
            `).join('');
            
            templateList.innerHTML = templatesHtml;
            
            // 存储模板数据
            window.templateLibrary = templates;
        }

        function selectVersion(index) {
            const version = schemaVersions[index];
            document.getElementById('schema-text-input').value = JSON.stringify(version.schema, null, 2);
            
            // 切换到文件导入标签
            document.querySelector('.property-tab').click();
        }

        function selectTemplate(index) {
            const template = window.templateLibrary[index];
            document.getElementById('schema-text-input').value = JSON.stringify(template.schema, null, 2);
            
            // 切换到文件导入标签
            document.querySelector('.property-tab').click();
        }

        function importSchema() {
            const schemaText = document.getElementById('schema-text-input').value;
            const mergeMode = document.getElementById('merge-schema').checked;
            
            if (!schemaText.trim()) {
                showStatus('请输入或选择Schema内容', 'error');
                return;
            }
            
            try {
                const importedData = JSON.parse(schemaText);
                let newSchema;
                
                // 判断是否是导出的完整格式
                if (importedData.schema && importedData.version) {
                    newSchema = importedData.schema;
                    // 恢复组件绑定
                    if (importedData.metadata && importedData.metadata.bindings) {
                        componentBindings = new Map(importedData.metadata.bindings);
                    }
                } else {
                    newSchema = importedData;
                }
                
                if (mergeMode && currentSchema.body) {
                    // 合并模式：添加到现有Schema
                    if (newSchema.body && Array.isArray(newSchema.body)) {
                        currentSchema.body.push(...newSchema.body);
                    }
                } else {
                    // 替换模式：完全替换当前Schema
                    currentSchema = newSchema;
                }
                
                // 重新渲染
                renderContent();
                
                // 关闭对话框
                closeImportDialog();
                
                showStatus('Schema导入成功！', 'success');
                
            } catch (error) {
                console.error('导入失败:', error);
                showStatus('Schema格式错误，请检查JSON格式', 'error');
            }
        }

        function closeImportDialog() {
            const dialog = document.querySelector('.form-builder-dialog');
            if (dialog) {
                dialog.remove();
            }
        }

        // 代码生成器功能
        let currentGeneratorTab = 'component';
        let generatedCodeCache = {};

        function openCodeGenerator() {
            const generator = document.getElementById('codeGenerator');
            generator.classList.add('show');
            
            // 初始化代码生成器
            updateGeneratorOptions();
        }

        function closeCodeGenerator() {
            const generator = document.getElementById('codeGenerator');
            generator.classList.remove('show');
        }

        function switchGeneratorTab(tabElement, tabName) {
            // 切换标签激活状态
            document.querySelectorAll('.generator-tab').forEach(tab => tab.classList.remove('active'));
            tabElement.classList.add('active');
            
            currentGeneratorTab = tabName;
            
            // 显示对应的代码
            if (generatedCodeCache[tabName]) {
                document.getElementById('generated-code').value = generatedCodeCache[tabName];
                updateCodeStats();
            }
        }

        function updateGeneratorOptions() {
            const outputType = document.getElementById('output-type').value;
            const frameworkVersion = document.getElementById('framework-version');
            
            // 根据输出类型更新框架版本选项
            frameworkVersion.innerHTML = '';
            
            switch (outputType) {
                case 'react':
                    frameworkVersion.innerHTML = `
                        <option value="18">React 18</option>
                        <option value="17">React 17</option>
                        <option value="16">React 16</option>
                    `;
                    break;
                case 'vue':
                    frameworkVersion.innerHTML = `
                        <option value="3">Vue 3</option>
                        <option value="2">Vue 2</option>
                    `;
                    break;
                case 'angular':
                    frameworkVersion.innerHTML = `
                        <option value="16">Angular 16</option>
                        <option value="15">Angular 15</option>
                        <option value="14">Angular 14</option>
                    `;
                    break;
                default:
                    frameworkVersion.innerHTML = `
                        <option value="latest">最新版本</option>
                        <option value="stable">稳定版本</option>
                    `;
            }
        }

        function generateCode() {
            const config = getGeneratorConfig();
            showLoading('正在生成代码...');
            
            try {
                // 生成不同类型的代码
                generatedCodeCache = {
                    component: generateComponentCode(config),
                    style: generateStyleCode(config),
                    test: generateTestCode(config),
                    story: generateStoryCode(config),
                    api: generateApiCode(config)
                };
                
                // 显示当前标签的代码
                const currentCode = generatedCodeCache[currentGeneratorTab];
                document.getElementById('generated-code').value = currentCode;
                
                updateCodeStats();
                hideLoading();
                showStatus('代码生成完成！', 'success');
                
            } catch (error) {
                console.error('代码生成失败:', error);
                hideLoading();
                showStatus('代码生成失败: ' + error.message, 'error');
            }
        }

        function getGeneratorConfig() {
            return {
                outputType: document.getElementById('output-type').value,
                frameworkVersion: document.getElementById('framework-version').value,
                namingStyle: document.getElementById('naming-style').value,
                typescript: document.getElementById('typescript-enabled').value === 'true',
                styling: document.getElementById('styling-solution').value,
                includeTests: document.getElementById('include-tests').checked,
                includeStories: document.getElementById('include-stories').checked,
                includeDocs: document.getElementById('include-docs').checked,
                responsive: document.getElementById('responsive-design').checked,
                schema: currentSchema
            };
        }

        function generateComponentCode(config) {
            if (config.outputType === 'react') {
                return generateReactComponent(config);
            } else if (config.outputType === 'vue') {
                return generateVueComponent(config);
            } else if (config.outputType === 'angular') {
                return generateAngularComponent(config);
            } else if (config.outputType === 'html') {
                return generateHtmlPage(config);
            } else if (config.outputType === 'api') {
                return generateApiCode(config);
            } else if (config.outputType === 'model') {
                return generateModelCode(config);
            }
            return '// 暂不支持该类型的代码生成';
        }

        function generateReactComponent(config) {
            const componentName = formatName(config.schema.title || 'DDDComponent', config.namingStyle, true);
            const isTypescript = config.typescript;
            
            let imports = 'import React from \'react\';\n';
            
            if (config.styling === 'styled-components') {
                imports += 'import styled from \'styled-components\';\n';
            } else if (config.styling === 'emotion') {
                imports += 'import styled from \'@emotion/styled\';\n';
            }
            
            const interfaceCode = generateInterfaceCode(config);
            const className = config.styling === 'tailwind' ? 'bg-white p-6 rounded-lg shadow-lg' : 'ddd-component';
            const titleClassName = config.styling === 'tailwind' ? 'text-2xl font-bold mb-4' : 'title';
            const title = config.schema.title || 'DDD Component';
            const jsxContent = generateJSXFromSchema(config.schema, config);
            const typeAnnotation = isTypescript ? ': React.FC<' + componentName + 'Props>' : '';
            const params = isTypescript ? '{ data }' : 'props';
            
            let componentCode = '\n' +
                imports + '\n' +
                interfaceCode + '\n\n' +
                'const ' + componentName + typeAnnotation + ' = (' + params + ') => {\n' +
                '  return (\n' +
                '    <div className="' + className + '">\n' +
                '      <h1 className="' + titleClassName + '">' + title + '</h1>\n' +
                '      ' + jsxContent + '\n' +
                '    </div>\n' +
                '  );\n' +
                '};\n\n' +
                'export default ' + componentName + ';\n';
            
            return componentCode;
        }

        function generateVueComponent(config) {
            const componentName = formatName(config.schema.title || 'DDDComponent', 'kebab-case');
            const scriptLang = config.typescript ? ' lang="ts"' : '';
            const title = config.schema.title || 'DDD Component';
            const vueTemplate = generateVueTemplateFromSchema(config.schema);
            
            return '<template>' +
                '<div class="ddd-component">' +
                '<h1>' + title + '</h1>' +
                vueTemplate +
                '</div>' +
                '</template>' +
                '<script' + scriptLang + '>' +
                'import { defineComponent } from "vue";' +
                'export default defineComponent({' +
                'name: "' + componentName + '",' +
                'props: { data: { type: Object, default: () => ({}) } },' +
                'setup(props) { return {}; }' +
                '});' +
                '<' + '/script>' +
                '<style scoped>' +
                '.ddd-component { padding: 24px; background: white; border-radius: 8px; }' +
                '<' + '/style>';
        }

        function generateAngularComponent(config) {
            const componentName = formatName(config.schema.title || 'DDDComponent', 'PascalCase');
            const selector = formatName(config.schema.title || 'ddd-component', 'kebab-case');
            const title = config.schema.title || 'DDD Component';
            const angularTemplate = generateAngularTemplateFromSchema(config.schema);
            
            return 'import { Component, Input } from \'@angular/core\';\n\n' +
                '@Component({\n' +
                '  selector: \'' + selector + '\',\n' +
                '  template: `\n' +
                '    <div class="ddd-component">\n' +
                '      <h1>{{ title }}</h1>\n' +
                '      ' + angularTemplate + '\n' +
                '    </div>\n' +
                '  `,\n' +
                '  styleUrls: [\'./' + selector + '.component.css\']\n' +
                '})\n' +
                'export class ' + componentName + 'Component {\n' +
                '  @Input() title: string = \'' + title + '\';\n' +
                '  @Input() data: any = {};\n' +
                '  \n' +
                '  constructor() { }\n' +
                '}';
        }

        function generateHtmlPage(config) {
            const schemaJsonString = JSON.stringify(config.schema);
            const tailwindScript = config.styling === 'tailwind' ? '<script src="https://cdn.tailwindcss.com"><' + '/script>' : '';
            
            return '<!DOCTYPE html>' +
                '<html lang="zh-CN">' +
                '<head>' +
                '<meta charset="UTF-8">' +
                '<meta name="viewport" content="width=device-width, initial-scale=1.0">' +
                '<title>' + (config.schema.title || 'DDD页面') + '</title>' +
                '<link rel="stylesheet" href="https://unpkg.com/amis@6.3.0/sdk/antd.css">' +
                '<script src="https://unpkg.com/amis@6.3.0/sdk/sdk.js"><' + '/script>' +
                tailwindScript +
                '</head>' +
                '<body>' +
                '<div id="root"></div>' +
                '<script>' +
                'const schema = ' + schemaJsonString + ';' +
                'const amisScoped = amis.embed("#root", schema);' +
                '<' + '/script>' +
                '</body>' +
                '</html>';
        }

        function generateStyleCode(config) {
            if (config.styling === 'css-modules') {
                return generateCSSModules(config);
            } else if (config.styling === 'styled-components') {
                return generateStyledComponents(config);
            } else if (config.styling === 'tailwind') {
                return generateTailwindConfig(config);
            } else if (config.styling === 'antd') {
                return generateAntdStyles(config);
            }
            return generateRegularCSS(config);
        }

        function generateTestCode(config) {
            if (config.outputType === 'react') {
                return generateReactTests(config);
            } else if (config.outputType === 'vue') {
                return generateVueTests(config);
            } else if (config.outputType === 'angular') {
                return generateAngularTests(config);
            }
            return '// 测试文件';
        }

        function generateStoryCode(config) {
            const componentName = formatName(config.schema.title || 'DDDComponent', config.namingStyle, true);
            
            return `import type { Meta, StoryObj } from '@storybook/react';
import { ${componentName} } from './${componentName}';

const meta: Meta<typeof ${componentName}> = {
  title: 'DDD Components/${componentName}',
  component: ${componentName},
  parameters: {
    layout: 'centered',
  },
  tags: ['autodocs'],
  argTypes: {
    data: { control: 'object' },
  },
};

export default meta;
type Story = StoryObj<typeof meta>;

export const Default: Story = {
  args: {
    data: ${JSON.stringify(generateMockData(config.schema), null, 2)}
  },
};

export const Empty: Story = {
  args: {
    data: {}
  },
};`;
        }

        function generateApiCode(config) {
            return generateRestAPICode(config);
        }

        function updateCodeStats() {
            const code = document.getElementById('generated-code').value;
            const lines = code.split('\n').length;
            const size = (new Blob([code]).size / 1024).toFixed(2);
            
            document.getElementById('code-line-count').textContent = lines;
            document.getElementById('code-size').textContent = size;
        }

        function copyGeneratedCode() {
            const textarea = document.getElementById('generated-code');
            textarea.select();
            document.execCommand('copy');
            showStatus('代码已复制到剪贴板', 'success');
        }

        function downloadGeneratedCode() {
            const code = document.getElementById('generated-code').value;
            const config = getGeneratorConfig();
            const fileName = getFileName(config);
            
            const blob = new Blob([code], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showStatus('文件已下载', 'success');
        }

        function previewGenerated() {
            const code = document.getElementById('generated-code').value;
            const config = getGeneratorConfig();
            
            if (config.outputType === 'html') {
                // 打开新窗口预览HTML
                const newWindow = window.open('', '_blank');
                newWindow.document.write(code);
                newWindow.document.close();
            } else {
                showStatus('该代码类型暂不支持预览', 'warning');
            }
        }

        // 模型验证器功能
        function openValidationPanel() {
            const panel = document.getElementById('validationPanel');
            panel.classList.add('show');
        }

        function closeValidationPanel() {
            const panel = document.getElementById('validationPanel');
            panel.classList.remove('show');
        }

        function validateSchema() {
            showLoading('正在验证Schema...');
            
            setTimeout(() => {
                const results = performValidation(currentSchema);
                displayValidationResults(results);
                updateValidationStats(results);
                hideLoading();
            }, 1000);
        }

        function performValidation(schema) {
            const results = [];
            let errors = 0;
            let warnings = 0;
            
            // 检查基本结构
            if (!schema.type) {
                results.push({
                    type: 'error',
                    title: '缺少类型定义',
                    message: 'Schema必须包含type属性'
                });
                errors++;
            }
            
            if (!schema.title) {
                results.push({
                    type: 'warning',
                    title: '缺少页面标题',
                    message: '建议为页面添加title属性以提升用户体验'
                });
                warnings++;
            }
            
            // 检查组件结构
            if (schema.body && Array.isArray(schema.body)) {
                schema.body.forEach((component, index) => {
                    const componentResults = validateComponent(component, index);
                    results.push(...componentResults.results);
                    errors += componentResults.errors;
                    warnings += componentResults.warnings;
                });
            }
            
            // 检查性能问题
            const componentCount = countComponents(schema);
            if (componentCount > 50) {
                results.push({
                    type: 'warning',
                    title: '组件数量过多',
                    message: `当前页面包含${componentCount}个组件，可能影响性能`
                });
                warnings++;
            }
            
            // 检查可访问性
            const accessibilityIssues = checkAccessibility(schema);
            results.push(...accessibilityIssues.results);
            warnings += accessibilityIssues.warnings;
            
            return {
                results,
                errors,
                warnings,
                totalComponents: componentCount,
                score: Math.max(0, 100 - errors * 10 - warnings * 5)
            };
        }

        function validateComponent(component, index) {
            const results = [];
            let errors = 0;
            let warnings = 0;
            
            if (!component.type) {
                results.push({
                    type: 'error',
                    title: `组件 ${index + 1} 缺少类型`,
                    message: '每个组件都必须有type属性'
                });
                errors++;
            }
            
            // 检查表单组件
            if (component.type === 'form' && component.body) {
                const formFieldsWithoutName = component.body.filter(field => 
                    field.type && field.type.includes('input') && !field.name
                );
                
                if (formFieldsWithoutName.length > 0) {
                    results.push({
                        type: 'error',
                        title: '表单字段缺少name属性',
                        message: '表单中的输入字段必须有name属性'
                    });
                    errors++;
                }
            }
            
            // 检查API配置
            if (component.api && typeof component.api === 'string' && !component.api.startsWith('/')) {
                results.push({
                    type: 'warning',
                    title: 'API路径不规范',
                    message: 'API路径建议以/开头'
                });
                warnings++;
            }
            
            return { results, errors, warnings };
        }

        function checkAccessibility(schema) {
            const results = [];
            let warnings = 0;
            
            // 检查是否有图片缺少alt属性
            const checkImageAlt = (obj) => {
                if (obj && typeof obj === 'object') {
                    if (obj.type === 'image' && !obj.alt) {
                        results.push({
                            type: 'warning',
                            title: '图片缺少alt属性',
                            message: '为了提升可访问性，建议为图片添加alt描述'
                        });
                        warnings++;
                    }
                    
                    Object.values(obj).forEach(value => {
                        if (Array.isArray(value)) {
                            value.forEach(checkImageAlt);
                        } else if (typeof value === 'object') {
                            checkImageAlt(value);
                        }
                    });
                }
            };
            
            checkImageAlt(schema);
            
            return { results, warnings };
        }

        function displayValidationResults(validationData) {
            const container = document.getElementById('validation-results');
            
            if (validationData.results.length === 0) {
                container.innerHTML = `
                    <div class="validation-result">
                        <div class="result-title">✅ 验证通过</div>
                        <div class="result-message">Schema结构完全正确，没有发现任何问题！</div>
                    </div>
                `;
                return;
            }
            
            const resultsHtml = validationData.results.map(result => `
                <div class="validation-result ${result.type}">
                    <div class="result-title">${result.type === 'error' ? '❌' : '⚠️'} ${result.title}</div>
                    <div class="result-message">${result.message}</div>
                </div>
            `).join('');
            
            container.innerHTML = resultsHtml;
        }

        function updateValidationStats(validationData) {
            document.getElementById('total-components').textContent = validationData.totalComponents;
            document.getElementById('validation-errors').textContent = validationData.errors;
            document.getElementById('validation-warnings').textContent = validationData.warnings;
            document.getElementById('validation-score').textContent = validationData.score;
        }

        function exportValidationReport() {
            const stats = {
                totalComponents: document.getElementById('total-components').textContent,
                errors: document.getElementById('validation-errors').textContent,
                warnings: document.getElementById('validation-warnings').textContent,
                score: document.getElementById('validation-score').textContent
            };
            
            const report = {
                timestamp: new Date().toISOString(),
                schema: currentSchema,
                validation: stats,
                results: Array.from(document.querySelectorAll('.validation-result')).map(el => ({
                    title: el.querySelector('.result-title').textContent,
                    message: el.querySelector('.result-message').textContent,
                    type: el.classList.contains('error') ? 'error' : 'warning'
                }))
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `validation-report-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showStatus('验证报告已导出', 'success');
        }

        function autoFixIssues() {
            showLoading('正在自动修复问题...');
            
            setTimeout(() => {
                // 自动修复一些常见问题
                fixCommonIssues(currentSchema);
                renderContent();
                hideLoading();
                showStatus('已自动修复部分问题', 'success');
                
                // 重新验证
                setTimeout(() => {
                    validateSchema();
                }, 500);
            }, 1000);
        }

        function fixCommonIssues(schema) {
            // 添加缺少的title
            if (!schema.title) {
                schema.title = 'DDD页面';
            }
            
            // 修复表单字段name问题
            const fixFormFields = (obj) => {
                if (obj && typeof obj === 'object') {
                    if (obj.type === 'form' && obj.body) {
                        obj.body.forEach((field, index) => {
                            if (field.type && field.type.includes('input') && !field.name) {
                                field.name = `field_${index}`;
                            }
                        });
                    }
                    
                    Object.values(obj).forEach(value => {
                        if (Array.isArray(value)) {
                            value.forEach(fixFormFields);
                        } else if (typeof value === 'object') {
                            fixFormFields(value);
                        }
                    });
                }
            };
            
            fixFormFields(schema);
        }

        // 辅助函数
        function formatName(name, style, isComponent = false) {
            const cleanName = name.replace(/[^a-zA-Z0-9]/g, '');
            
            switch (style) {
                case 'camelCase':
                    return cleanName.charAt(0).toLowerCase() + cleanName.slice(1);
                case 'PascalCase':
                    return cleanName.charAt(0).toUpperCase() + cleanName.slice(1);
                case 'kebab-case':
                    return cleanName.replace(/([A-Z])/g, '-$1').toLowerCase();
                case 'snake_case':
                    return cleanName.replace(/([A-Z])/g, '_$1').toLowerCase();
                default:
                    return isComponent ? 
                        cleanName.charAt(0).toUpperCase() + cleanName.slice(1) :
                        cleanName.toLowerCase();
            }
        }

        function getFileName(config) {
            const name = formatName(config.schema.title || 'DDDComponent', config.namingStyle);
            const ext = config.typescript ? '.tsx' : '.jsx';
            
            switch (currentGeneratorTab) {
                case 'component':
                    return `${name}${config.outputType === 'vue' ? '.vue' : ext}`;
                case 'style':
                    return `${name}.${config.styling === 'css-modules' ? 'module.' : ''}css`;
                case 'test':
                    return `${name}.test${ext}`;
                case 'story':
                    return `${name}.stories${ext}`;
                case 'api':
                    return `${name}.api.ts`;
                default:
                    return `${name}.${currentGeneratorTab}`;
            }
        }

        // 代码生成辅助函数
        function generateInterfaceCode(config) {
            if (!config.typescript) return '';
            
            return `interface ${formatName(config.schema.title || 'DDDComponent', 'PascalCase')}Props {
  data?: any;
  className?: string;
  style?: React.CSSProperties;
}`;
        }

        function generateJSXFromSchema(schema, config) {
            if (!schema.body || !Array.isArray(schema.body)) {
                return '<div>暂无内容</div>';
            }
            
            return schema.body.map(component => {
                switch (component.type) {
                    case 'card':
                        return `<div className="card">
          <h3>${component.header?.title || '卡片标题'}</h3>
          <p>${component.body || '卡片内容'}</p>
        </div>`;
                    case 'form':
                        return '<form className="ddd-form">' + 
                            (component.body || []).map(field => 
                                `<div className="form-field">
                                    <label>${field.label}</label>
                                    <input type="${field.type === 'input-text' ? 'text' : 'text'}" name="${field.name}" />
                                </div>`
                            ).join('\n') + 
                        '</form>';
                    case 'table':
                        return '<table className="ddd-table"><thead><tr><th>列标题</th></tr></thead><tbody><tr><td>数据</td></tr></tbody></table>';
                    default:
                        return `<div className="component-${component.type}">${component.title || component.label || '组件内容'}</div>`;
                }
            }).join('\n      ');
        }

        function generateVueTemplateFromSchema(schema) {
            if (!schema.body || !Array.isArray(schema.body)) {
                return '<div>暂无内容</div>';
            }
            
            return schema.body.map(component => {
                switch (component.type) {
                    case 'card':
                        return `<div class="card">
      <h3>${component.header?.title || '卡片标题'}</h3>
      <p>${component.body || '卡片内容'}</p>
    </div>`;
                    case 'form':
                        return '<form class="ddd-form">' + 
                            (component.body || []).map(field => 
                                `<div class="form-field">
                                    <label>${field.label}</label>
                                    <input type="${field.type === 'input-text' ? 'text' : 'text'}" :name="'${field.name}'" />
                                </div>`
                            ).join('\n') + 
                        '</form>';
                    default:
                        return `<div class="component-${component.type}">${component.title || component.label || '组件内容'}</div>`;
                }
            }).join('\n    ');
        }

        function generateAngularTemplateFromSchema(schema) {
            if (!schema.body || !Array.isArray(schema.body)) {
                return '<div>暂无内容</div>';
            }
            
            return schema.body.map(component => {
                switch (component.type) {
                    case 'card':
                        return `<div class="card">
      <h3>${component.header?.title || '卡片标题'}</h3>
      <p>${component.body || '卡片内容'}</p>
    </div>`;
                    case 'form':
                        return '<form class="ddd-form">' + 
                            (component.body || []).map(field => 
                                `<div class="form-field">
                                    <label>${field.label}</label>
                                    <input type="${field.type === 'input-text' ? 'text' : 'text'}" name="${field.name}" />
                                </div>`
                            ).join('\n') + 
                        '</form>';
                    default:
                        return `<div class="component-${component.type}">{{ data.${component.name || 'content'} }}</div>`;
                }
            }).join('\n    ');
        }

        function generateCSSModules(config) {
            return `.dddComponent {
  padding: 24px;
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.title {
  font-size: 24px;
  font-weight: bold;
  margin-bottom: 16px;
  color: #333;
}

.card {
  background: #f8f9fa;
  border: 1px solid #e9ecef;
  border-radius: 6px;
  padding: 16px;
  margin-bottom: 16px;
}

.dddForm {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.formField {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.formField label {
  font-weight: 500;
  color: #555;
}

.formField input {
  padding: 8px 12px;
  border: 1px solid #d9d9d9;
  border-radius: 4px;
}`;
        }

        function generateStyledComponents(config) {
            return `import styled from 'styled-components';

export const StyledContainer = styled.div\`
  padding: 24px;
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
\`;

export const StyledTitle = styled.h1\`
  font-size: 24px;
  font-weight: bold;
  margin-bottom: 16px;
  color: #333;
\`;

export const StyledCard = styled.div\`
  background: #f8f9fa;
  border: 1px solid #e9ecef;
  border-radius: 6px;
  padding: 16px;
  margin-bottom: 16px;
\`;

export const StyledForm = styled.form\`
  display: flex;
  flex-direction: column;
  gap: 16px;
\`;`;
        }

        function generateRegularCSS(config) {
            return `.ddd-component {
  padding: 24px;
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  ${config.responsive ? `
  
  /* 响应式设计 */
  @media (max-width: 768px) {
    padding: 16px;
  }
  
  @media (max-width: 480px) {
    padding: 12px;
  }` : ''}
}

.title {
  font-size: 24px;
  font-weight: bold;
  margin-bottom: 16px;
  color: #333;
  ${config.responsive ? `
  
  @media (max-width: 768px) {
    font-size: 20px;
  }` : ''}
}

.card {
  background: #f8f9fa;
  border: 1px solid #e9ecef;
  border-radius: 6px;
  padding: 16px;
  margin-bottom: 16px;
}

.ddd-form {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.form-field {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.form-field label {
  font-weight: 500;
  color: #555;
}

.form-field input {
  padding: 8px 12px;
  border: 1px solid #d9d9d9;
  border-radius: 4px;
  transition: border-color 0.3s;
}

.form-field input:focus {
  border-color: #1890ff;
  outline: none;
  box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
}

.ddd-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 16px;
}

.ddd-table th,
.ddd-table td {
  padding: 12px;
  text-align: left;
  border-bottom: 1px solid #e9ecef;
}

.ddd-table th {
  background: #f8f9fa;
  font-weight: 600;
}`;
        }

        function generateTailwindConfig(config) {
            return `/* Tailwind CSS 配置 */
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer components {
  .ddd-component {
    @apply p-6 bg-white rounded-lg shadow-lg;
  }
  
  .ddd-title {
    @apply text-2xl font-bold mb-4 text-gray-800;
  }
  
  .ddd-card {
    @apply bg-gray-50 border border-gray-200 rounded-md p-4 mb-4;
  }
  
  .ddd-form {
    @apply flex flex-col space-y-4;
  }
  
  .ddd-form-field {
    @apply flex flex-col space-y-1;
  }
  
  .ddd-form-label {
    @apply font-medium text-gray-700;
  }
  
  .ddd-form-input {
    @apply px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent;
  }
}`;
        }

        function generateReactTests(config) {
            const componentName = formatName(config.schema.title || 'DDDComponent', config.namingStyle, true);
            
            return `import { render, screen } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { ${componentName} } from './${componentName}';

describe('${componentName}', () => {
  const mockData = ${JSON.stringify(generateMockData(config.schema), null, 2)};

  test('renders without crashing', () => {
    render(React.createElement(${componentName}, { data: mockData }));
  });

  test('displays the correct title', () => {
    render(React.createElement(${componentName}, { data: mockData }));
    expect(screen.getByText('${config.schema.title || 'DDD Component'}')).toBeInTheDocument();
  });

  test('handles user interactions', async () => {
    const user = userEvent.setup();
    render(React.createElement(${componentName}, { data: mockData }));
    
    // Add specific interaction tests based on component type
  });

  test('matches snapshot', () => {
    const { container } = render(React.createElement(${componentName}, { data: mockData }));
    expect(container.firstChild).toMatchSnapshot();
  });
});`;
        }

        function generateVueTests(config) {
            const componentName = formatName(config.schema.title || 'DDDComponent', 'kebab-case');
            
            return `import { mount } from '@vue/test-utils';
import ${formatName(config.schema.title || 'DDDComponent', 'PascalCase')} from './${componentName}.vue';

describe('${componentName}', () => {
  const mockData = ${JSON.stringify(generateMockData(config.schema), null, 2)};

  test('renders correctly', () => {
    const wrapper = mount(${formatName(config.schema.title || 'DDDComponent', 'PascalCase')}, {
      props: {
        data: mockData
      }
    });

    expect(wrapper.text()).toContain('${config.schema.title || 'DDD Component'}');
  });

  test('emits events correctly', async () => {
    const wrapper = mount(${formatName(config.schema.title || 'DDDComponent', 'PascalCase')}, {
      props: {
        data: mockData
      }
    });

    // Add event testing logic
  });
});`;
        }

        function generateRestAPICode(config) {
            return `// REST API 接口定义
import express from 'express';
import { Request, Response } from 'express';

const router = express.Router();

// 数据类型定义
interface ${formatName(config.schema.title || 'DDD', 'PascalCase')}Data {
  id: string;
  name: string;
  description?: string;
  createdAt: Date;
  updatedAt: Date;
}

// GET - 获取列表
router.get('/api/${formatName(config.schema.title || 'ddd', 'kebab-case')}', async (req: Request, res: Response) => {
  try {
    // 实现获取列表逻辑
    const data: ${formatName(config.schema.title || 'DDD', 'PascalCase')}Data[] = [];
    
    res.json({
      code: 200,
      message: 'success',
      data: {
        items: data,
        total: data.length
      }
    });
  } catch (error) {
    res.status(500).json({
      code: 500,
      message: 'Internal server error',
      data: null
    });
  }
});

// POST - 创建新记录
router.post('/api/${formatName(config.schema.title || 'ddd', 'kebab-case')}', async (req: Request, res: Response) => {
  try {
    const newData = req.body as any; // Avoiding TypeScript generics in HTML
    
    // 实现创建逻辑
    const createdData: ${formatName(config.schema.title || 'DDD', 'PascalCase')}Data = {
      id: Date.now().toString(),
      ...newData,
      createdAt: new Date(),
      updatedAt: new Date()
    } as ${formatName(config.schema.title || 'DDD', 'PascalCase')}Data;
    
    res.json({
      code: 200,
      message: 'Created successfully',
      data: createdData
    });
  } catch (error) {
    res.status(500).json({
      code: 500,
      message: 'Failed to create',
      data: null
    });
  }
});

// PUT - 更新记录
router.put('/api/${formatName(config.schema.title || 'ddd', 'kebab-case')}/:id', async (req: Request, res: Response) => {
  try {
    const { id } = req.params;
    const updateData = req.body as any; // Avoiding TypeScript generics in HTML
    
    // 实现更新逻辑
    const updatedData: ${formatName(config.schema.title || 'DDD', 'PascalCase')}Data = {
      id,
      ...updateData,
      updatedAt: new Date()
    } as ${formatName(config.schema.title || 'DDD', 'PascalCase')}Data;
    
    res.json({
      code: 200,
      message: 'Updated successfully',
      data: updatedData
    });
  } catch (error) {
    res.status(500).json({
      code: 500,
      message: 'Failed to update',
      data: null
    });
  }
});

// DELETE - 删除记录
router.delete('/api/${formatName(config.schema.title || 'ddd', 'kebab-case')}/:id', async (req: Request, res: Response) => {
  try {
    const { id } = req.params;
    
    // 实现删除逻辑
    
    res.json({
      code: 200,
      message: 'Deleted successfully',
      data: null
    });
  } catch (error) {
    res.status(500).json({
      code: 500,
      message: 'Failed to delete',
      data: null
    });
  }
});

export default router;`;
        }

        function generateModelCode(config) {
            return `// 数据模型定义
export interface ${formatName(config.schema.title || 'DDD', 'PascalCase')}Model {
  id: string;
  name: string;
  description?: string;
  status: 'active' | 'inactive';
  metadata?: Record<string, any>;
  createdAt: Date;
  updatedAt: Date;
  createdBy: string;
  updatedBy: string;
}

// 创建数据传输对象
export interface Create${formatName(config.schema.title || 'DDD', 'PascalCase')}DTO {
  name: string;
  description?: string;
  metadata?: Record<string, any>;
}

// 更新数据传输对象
export interface Update${formatName(config.schema.title || 'DDD', 'PascalCase')}DTO {
  name?: string;
  description?: string;
  status?: 'active' | 'inactive';
  metadata?: Record<string, any>;
}

// 查询参数对象
export interface ${formatName(config.schema.title || 'DDD', 'PascalCase')}QueryParams {
  page?: number;
  pageSize?: number;
  name?: string;
  status?: 'active' | 'inactive';
  sortBy?: keyof ${formatName(config.schema.title || 'DDD', 'PascalCase')}Model;
  sortOrder?: 'asc' | 'desc';
}

// 响应数据对象
export interface ${formatName(config.schema.title || 'DDD', 'PascalCase')}Response {
  code: number;
  message: string;
  data: ${formatName(config.schema.title || 'DDD', 'PascalCase')}Model | null;
}

export interface ${formatName(config.schema.title || 'DDD', 'PascalCase')}ListResponse {
  code: number;
  message: string;
  data: {
    items: ${formatName(config.schema.title || 'DDD', 'PascalCase')}Model[];
    total: number;
    page: number;
    pageSize: number;
  };
}`;
        }

        function generateMockData(schema) {
            const mockData = {
                id: '1',
                name: 'Mock Data',
                title: schema.title || 'Mock Title',
                description: 'This is mock data for testing',
                status: 'active',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            // 根据schema添加更多字段
            if (schema.body && Array.isArray(schema.body)) {
                schema.body.forEach(component => {
                    if (component.name) {
                        mockData[component.name] = 'Mock Value';
                    }
                });
            }
            
            return mockData;
        }

        // 连接后端功能
        async function connectBackend() {
            try {
                showLoading('连接后端中...');
                
                // 测试后端连接
                const response = await fetch('/amis/health');
                const result = await response.json();
                
                if (result.code === 200) {
                    hideLoading();
                    showStatus('后端连接成功！', 'success');
                    
                    // 启用后端数据加载
                    await loadBackendData();
                } else {
                    throw new Error('后端响应异常');
                }
            } catch (error) {
                console.error('连接后端失败:', error);
                hideLoading();
                showStatus('后端连接失败，使用模拟数据', 'error');
            }
        }

        // 加载后端数据
        async function loadBackendData() {
            try {
                // 加载项目数据
                const projectsResponse = await fetch('/amis/api/projects');
                const projectsData = await projectsResponse.json();
                
                if (projectsData.code === 200) {
                    console.log('项目数据加载成功:', projectsData.data);
                    
                    // 更新Schema以显示真实数据
                    currentSchema = {
                        type: 'page',
                        title: 'DDD平台 - 项目管理',
                        body: [
                            {
                                type: 'crud',
                                api: '/amis/api/projects',
                                syncLocation: false,
                                title: '项目列表',
                                columns: [
                                    { name: 'id', label: 'ID', type: 'text', width: 60 },
                                    { name: 'name', label: '项目名称', type: 'text' },
                                    { name: 'description', label: '描述', type: 'text' },
                                    { name: 'status', label: '状态', type: 'mapping', map: {
                                        'active': '<span class="label label-success">活跃</span>',
                                        'development': '<span class="label label-warning">开发中</span>',
                                        'testing': '<span class="label label-info">测试中</span>'
                                    }},
                                    { name: 'domainCount', label: '领域数', type: 'text', width: 80 },
                                    { name: 'aggregateCount', label: '聚合数', type: 'text', width: 80 },
                                    { name: 'entityCount', label: '实体数', type: 'text', width: 80 },
                                    { name: 'createdAt', label: '创建时间', type: 'datetime' }
                                ],
                                headerToolbar: [
                                    {
                                        type: 'button',
                                        label: '新建项目',
                                        level: 'primary',
                                        actionType: 'dialog',
                                        dialog: {
                                            title: '新建项目',
                                            size: 'lg',
                                            body: {
                                                type: 'form',
                                                api: 'post:/amis/api/projects',
                                                body: [
                                                    {
                                                        type: 'input-text',
                                                        name: 'name',
                                                        label: '项目名称',
                                                        required: true,
                                                        placeholder: '请输入项目名称'
                                                    },
                                                    {
                                                        type: 'textarea',
                                                        name: 'description',
                                                        label: '项目描述',
                                                        placeholder: '请输入项目描述',
                                                        rows: 3
                                                    }
                                                ]
                                            }
                                        }
                                    }
                                ],
                                itemActions: [
                                    {
                                        type: 'button',
                                        icon: 'fa fa-eye',
                                        tooltip: '查看详情',
                                        actionType: 'dialog',
                                        dialog: {
                                            title: '项目详情',
                                            body: {
                                                type: 'service',
                                                api: '/amis/api/projects/${id}',
                                                body: [
                                                    {
                                                        type: 'property',
                                                        title: '基本信息',
                                                        items: [
                                                            { label: '项目名称', content: '${name}' },
                                                            { label: '项目描述', content: '${description}' },
                                                            { label: '状态', content: '${status}' },
                                                            { label: '领域数量', content: '${domainCount}' },
                                                            { label: '聚合数量', content: '${aggregateCount}' },
                                                            { label: '实体数量', content: '${entityCount}' },
                                                            { label: '创建时间', content: '${createdAt}' }
                                                        ]
                                                    }
                                                ]
                                            }
                                        }
                                    },
                                    {
                                        type: 'button',
                                        icon: 'fa fa-edit',
                                        tooltip: '编辑',
                                        actionType: 'dialog',
                                        dialog: {
                                            title: '编辑项目',
                                            body: {
                                                type: 'form',
                                                api: 'put:/amis/api/projects/${id}',
                                                initApi: '/amis/api/projects/${id}',
                                                body: [
                                                    {
                                                        type: 'input-text',
                                                        name: 'name',
                                                        label: '项目名称',
                                                        required: true
                                                    },
                                                    {
                                                        type: 'textarea',
                                                        name: 'description',
                                                        label: '项目描述',
                                                        rows: 3
                                                    },
                                                    {
                                                        type: 'select',
                                                        name: 'status',
                                                        label: '状态',
                                                        options: [
                                                            { label: '活跃', value: 'active' },
                                                            { label: '开发中', value: 'development' },
                                                            { label: '测试中', value: 'testing' }
                                                        ]
                                                    }
                                                ]
                                            }
                                        }
                                    },
                                    {
                                        type: 'button',
                                        icon: 'fa fa-trash',
                                        tooltip: '删除',
                                        level: 'danger',
                                        confirmText: '确定要删除这个项目吗？',
                                        actionType: 'ajax',
                                        api: 'delete:/amis/api/projects/${id}'
                                    }
                                ]
                            }
                        ]
                    };
                    
                    renderContent();
                    showStatus('后端数据加载完成', 'success');
                }
            } catch (error) {
                console.error('加载后端数据失败:', error);
                showStatus('加载后端数据失败', 'error');
            }
        }

        // 重新排序组件
        function reorderComponents(fromIndex, toIndex) {
            if (!currentSchema.body || fromIndex === toIndex) return;
            
            const component = currentSchema.body.splice(fromIndex, 1)[0];
            currentSchema.body.splice(toIndex, 0, component);
            
            renderContent();
            showStatus('组件顺序已调整', 'info');
        }

        // 渲染内容
        function renderContent() {
            const content = document.getElementById('content');
            content.innerHTML = '';
            
            console.log('renderContent - currentSchema:', currentSchema);
            console.log('renderContent - schema类型:', typeof currentSchema);
            
            // 如果currentSchema本身就是一个完整的页面组件
            if (currentSchema.type === 'page') {
                console.log('渲染页面组件');
                const element = renderComponent(currentSchema);
                if (element) {
                    content.appendChild(element);
                }
            }
            // 如果有body数组
            else if (currentSchema.body && Array.isArray(currentSchema.body)) {
                console.log('渲染body数组，长度:', currentSchema.body.length);
                currentSchema.body.forEach((item, index) => {
                    console.log(`渲染第${index}个组件:`, item);
                    const element = renderComponent(item);
                    if (element) {
                        // 添加实时预览功能
                        makeComponentEditable(element, item, index);
                        content.appendChild(element);
                    }
                });
            }
            // 如果currentSchema是一个数组
            else if (Array.isArray(currentSchema)) {
                console.log('渲染schema数组，长度:', currentSchema.length);
                currentSchema.forEach((item, index) => {
                    console.log(`渲染第${index}个组件:`, item);
                    const element = renderComponent(item);
                    if (element) {
                        content.appendChild(element);
                    }
                });
            }
            // 如果是单个组件
            else if (currentSchema.type) {
                console.log('渲染单个组件:', currentSchema.type);
                const element = renderComponent(currentSchema);
                if (element) {
                    content.appendChild(element);
                }
            }
            // 空白页面
            else {
                console.log('显示空白页面');
                content.innerHTML = `
                    <div class="page-content">
                        <div style="text-align: center; padding: 60px 20px; color: #666;">
                            <h2>页面为空</h2>
                            <p>点击左侧组件库添加内容</p>
                        </div>
                    </div>
                `;
            }
            
            updateSchemaEditor();
            
            // 启用组件重新排序功能
            setTimeout(() => {
                enableComponentReordering();
            }, 100);
        }

        // 渲染组件
        function renderComponent(component) {
            console.log('renderComponent - 输入组件:', component);
            console.log('renderComponent - 组件类型:', component ? component.type : '组件为空');
            
            // 检查组件是否有效
            if (!component) {
                console.error('renderComponent - 组件为空或undefined');
                return null;
            }
            
            // 如果组件没有type字段，尝试推断
            if (!component.type && component.body) {
                console.log('renderComponent - 组件没有type字段，但有body，推断为container');
                component.type = 'container';
            }
            
            const div = document.createElement('div');
            
            switch (component.type) {
                case 'page':
                    // 页面类型，渲染其body内容
                    if (component.title) {
                        const title = document.createElement('h1');
                        title.textContent = component.title;
                        title.style.cssText = 'margin-bottom: 20px; color: #333; font-size: 24px;';
                        div.appendChild(title);
                    }
                    if (component.body && Array.isArray(component.body)) {
                        component.body.forEach(item => {
                            const child = renderComponent(item);
                            if (child) div.appendChild(child);
                        });
                    }
                    break;
                    
                case 'alert':
                    div.className = `alert ${component.level || 'info'}`;
                    div.textContent = component.body || '';
                    break;
                    
                case 'card':
                    div.className = 'card';
                    if (component.header && component.header.title) {
                        const header = document.createElement('h3');
                        header.textContent = component.header.title;
                        header.style.marginBottom = '16px';
                        div.appendChild(header);
                    }
                    if (component.body) {
                        const body = document.createElement('div');
                        if (typeof component.body === 'string') {
                            body.textContent = component.body;
                        } else if (Array.isArray(component.body)) {
                            component.body.forEach(item => {
                                const child = renderComponent(item);
                                if (child) body.appendChild(child);
                            });
                        } else if (typeof component.body === 'object') {
                            const child = renderComponent(component.body);
                            if (child) body.appendChild(child);
                        }
                        div.appendChild(body);
                    }
                    break;
                    
                case 'grid':
                    div.className = 'grid';
                    if (component.columns && Array.isArray(component.columns)) {
                        component.columns.forEach(col => {
                            if (col.body) {
                                // 处理col.body可能是数组的情况
                                if (Array.isArray(col.body)) {
                                    // 如果col.body是数组，遍历渲染每个子组件
                                    col.body.forEach(item => {
                                        const childElement = renderComponent(item);
                                        if (childElement) div.appendChild(childElement);
                                    });
                                } else {
                                    // 如果col.body是单个对象，直接渲染
                                    const colElement = renderComponent(col.body);
                                    if (colElement) div.appendChild(colElement);
                                }
                            }
                        });
                    }
                    break;
                    
                case 'flex':
                    div.style.cssText = 'display: flex; gap: 16px; align-items: center; flex-wrap: wrap;';
                    if (component.items && Array.isArray(component.items)) {
                        component.items.forEach(item => {
                            const child = renderComponent(item);
                            if (child) div.appendChild(child);
                        });
                    }
                    break;
                    
                case 'container':
                    div.className = 'page-content';
                    if (component.style) {
                        const styleStr = Object.entries(component.style)
                            .map(([k, v]) => `${k.replace(/([A-Z])/g, '-$1').toLowerCase()}: ${v}`)
                            .join('; ');
                        div.style.cssText += styleStr;
                    }
                    if (component.body && Array.isArray(component.body)) {
                        component.body.forEach(item => {
                            const child = renderComponent(item);
                            if (child) div.appendChild(child);
                        });
                    }
                    break;
                    
                case 'stat-card':
                    div.className = 'card stat-card';
                    div.innerHTML = `
                        <div class="stat-number" style="color: ${component.color || '#1890ff'};">
                            ${component.number || '0'}
                        </div>
                        <div class="stat-label">${component.label || '统计项'}</div>
                    `;
                    break;
                    
                case 'tpl':
                    // 处理AMIS模板语法，简化渲染
                    let tplContent = component.tpl || '';
                    
                    // 生成模拟数据来替换模板变量
                    const mockData = {
                        total: Math.floor(Math.random() * 1000) + 100,
                        growth: (Math.random() * 20 - 10).toFixed(1),
                        name: '示例项目',
                        description: '这是一个示例描述',
                        status: 'ACTIVE',
                        createdAt: '2025-01-01',
                        version: 'v1.0.0',
                        environment: 'development',
                        startTime: '2025-01-01 08:00:00',
                        memoryUsage: '256MB',
                        cpuUsage: '15%',
                        icon: '🎯',
                        title: '示例标题',
                        time: '刚刚'
                    };
                    
                    // 替换常见的模板变量
                    tplContent = tplContent.replace(/\$\{([^}]+)\}/g, (match, expression) => {
                        try {
                            // 简单处理一些常见表达式
                            if (expression.includes('total || 0')) return mockData.total;
                            if (expression.includes('growth')) {
                                if (expression.includes('>=')) {
                                    return mockData.growth >= 0 ? 
                                        (expression.includes('text-green-500') ? 'text-green-500' : '↗') : 
                                        (expression.includes('text-red-500') ? 'text-red-500' : '↘');
                                }
                                return mockData.growth;
                            }
                            if (expression.includes('Math.abs(growth)')) return Math.abs(mockData.growth);
                            
                            // 直接属性访问
                            const prop = expression.trim();
                            if (mockData[prop] !== undefined) return mockData[prop];
                            
                            return expression; // 如果找不到，返回原表达式
                        } catch (e) {
                            return expression;
                        }
                    });
                    
                    div.innerHTML = tplContent;
                    break;
                    
                case 'divider':
                    div.innerHTML = '<hr style="margin: 20px 0; border: none; border-top: 1px solid #e8e8e8;">';
                    break;
                    
                case 'panel':
                    div.className = 'card panel-card';
                    if (component.title) {
                        const header = document.createElement('h3');
                        header.textContent = component.title;
                        header.style.cssText = 'margin-bottom: 16px; color: #333; border-bottom: 2px solid #1890ff; padding-bottom: 8px;';
                        div.appendChild(header);
                    }
                    if (component.body) {
                        if (Array.isArray(component.body)) {
                            component.body.forEach(item => {
                                const child = renderComponent(item);
                                if (child) div.appendChild(child);
                            });
                        } else {
                            const child = renderComponent(component.body);
                            if (child) div.appendChild(child);
                        }
                    }
                    break;
                    
                case 'service':
                    // Service组件在简易编辑器中直接渲染其body内容，不显示API占位符
                    if (component.body && Array.isArray(component.body)) {
                        component.body.forEach(item => {
                            const child = renderComponent(item);
                            if (child) div.appendChild(child);
                        });
                    } else {
                        // 如果没有body，显示简单的占位
                        div.innerHTML = `
                            <div style="padding: 8px; background: #f0f9ff; border-radius: 4px; color: #1890ff; font-size: 12px;">
                                📡 ${component.api || '数据加载中...'}
                            </div>
                        `;
                    }
                    break;
                    
                case 'action':
                    div.className = 'action-button';
                    const button = document.createElement('button');
                    button.className = `btn ${component.level || 'primary'} ${component.size || ''}`;
                    button.innerHTML = `${component.icon ? `<i class="${component.icon}"></i> ` : ''}${component.label || '按钮'}`;
                    button.style.cssText = 'width: 100%; margin: 4px 0;';
                    div.appendChild(button);
                    break;
                    
                case 'property':
                    div.className = 'property-list';
                    if (component.items && Array.isArray(component.items)) {
                        component.items.forEach(item => {
                            const propDiv = document.createElement('div');
                            propDiv.style.cssText = 'display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0;';
                            propDiv.innerHTML = `
                                <span style="font-weight: 500; color: #333;">${item.label || '属性'}:</span>
                                <span style="color: #666;">${item.content || '值'}</span>
                            `;
                            div.appendChild(propDiv);
                        });
                    }
                    break;
                    
                case 'list':
                    div.className = 'list-container';
                    if (component.source && Array.isArray(component.source)) {
                        component.source.forEach(item => {
                            if (component.listItem && component.listItem.body) {
                                const listItemDiv = document.createElement('div');
                                listItemDiv.style.cssText = 'padding: 12px; margin: 8px 0; background: #fafafa; border-radius: 6px; border-left: 3px solid #1890ff;';
                                
                                // 简单的模板渲染
                                let content = JSON.stringify(item);
                                if (item.title) content = `<strong>${item.title}</strong><br>${item.description || ''}`;
                                if (item.name) content = `<strong>${item.name}</strong><br>${item.description || ''}`;
                                
                                listItemDiv.innerHTML = content;
                                div.appendChild(listItemDiv);
                            }
                        });
                    } else {
                        div.innerHTML = `
                            <div style="padding: 16px; background: #f0f9ff; border-radius: 6px; color: #1890ff;">
                                📋 列表组件 (数据加载中...)
                            </div>
                        `;
                    }
                    break;
                    
                case 'status':
                    div.className = 'status-badge';
                    const status = component.source || 'default';
                    const statusMap = component.map || {};
                    const statusInfo = statusMap[status] || { status: 'default', text: status };
                    
                    div.innerHTML = `
                        <span class="badge badge-${statusInfo.status}" style="padding: 4px 8px; border-radius: 12px; font-size: 12px;">
                            ${statusInfo.text}
                        </span>
                    `;
                    break;
                    
                case 'chart':
                    div.className = 'card chart-card';
                    const chartType = component.config?.type || 'unknown';
                    div.innerHTML = `
                        <h3 style="margin-bottom: 16px;">📊 ${chartType.toUpperCase()} 图表</h3>
                        <div style="height: 300px; background: linear-gradient(45deg, #f0f9ff, #e0f2fe); 
                                    border-radius: 8px; display: flex; align-items: center; 
                                    justify-content: center; color: #0369a1; font-size: 16px; text-align: center;">
                            图表数据可视化区域<br>
                            <small style="opacity: 0.7;">类型: ${chartType}<br>（简易编辑器暂不支持图表渲染）</small>
                        </div>
                    `;
                    break;
                    
                case 'form':
                    div.className = 'card form-card';
                    div.style.cssText = 'background: white; border: 1px solid #e8e8e8; border-radius: 8px; padding: 20px; margin: 10px 0;';
                    
                    if (component.title) {
                        const title = document.createElement('h3');
                        title.textContent = component.title;
                        title.style.cssText = 'margin-bottom: 16px; color: #333;';
                        div.appendChild(title);
                    }
                    
                    const formElement = document.createElement('form');
                    formElement.style.cssText = 'display: flex; flex-direction: column; gap: 16px;';
                    
                    if (component.body && Array.isArray(component.body)) {
                        component.body.forEach(field => {
                            const fieldElement = renderComponent(field);
                            if (fieldElement) formElement.appendChild(fieldElement);
                        });
                    } else {
                        // 示例表单字段
                        const demoFields = [
                            { type: 'input-text', label: '姓名', name: 'name', required: true },
                            { type: 'input-email', label: '邮箱', name: 'email' },
                            { type: 'select', label: '部门', name: 'dept', options: [
                                { label: '技术部', value: 'tech' },
                                { label: '产品部', value: 'product' },
                                { label: '运营部', value: 'ops' }
                            ]},
                            { type: 'textarea', label: '备注', name: 'note', rows: 3 }
                        ];
                        demoFields.forEach(field => {
                            const fieldElement = renderComponent(field);
                            if (fieldElement) formElement.appendChild(fieldElement);
                        });
                    }
                    
                    const submitBtn = document.createElement('button');
                    submitBtn.textContent = '提交';
                    submitBtn.style.cssText = 'padding: 8px 16px; background: #1890ff; color: white; border: none; border-radius: 4px; cursor: pointer; align-self: flex-start;';
                    formElement.appendChild(submitBtn);
                    
                    div.appendChild(formElement);
                    break;
                    
                case 'input-text':
                case 'input-email':
                case 'input-password':
                    div.className = 'form-field';
                    if (component.label) {
                        const label = document.createElement('label');
                        label.textContent = component.label + (component.required ? ' *' : '');
                        label.style.cssText = 'display: block; margin-bottom: 4px; font-weight: 500; color: #333;';
                        div.appendChild(label);
                    }
                    
                    const input = document.createElement('input');
                    input.type = component.type === 'input-email' ? 'email' : component.type === 'input-password' ? 'password' : 'text';
                    input.placeholder = component.placeholder || '';
                    input.value = component.value || '';
                    input.style.cssText = 'width: 100%; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 4px; font-size: 14px;';
                    if (component.required) input.required = true;
                    if (component.name) input.name = component.name;
                    div.appendChild(input);
                    break;
                    
                case 'textarea':
                    div.className = 'form-field';
                    if (component.label) {
                        const label = document.createElement('label');
                        label.textContent = component.label + (component.required ? ' *' : '');
                        label.style.cssText = 'display: block; margin-bottom: 4px; font-weight: 500; color: #333;';
                        div.appendChild(label);
                    }
                    
                    const textarea = document.createElement('textarea');
                    textarea.placeholder = component.placeholder || '';
                    textarea.value = component.value || '';
                    textarea.rows = component.rows || 4;
                    textarea.style.cssText = 'width: 100%; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 4px; font-size: 14px; resize: vertical;';
                    if (component.required) textarea.required = true;
                    if (component.name) textarea.name = component.name;
                    div.appendChild(textarea);
                    break;
                    
                case 'select':
                    div.className = 'form-field';
                    if (component.label) {
                        const label = document.createElement('label');
                        label.textContent = component.label + (component.required ? ' *' : '');
                        label.style.cssText = 'display: block; margin-bottom: 4px; font-weight: 500; color: #333;';
                        div.appendChild(label);
                    }
                    
                    const select = document.createElement('select');
                    select.style.cssText = 'width: 100%; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 4px; font-size: 14px; background: white;';
                    if (component.required) select.required = true;
                    if (component.name) select.name = component.name;
                    
                    if (component.placeholder) {
                        const placeholderOption = document.createElement('option');
                        placeholderOption.value = '';
                        placeholderOption.textContent = component.placeholder;
                        placeholderOption.disabled = true;
                        placeholderOption.selected = true;
                        select.appendChild(placeholderOption);
                    }
                    
                    if (component.options && Array.isArray(component.options)) {
                        component.options.forEach(option => {
                            const optionElement = document.createElement('option');
                            optionElement.value = option.value || option;
                            optionElement.textContent = option.label || option;
                            if (component.value && (option.value === component.value || option === component.value)) {
                                optionElement.selected = true;
                            }
                            select.appendChild(optionElement);
                        });
                    }
                    div.appendChild(select);
                    break;
                    
                case 'table':
                    div.className = 'card table-card';
                    div.style.cssText = 'background: white; border: 1px solid #e8e8e8; border-radius: 8px; padding: 20px; margin: 10px 0; overflow-x: auto;';
                    
                    if (component.title) {
                        const title = document.createElement('h3');
                        title.textContent = component.title;
                        title.style.cssText = 'margin-bottom: 16px; color: #333;';
                        div.appendChild(title);
                    }
                    
                    const table = document.createElement('table');
                    table.style.cssText = 'width: 100%; border-collapse: collapse; border: 1px solid #e8e8e8;';
                    
                    // 表头
                    if (component.columns && Array.isArray(component.columns)) {
                        const thead = document.createElement('thead');
                        const headerRow = document.createElement('tr');
                        headerRow.style.cssText = 'background: #fafafa;';
                        
                        component.columns.forEach(col => {
                            const th = document.createElement('th');
                            th.textContent = col.label || col.name || '';
                            th.style.cssText = 'padding: 12px; text-align: left; border: 1px solid #e8e8e8; font-weight: 500;';
                            headerRow.appendChild(th);
                        });
                        thead.appendChild(headerRow);
                        table.appendChild(thead);
                        
                        // 表体（示例数据）
                        const tbody = document.createElement('tbody');
                        const sampleData = component.data || [];
                        const rowsToShow = sampleData.length > 0 ? sampleData : [
                            { id: 1, name: '用户 1', email: 'user1@example.com', status: '激活' },
                            { id: 2, name: '用户 2', email: 'user2@example.com', status: '禁用' },
                            { id: 3, name: '用户 3', email: 'user3@example.com', status: '激活' }
                        ];
                        
                        rowsToShow.slice(0, 5).forEach((rowData, index) => {
                            const row = document.createElement('tr');
                            component.columns.forEach(col => {
                                const td = document.createElement('td');
                                const fieldName = col.name || col.key;
                                td.textContent = rowData[fieldName] || `示例数据 ${index + 1}`;
                                td.style.cssText = 'padding: 12px; border: 1px solid #e8e8e8;';
                                row.appendChild(td);
                            });
                            tbody.appendChild(row);
                        });
                        table.appendChild(tbody);
                    }
                    
                    div.appendChild(table);
                    break;
                    
                case 'crud':
                    div.className = 'card crud-card';
                    div.style.cssText = 'background: white; border: 1px solid #e8e8e8; border-radius: 8px; padding: 20px; margin: 10px 0;';
                    
                    const crudTitle = document.createElement('div');
                    crudTitle.style.cssText = 'display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;';
                    
                    const title = document.createElement('h3');
                    title.textContent = component.title || 'CRUD 数据管理';
                    title.style.cssText = 'margin: 0; color: #333; flex: 1;';
                    
                    const toolbar = document.createElement('div');
                    toolbar.style.cssText = 'display: flex; gap: 8px;';
                    
                    const addBtn = document.createElement('button');
                    addBtn.textContent = '+ 新增';
                    addBtn.style.cssText = 'padding: 6px 12px; background: #52c41a; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;';
                    
                    const refreshBtn = document.createElement('button');
                    refreshBtn.textContent = '🔄 刷新';
                    refreshBtn.style.cssText = 'padding: 6px 12px; background: #1890ff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;';
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.textContent = '🗑️ 删除';
                    deleteBtn.style.cssText = 'padding: 6px 12px; background: #ff4d4f; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;';
                    
                    toolbar.appendChild(addBtn);
                    toolbar.appendChild(refreshBtn);
                    toolbar.appendChild(deleteBtn);
                    crudTitle.appendChild(title);
                    crudTitle.appendChild(toolbar);
                    div.appendChild(crudTitle);
                    
                    // 渲染搜索栏
                    const searchBar = document.createElement('div');
                    searchBar.style.cssText = 'margin-bottom: 16px; display: flex; gap: 8px;';
                    
                    const searchInput = document.createElement('input');
                    searchInput.type = 'text';
                    searchInput.placeholder = '请输入搜索关键词...';
                    searchInput.style.cssText = 'flex: 1; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 4px;';
                    
                    const searchBtn = document.createElement('button');
                    searchBtn.textContent = '搜索';
                    searchBtn.style.cssText = 'padding: 8px 16px; background: #1890ff; color: white; border: none; border-radius: 4px; cursor: pointer;';
                    
                    searchBar.appendChild(searchInput);
                    searchBar.appendChild(searchBtn);
                    div.appendChild(searchBar);
                    
                    // 重用table组件渲染数据表格
                    const tableComponent = { 
                        ...component, 
                        type: 'table',
                        columns: component.columns || [
                            { name: 'id', label: 'ID' },
                            { name: 'name', label: '名称' },
                            { name: 'status', label: '状态' },
                            { name: 'createdAt', label: '创建时间' },
                            { name: 'action', label: '操作' }
                        ]
                    };
                    const tableElement = renderComponent(tableComponent);
                    if (tableElement) div.appendChild(tableElement);
                    break;
                    
                default:
                    div.innerHTML = `
                        <div style="padding: 10px; background: #f0f0f0; border-radius: 4px; color: #666; margin: 8px 0;">
                            <strong>组件类型:</strong> ${component.type}<br>
                            <small>简易编辑器暂不支持此组件类型</small>
                        </div>
                    `;
                    console.log('不支持的组件类型:', component.type, component);
            }
            
            return div;
        }

        // 添加提示框
        function addAlert() {
            const alert = {
                type: 'alert',
                level: 'info',
                body: '这是一个信息提示框'
            };
            currentSchema.body.push(alert);
            renderContent();
            showStatus('提示框已添加', 'success');
        }

        // 添加卡片
        function addCard() {
            const card = {
                type: 'card',
                header: { title: '新卡片' },
                body: '这是一个新的卡片内容'
            };
            currentSchema.body.push(card);
            renderContent();
            showStatus('卡片已添加', 'success');
        }

        // 添加统计卡片
        function addStatCard() {
            const statCard = {
                type: 'stat-card',
                number: Math.floor(Math.random() * 1000),
                label: '随机数据',
                color: ['#1890ff', '#52c41a', '#fa8c16', '#722ed1'][Math.floor(Math.random() * 4)]
            };
            currentSchema.body.push(statCard);
            renderContent();
            showStatus('统计卡片已添加', 'success');
        }

        // 添加网格布局
        function addGrid() {
            const grid = {
                type: 'grid',
                columns: [
                    {
                        body: {
                            type: 'stat-card',
                            number: '24',
                            label: '项目数',
                            color: '#1890ff'
                        }
                    },
                    {
                        body: {
                            type: 'stat-card',
                            number: '156',
                            label: '模型数',
                            color: '#52c41a'
                        }
                    },
                    {
                        body: {
                            type: 'stat-card',
                            number: '89',
                            label: '聚合根',
                            color: '#fa8c16'
                        }
                    }
                ]
            };
            currentSchema.body.push(grid);
            renderContent();
            showStatus('网格布局已添加', 'success');
        }

        // 添加表单
        function addForm() {
            const form = {
                type: 'form',
                title: '用户信息表单',
                body: [
                    { type: 'input-text', label: '姓名', name: 'name', required: true },
                    { type: 'input-email', label: '邮箱', name: 'email', required: true },
                    { type: 'select', label: '部门', name: 'department', options: [
                        { label: '技术部', value: 'tech' },
                        { label: '产品部', value: 'product' },
                        { label: '运营部', value: 'ops' }
                    ]},
                    { type: 'textarea', label: '个人简介', name: 'bio', rows: 4 }
                ]
            };
            currentSchema.body.push(form);
            renderContent();
            showStatus('表单已添加', 'success');
        }

        // 添加文本输入
        function addInputText() {
            const input = {
                type: 'input-text',
                label: '文本输入',
                name: 'textInput',
                placeholder: '请输入文本...'
            };
            currentSchema.body.push(input);
            renderContent();
            showStatus('文本输入已添加', 'success');
        }

        // 添加多行文本
        function addTextarea() {
            const textarea = {
                type: 'textarea',
                label: '多行文本',
                name: 'textareaInput',
                placeholder: '请输入多行文本...',
                rows: 4
            };
            currentSchema.body.push(textarea);
            renderContent();
            showStatus('多行文本已添加', 'success');
        }

        // 添加下拉选择
        function addSelect() {
            const select = {
                type: 'select',
                label: '下拉选择',
                name: 'selectInput',
                placeholder: '请选择选项...',
                options: [
                    { label: '选项一', value: 'option1' },
                    { label: '选项二', value: 'option2' },
                    { label: '选项三', value: 'option3' }
                ]
            };
            currentSchema.body.push(select);
            renderContent();
            showStatus('下拉选择已添加', 'success');
        }

        // 添加数据表格
        function addTable() {
            const table = {
                type: 'table',
                title: '数据表格',
                columns: [
                    { name: 'id', label: 'ID' },
                    { name: 'name', label: '姓名' },
                    { name: 'email', label: '邮箱' },
                    { name: 'status', label: '状态' },
                    { name: 'createdAt', label: '创建时间' }
                ],
                data: [
                    { id: 1, name: '张三', email: 'zhang@example.com', status: '激活', createdAt: '2025-01-01' },
                    { id: 2, name: '李四', email: 'li@example.com', status: '禁用', createdAt: '2025-01-02' },
                    { id: 3, name: '王五', email: 'wang@example.com', status: '激活', createdAt: '2025-01-03' }
                ]
            };
            currentSchema.body.push(table);
            renderContent();
            showStatus('数据表格已添加', 'success');
        }

        // 添加CRUD管理
        function addCrud() {
            const crud = {
                type: 'crud',
                title: '用户管理',
                columns: [
                    { name: 'id', label: 'ID' },
                    { name: 'name', label: '用户名' },
                    { name: 'email', label: '邮箱' },
                    { name: 'role', label: '角色' },
                    { name: 'status', label: '状态' },
                    { name: 'createdAt', label: '创建时间' },
                    { name: 'action', label: '操作' }
                ]
            };
            currentSchema.body.push(crud);
            renderContent();
            showStatus('CRUD管理已添加', 'success');
        }

        // ========== 新增组件函数 ==========
        
        // 表单组件
        function addDatePicker() {
            const datePicker = {
                type: 'input-date',
                name: 'date',
                label: '选择日期',
                format: 'YYYY-MM-DD',
                placeholder: '请选择日期'
            };
            currentSchema.body.push(datePicker);
            renderContent();
            showStatus('日期选择器已添加', 'success');
        }

        function addUpload() {
            const upload = {
                type: 'input-file',
                name: 'file',
                label: '文件上传',
                accept: '.jpg,.png,.pdf,.doc,.docx',
                multiple: true,
                maxSize: 10485760,
                placeholder: '点击或拖拽文件到此处上传'
            };
            currentSchema.body.push(upload);
            renderContent();
            showStatus('文件上传组件已添加', 'success');
        }

        function addRichText() {
            const richText = {
                type: 'input-rich-text',
                name: 'content',
                label: '富文本内容',
                placeholder: '请输入富文本内容...',
                options: {
                    height: 300,
                    toolbar: 'bold italic underline strikethrough | alignleft aligncenter alignright | bullist numlist | link image'
                }
            };
            currentSchema.body.push(richText);
            renderContent();
            showStatus('富文本编辑器已添加', 'success');
        }

        function addCascader() {
            const cascader = {
                type: 'input-cascader',
                name: 'cascader',
                label: '级联选择',
                options: [
                    {
                        label: '浙江省',
                        value: 'zhejiang',
                        children: [
                            { label: '杭州市', value: 'hangzhou' },
                            { label: '宁波市', value: 'ningbo' }
                        ]
                    },
                    {
                        label: '江苏省',
                        value: 'jiangsu',
                        children: [
                            { label: '南京市', value: 'nanjing' },
                            { label: '苏州市', value: 'suzhou' }
                        ]
                    }
                ]
            };
            currentSchema.body.push(cascader);
            renderContent();
            showStatus('级联选择器已添加', 'success');
        }

        function addNumberInput() {
            const numberInput = {
                type: 'input-number',
                name: 'number',
                label: '数字输入',
                min: 0,
                max: 100,
                step: 1,
                placeholder: '请输入数字'
            };
            currentSchema.body.push(numberInput);
            renderContent();
            showStatus('数字输入框已添加', 'success');
        }

        function addSwitch() {
            const switchComp = {
                type: 'switch',
                name: 'enabled',
                label: '启用状态',
                option: '开启'
            };
            currentSchema.body.push(switchComp);
            renderContent();
            showStatus('开关组件已添加', 'success');
        }

        function addCheckbox() {
            const checkbox = {
                type: 'checkboxes',
                name: 'hobby',
                label: '兴趣爱好',
                options: [
                    { label: '读书', value: 'reading' },
                    { label: '音乐', value: 'music' },
                    { label: '运动', value: 'sports' },
                    { label: '旅游', value: 'travel' }
                ]
            };
            currentSchema.body.push(checkbox);
            renderContent();
            showStatus('复选框已添加', 'success');
        }

        function addRadio() {
            const radio = {
                type: 'radios',
                name: 'gender',
                label: '性别',
                options: [
                    { label: '男', value: 'male' },
                    { label: '女', value: 'female' },
                    { label: '其他', value: 'other' }
                ]
            };
            currentSchema.body.push(radio);
            renderContent();
            showStatus('单选框已添加', 'success');
        }

        // 数据展示组件
        function addTree() {
            const tree = {
                type: 'tree-select',
                name: 'tree',
                label: '组织架构',
                options: [
                    {
                        label: '总部',
                        value: 'headquarters',
                        children: [
                            {
                                label: '技术部',
                                value: 'tech',
                                children: [
                                    { label: '前端组', value: 'frontend' },
                                    { label: '后端组', value: 'backend' }
                                ]
                            },
                            { label: '产品部', value: 'product' }
                        ]
                    }
                ]
            };
            currentSchema.body.push(tree);
            renderContent();
            showStatus('树形结构已添加', 'success');
        }

        function addTimeline() {
            const timeline = {
                type: 'steps',
                name: 'timeline',
                label: '项目时间线',
                value: 1,
                steps: [
                    {
                        title: '项目启动',
                        description: 'DDD平台项目正式启动 (2024-01-01)'
                    },
                    {
                        title: '需求分析',
                        description: '完成需求分析和技术选型 (2024-02-15)'
                    },
                    {
                        title: '开发完成',
                        description: '核心功能开发完成 (2024-03-30)'
                    }
                ]
            };
            currentSchema.body.push(timeline);
            renderContent();
            showStatus('时间轴已添加', 'success');
        }

        function addList() {
            const list = {
                type: 'list',
                source: '$items',
                listItem: {
                    title: '$title',
                    subTitle: '$subTitle',
                    desc: '$desc',
                    avatar: '$avatar'
                }
            };
            currentSchema.body.push(list);
            renderContent();
            showStatus('列表组件已添加', 'success');
        }

        function addPagination() {
            const pagination = {
                type: 'pagination',
                total: 100,
                perPage: 10,
                showSizeChanger: true,
                showQuickJumper: true
            };
            currentSchema.body.push(pagination);
            renderContent();
            showStatus('分页器已添加', 'success');
        }

        // 展示组件
        function addTag() {
            const tag = {
                type: 'tag',
                label: '标签文本',
                color: 'primary',
                closable: true
            };
            currentSchema.body.push(tag);
            renderContent();
            showStatus('标签已添加', 'success');
        }

        function addProgress() {
            const progress = {
                type: 'progress',
                value: 75,
                showLabel: true,
                stripe: true,
                animate: true
            };
            currentSchema.body.push(progress);
            renderContent();
            showStatus('进度条已添加', 'success');
        }

        function addImage() {
            const image = {
                type: 'image',
                src: 'https://via.placeholder.com/300x200/4f46e5/ffffff?text=DDD+Platform',
                alt: 'DDD平台示例图片',
                title: '示例图片',
                imageMode: 'thumb'
            };
            currentSchema.body.push(image);
            renderContent();
            showStatus('图片组件已添加', 'success');
        }

        function addDivider() {
            const divider = {
                type: 'divider',
                title: '分割线'
            };
            currentSchema.body.push(divider);
            renderContent();
            showStatus('分割线已添加', 'success');
        }

        function addStatus() {
            const status = {
                type: 'status',
                value: 1,
                map: {
                    0: '离线',
                    1: '在线',
                    2: '忙碌'
                }
            };
            currentSchema.body.push(status);
            renderContent();
            showStatus('状态标识已添加', 'success');
        }

        // 交互组件
        function addButton() {
            const button = {
                type: 'button',
                label: '按钮',
                level: 'primary',
                actionType: 'dialog',
                dialog: {
                    title: '提示',
                    body: '这是一个示例按钮'
                }
            };
            currentSchema.body.push(button);
            renderContent();
            showStatus('按钮已添加', 'success');
        }

        function addButtonGroup() {
            const buttonGroup = {
                type: 'button-group',
                buttons: [
                    { type: 'button', label: '新建', level: 'primary' },
                    { type: 'button', label: '编辑', level: 'info' },
                    { type: 'button', label: '删除', level: 'danger' }
                ]
            };
            currentSchema.body.push(buttonGroup);
            renderContent();
            showStatus('按钮组已添加', 'success');
        }

        function addDropdownButton() {
            const dropdownButton = {
                type: 'dropdown-button',
                label: '下拉按钮',
                level: 'primary',
                buttons: [
                    { type: 'button', label: '选项1' },
                    { type: 'button', label: '选项2' },
                    { type: 'button', label: '选项3' }
                ]
            };
            currentSchema.body.push(dropdownButton);
            renderContent();
            showStatus('下拉按钮已添加', 'success');
        }

        function addTabs() {
            const tabs = {
                type: 'tabs',
                tabs: [
                    {
                        title: '基本信息',
                        body: {
                            type: 'tpl',
                            tpl: '<p>基本信息内容</p>'
                        }
                    },
                    {
                        title: '详细配置',
                        body: {
                            type: 'tpl',
                            tpl: '<p>详细配置内容</p>'
                        }
                    },
                    {
                        title: '权限设置',
                        body: {
                            type: 'tpl',
                            tpl: '<p>权限设置内容</p>'
                        }
                    }
                ]
            };
            currentSchema.body.push(tabs);
            renderContent();
            showStatus('标签页已添加', 'success');
        }

        function addCollapse() {
            const collapse = {
                type: 'collapse',
                accordion: false,
                body: [
                    {
                        title: '面板1',
                        body: '这是面板1的内容'
                    },
                    {
                        title: '面板2',
                        body: '这是面板2的内容'
                    },
                    {
                        title: '面板3',
                        body: '这是面板3的内容'
                    }
                ]
            };
            currentSchema.body.push(collapse);
            renderContent();
            showStatus('折叠面板已添加', 'success');
        }

        // ========== 完整CRUD示例 ==========
        
        // 完整用户管理CRUD示例
        function loadUserManagementDemo() {
            currentSchema = {
                type: 'page',
                title: '用户管理系统 - 完整CRUD示例',
                body: [
                    {
                        type: 'alert',
                        level: 'info',
                        body: '这是一个完整的用户管理CRUD应用示例，连接到后端API http://localhost:8100/api/users'
                    },
                    {
                        type: 'crud',
                        api: 'http://localhost:8100/api/users',
                        syncLocation: false,
                        title: '用户列表',
                        headerToolbar: [
                            'bulkActions',
                            {
                                type: 'button',
                                label: '新增用户',
                                actionType: 'dialog',
                                icon: 'fa fa-plus',
                                primary: true,
                                dialog: {
                                    title: '新增用户',
                                    body: {
                                        type: 'form',
                                        api: 'post:http://localhost:8100/api/users',
                                        body: [
                                            {
                                                type: 'input-text',
                                                name: 'name',
                                                label: '用户名',
                                                required: true,
                                                placeholder: '请输入用户名'
                                            },
                                            {
                                                type: 'input-email',
                                                name: 'email',
                                                label: '邮箱',
                                                required: true,
                                                placeholder: '请输入邮箱地址'
                                            },
                                            {
                                                type: 'input-text',
                                                name: 'phone',
                                                label: '手机号',
                                                placeholder: '请输入手机号'
                                            },
                                            {
                                                type: 'select',
                                                name: 'role',
                                                label: '角色',
                                                value: 'user',
                                                options: [
                                                    { label: '管理员', value: 'admin' },
                                                    { label: '用户', value: 'user' },
                                                    { label: '访客', value: 'guest' }
                                                ]
                                            },
                                            {
                                                type: 'select',
                                                name: 'status',
                                                label: '状态',
                                                value: 'active',
                                                options: [
                                                    { label: '启用', value: 'active' },
                                                    { label: '禁用', value: 'inactive' }
                                                ]
                                            }
                                        ]
                                    }
                                }
                            },
                            'reload'
                        ],
                        footerToolbar: ['statistics', 'pagination'],
                        columns: [
                            {
                                name: 'id',
                                label: 'ID',
                                width: 60,
                                type: 'text'
                            },
                            {
                                name: 'avatar',
                                label: '头像',
                                type: 'image',
                                width: 60,
                                height: 40
                            },
                            {
                                name: 'name',
                                label: '用户名',
                                searchable: true,
                                type: 'text'
                            },
                            {
                                name: 'email',
                                label: '邮箱',
                                searchable: true,
                                type: 'text'
                            },
                            {
                                name: 'role',
                                label: '角色',
                                type: 'mapping',
                                map: {
                                    'admin': '<span class="label label-info">管理员</span>',
                                    'user': '<span class="label label-success">用户</span>',
                                    'guest': '<span class="label label-default">访客</span>'
                                }
                            },
                            {
                                name: 'status',
                                label: '状态',
                                type: 'mapping',
                                map: {
                                    'active': '<span class="label label-success">启用</span>',
                                    'inactive': '<span class="label label-danger">禁用</span>'
                                }
                            },
                            {
                                name: 'createdAt',
                                label: '创建时间',
                                type: 'datetime',
                                format: 'YYYY-MM-DD HH:mm:ss',
                                sortable: true
                            },
                            {
                                type: 'operation',
                                label: '操作',
                                width: 150,
                                buttons: [
                                    {
                                        type: 'button',
                                        label: '详情',
                                        actionType: 'dialog',
                                        level: 'info',
                                        dialog: {
                                            title: '用户详情',
                                            body: {
                                                type: 'form',
                                                body: [
                                                    {
                                                        type: 'static',
                                                        name: 'name',
                                                        label: '用户名'
                                                    },
                                                    {
                                                        type: 'static',
                                                        name: 'email',
                                                        label: '邮箱'
                                                    },
                                                    {
                                                        type: 'static',
                                                        name: 'role',
                                                        label: '角色'
                                                    },
                                                    {
                                                        type: 'static',
                                                        name: 'createdAt',
                                                        label: '创建时间'
                                                    }
                                                ]
                                            }
                                        }
                                    },
                                    {
                                        type: 'button',
                                        label: '编辑',
                                        actionType: 'dialog',
                                        level: 'primary',
                                        dialog: {
                                            title: '编辑用户',
                                            body: {
                                                type: 'form',
                                                api: 'put:http://localhost:8100/api/users/${id}',
                                                body: [
                                                    {
                                                        type: 'input-text',
                                                        name: 'name',
                                                        label: '用户名',
                                                        required: true
                                                    },
                                                    {
                                                        type: 'input-email',
                                                        name: 'email',
                                                        label: '邮箱',
                                                        required: true
                                                    },
                                                    {
                                                        type: 'select',
                                                        name: 'role',
                                                        label: '角色',
                                                        options: [
                                                            { label: '管理员', value: 'admin' },
                                                            { label: '用户', value: 'user' },
                                                            { label: '访客', value: 'guest' }
                                                        ]
                                                    },
                                                    {
                                                        type: 'select',
                                                        name: 'status',
                                                        label: '状态',
                                                        options: [
                                                            { label: '启用', value: 'active' },
                                                            { label: '禁用', value: 'inactive' }
                                                        ]
                                                    }
                                                ]
                                            }
                                        }
                                    },
                                    {
                                        type: 'button',
                                        label: '删除',
                                        actionType: 'ajax',
                                        level: 'danger',
                                        confirmText: '确定要删除该用户吗？',
                                        api: 'delete:http://localhost:8100/api/users/${id}'
                                    }
                                ]
                            }
                        ]
                    }
                ]
            };
            renderContent();
            showStatus('用户管理系统已加载 - 连接后端API', 'success');
        }

        function loadProjectManagementDemo() {
            showStatus('项目管理系统开发中...', 'info');
        }

        function loadOrderManagementDemo() {
            showStatus('订单管理系统开发中...', 'info');
        }

        // ========== DDD屏幕类型生成器 ==========
        
        // 生成列表屏幕
        function generateListScreen() {
            currentSchema = {
                type: 'page',
                title: '用户列表',
                body: [
                    {
                        type: 'crud',
                        title: '用户管理',
                        api: '/api/users',
                        filter: {
                            title: '搜索筛选',
                            body: [
                                {
                                    type: 'input-text',
                                    name: 'keyword',
                                    label: '关键词',
                                    placeholder: '搜索用户名、邮箱'
                                },
                                {
                                    type: 'select',
                                    name: 'status',
                                    label: '状态',
                                    options: [
                                        { label: '全部', value: '' },
                                        { label: '启用', value: 'active' },
                                        { label: '禁用', value: 'inactive' }
                                    ]
                                },
                                {
                                    type: 'input-date-range',
                                    name: 'dateRange',
                                    label: '创建时间'
                                }
                            ]
                        },
                        headerToolbar: [
                            {
                                type: 'button',
                                label: '新建用户',
                                level: 'primary',
                                icon: 'fa fa-plus',
                                actionType: 'drawer',
                                drawer: {
                                    title: '新建用户',
                                    body: {
                                        type: 'form',
                                        api: 'POST:/api/users',
                                        body: [
                                            { type: 'input-text', name: 'name', label: '用户名', required: true },
                                            { type: 'input-email', name: 'email', label: '邮箱', required: true },
                                            { type: 'input-password', name: 'password', label: '密码', required: true },
                                            { type: 'select', name: 'role', label: '角色', options: [
                                                { label: '管理员', value: 'admin' },
                                                { label: '普通用户', value: 'user' }
                                            ]}
                                        ]
                                    }
                                }
                            },
                            {
                                type: 'button',
                                label: '批量删除',
                                level: 'danger',
                                icon: 'fa fa-trash'
                            },
                            'reload'
                        ],
                        columns: [
                            { name: 'id', label: 'ID', sortable: true, width: 80 },
                            { name: 'avatar', label: '头像', type: 'avatar', width: 60 },
                            { name: 'name', label: '用户名', sortable: true },
                            { name: 'email', label: '邮箱', sortable: true },
                            { name: 'role', label: '角色', type: 'mapping', map: {
                                'admin': '<span class="label label-success">管理员</span>',
                                'user': '<span class="label label-info">普通用户</span>'
                            }},
                            { name: 'status', label: '状态', type: 'status', map: {
                                'active': 'success',
                                'inactive': 'danger'
                            }},
                            { name: 'createdAt', label: '创建时间', type: 'datetime', sortable: true },
                            {
                                name: 'operation',
                                label: '操作',
                                type: 'operation',
                                buttons: [
                                    {
                                        type: 'button',
                                        label: '查看',
                                        level: 'info',
                                        size: 'xs',
                                        actionType: 'drawer',
                                        drawer: {
                                            title: '用户详情',
                                            body: {
                                                type: 'service',
                                                api: '/api/users/${id}',
                                                body: [
                                                    {
                                                        type: 'form',
                                                        mode: 'horizontal',
                                                        static: true,
                                                        body: [
                                                            { type: 'static', name: 'name', label: '用户名' },
                                                            { type: 'static', name: 'email', label: '邮箱' },
                                                            { type: 'static', name: 'role', label: '角色' },
                                                            { type: 'static', name: 'status', label: '状态' },
                                                            { type: 'static', name: 'createdAt', label: '创建时间' }
                                                        ]
                                                    }
                                                ]
                                            }
                                        }
                                    },
                                    {
                                        type: 'button',
                                        label: '编辑',
                                        level: 'primary',
                                        size: 'xs',
                                        actionType: 'drawer',
                                        drawer: {
                                            title: '编辑用户',
                                            body: {
                                                type: 'form',
                                                api: 'PUT:/api/users/${id}',
                                                initApi: '/api/users/${id}',
                                                body: [
                                                    { type: 'input-text', name: 'name', label: '用户名', required: true },
                                                    { type: 'input-email', name: 'email', label: '邮箱', required: true },
                                                    { type: 'select', name: 'role', label: '角色', options: [
                                                        { label: '管理员', value: 'admin' },
                                                        { label: '普通用户', value: 'user' }
                                                    ]},
                                                    { type: 'switch', name: 'status', label: '启用状态' }
                                                ]
                                            }
                                        }
                                    },
                                    {
                                        type: 'button',
                                        label: '删除',
                                        level: 'danger',
                                        size: 'xs',
                                        actionType: 'ajax',
                                        api: 'DELETE:/api/users/${id}',
                                        confirmText: '确定要删除该用户吗？'
                                    }
                                ]
                            }
                        ]
                    }
                ]
            };
            renderContent();
            showStatus('列表屏幕已生成', 'success');
        }

        // 生成详情屏幕
        function generateDetailScreen() {
            currentSchema = {
                type: 'page',
                title: '用户详情',
                body: [
                    {
                        type: 'service',
                        api: '/api/users/1',
                        body: [
                            {
                                type: 'panel',
                                title: '基本信息',
                                body: {
                                    type: 'form',
                                    mode: 'horizontal',
                                    static: true,
                                    body: [
                                        { name: 'avatar', label: '头像', type: 'static-image' },
                                        { name: 'name', label: '用户名', type: 'static' },
                                        { name: 'email', label: '邮箱', type: 'static' },
                                        { name: 'phone', label: '手机号', type: 'static' },
                                        { name: 'role', label: '角色', type: 'static' },
                                        { name: 'status', label: '状态', type: 'static' },
                                        { name: 'createdAt', label: '创建时间', type: 'static' },
                                        { name: 'lastLoginAt', label: '最后登录', type: 'static' }
                                    ]
                                }
                            },
                            {
                                type: 'tabs',
                                tabs: [
                                    {
                                        title: '权限信息',
                                        body: {
                                            type: 'service',
                                            api: '/api/users/1/permissions',
                                            body: [
                                                {
                                                    type: 'table',
                                                    source: '${permissions}',
                                                    columns: [
                                                        { name: 'module', label: '模块' },
                                                        { name: 'permission', label: '权限' },
                                                        { name: 'granted', label: '是否授权', type: 'status' }
                                                    ]
                                                }
                                            ]
                                        }
                                    },
                                    {
                                        title: '操作日志',
                                        body: {
                                            type: 'service',
                                            api: '/api/users/1/logs',
                                            body: [
                                                {
                                                    type: 'timeline',
                                                    source: '${logs}',
                                                    itemTitleTpl: '${action}',
                                                    itemDetailTpl: '${description}<br/><small>${createdAt}</small>'
                                                }
                                            ]
                                        }
                                    }
                                ]
                            }
                        ]
                    }
                ],
                aside: {
                    type: 'wrapper',
                    size: 'xs',
                    body: [
                        {
                            type: 'button',
                            label: '编辑用户',
                            level: 'primary',
                            block: true,
                            actionType: 'url',
                            url: '/user/edit/1'
                        },
                        {
                            type: 'button',
                            label: '删除用户',
                            level: 'danger',
                            block: true,
                            actionType: 'ajax',
                            api: 'DELETE:/api/users/1',
                            confirmText: '确定要删除该用户吗？'
                        },
                        {
                            type: 'button',
                            label: '返回列表',
                            block: true,
                            actionType: 'url',
                            url: '/user/list'
                        }
                    ]
                }
            };
            renderContent();
            showStatus('详情屏幕已生成', 'success');
        }

        // 生成编辑屏幕
        function generateEditScreen() {
            currentSchema = {
                type: 'page',
                title: '编辑用户',
                body: [
                    {
                        type: 'form',
                        title: '用户信息',
                        api: 'PUT:/api/users/1',
                        initApi: '/api/users/1',
                        redirect: '/user/list',
                        body: [
                            {
                                type: 'tabs',
                                tabs: [
                                    {
                                        title: '基本信息',
                                        body: [
                                            {
                                                type: 'grid',
                                                columns: [
                                                    {
                                                        body: [
                                                            {
                                                                type: 'input-text',
                                                                name: 'name',
                                                                label: '用户名',
                                                                required: true,
                                                                validations: {
                                                                    minLength: 2,
                                                                    maxLength: 20
                                                                }
                                                            },
                                                            {
                                                                type: 'input-email',
                                                                name: 'email',
                                                                label: '邮箱',
                                                                required: true,
                                                                validations: 'isEmail'
                                                            },
                                                            {
                                                                type: 'input-text',
                                                                name: 'phone',
                                                                label: '手机号',
                                                                validations: 'isPhoneNumber'
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        body: [
                                                            {
                                                                type: 'input-file',
                                                                name: 'avatar',
                                                                label: '头像',
                                                                accept: '.jpg,.jpeg,.png',
                                                                receiver: '/api/upload/avatar',
                                                                autoUpload: true
                                                            },
                                                            {
                                                                type: 'select',
                                                                name: 'role',
                                                                label: '角色',
                                                                required: true,
                                                                options: [
                                                                    { label: '管理员', value: 'admin' },
                                                                    { label: '普通用户', value: 'user' },
                                                                    { label: '访客', value: 'guest' }
                                                                ]
                                                            },
                                                            {
                                                                type: 'switch',
                                                                name: 'status',
                                                                label: '启用状态',
                                                                option: '启用'
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        title: '扩展信息',
                                        body: [
                                            {
                                                type: 'input-date',
                                                name: 'birthday',
                                                label: '生日',
                                                format: 'YYYY-MM-DD'
                                            },
                                            {
                                                type: 'radios',
                                                name: 'gender',
                                                label: '性别',
                                                options: [
                                                    { label: '男', value: 'male' },
                                                    { label: '女', value: 'female' },
                                                    { label: '其他', value: 'other' }
                                                ]
                                            },
                                            {
                                                type: 'textarea',
                                                name: 'bio',
                                                label: '个人简介',
                                                rows: 4,
                                                maxLength: 500
                                            },
                                            {
                                                type: 'checkboxes',
                                                name: 'interests',
                                                label: '兴趣爱好',
                                                options: [
                                                    { label: '编程', value: 'programming' },
                                                    { label: '阅读', value: 'reading' },
                                                    { label: '运动', value: 'sports' },
                                                    { label: '音乐', value: 'music' },
                                                    { label: '旅游', value: 'travel' }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        actions: [
                            {
                                type: 'button',
                                label: '保存',
                                level: 'primary',
                                actionType: 'submit'
                            },
                            {
                                type: 'button',
                                label: '保存并继续',
                                level: 'info',
                                actionType: 'submit',
                                reload: 'window'
                            },
                            {
                                type: 'button',
                                label: '取消',
                                actionType: 'cancel'
                            }
                        ]
                    }
                ]
            };
            renderContent();
            showStatus('编辑屏幕已生成', 'success');
        }

        // 生成仪表板屏幕
        function generateDashboardScreen() {
            currentSchema = {
                type: 'page',
                title: '用户管理仪表板',
                body: [
                    {
                        type: 'alert',
                        level: 'info',
                        body: '📊 用户管理数据统计概览'
                    },
                    {
                        type: 'grid',
                        columns: [
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '1,234',
                                    label: '👥 总用户数',
                                    color: '#1890ff'
                                }
                            },
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '987',
                                    label: '✅ 活跃用户',
                                    color: '#52c41a'
                                }
                            },
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '123',
                                    label: '🔴 今日新增',
                                    color: '#fa8c16'
                                }
                            },
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '45',
                                    label: '👤 在线用户',
                                    color: '#722ed1'
                                }
                            }
                        ]
                    },
                    {
                        type: 'divider'
                    },
                    {
                        type: 'grid',
                        columns: [
                            {
                                body: {
                                    type: 'chart',
                                    title: '用户注册趋势',
                                    api: '/api/charts/user-registration-trend',
                                    config: {
                                        type: 'line',
                                        xField: 'date',
                                        yField: 'count',
                                        color: '#1890ff'
                                    }
                                }
                            },
                            {
                                body: {
                                    type: 'chart',
                                    title: '角色分布',
                                    api: '/api/charts/role-distribution',
                                    config: {
                                        type: 'pie',
                                        angleField: 'value',
                                        colorField: 'type'
                                    }
                                }
                            }
                        ]
                    },
                    {
                        type: 'divider'
                    },
                    {
                        type: 'panel',
                        title: '快速操作',
                        body: [
                            {
                                type: 'button-group',
                                buttons: [
                                    {
                                        type: 'button',
                                        label: '新建用户',
                                        level: 'primary',
                                        icon: 'fa fa-plus',
                                        actionType: 'url',
                                        url: '/user/create'
                                    },
                                    {
                                        type: 'button',
                                        label: '用户列表',
                                        level: 'info',
                                        icon: 'fa fa-list',
                                        actionType: 'url',
                                        url: '/user/list'
                                    },
                                    {
                                        type: 'button',
                                        label: '导出数据',
                                        level: 'success',
                                        icon: 'fa fa-download',
                                        actionType: 'ajax',
                                        api: '/api/users/export'
                                    },
                                    {
                                        type: 'button',
                                        label: '数据分析',
                                        level: 'warning',
                                        icon: 'fa fa-chart-bar',
                                        actionType: 'url',
                                        url: '/analytics/users'
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        type: 'panel',
                        title: '最近活动',
                        body: {
                            type: 'service',
                            api: '/api/users/recent-activities',
                            body: [
                                {
                                    type: 'list',
                                    source: '${activities}',
                                    listItem: {
                                        title: '${user.name} ${action}',
                                        subTitle: '${createdAt}',
                                        desc: '${description}',
                                        avatar: '${user.avatar}'
                                    }
                                }
                            ]
                        }
                    }
                ]
            };
            renderContent();
            showStatus('仪表板屏幕已生成', 'success');
        }

        // 生成工作流屏幕
        function generateWorkflowScreen() {
            currentSchema = {
                type: 'page',
                title: '用户审批工作流',
                body: [
                    {
                        type: 'service',
                        api: '/api/workflow/user-approval/1',
                        body: [
                            {
                                type: 'panel',
                                title: '申请信息',
                                body: {
                                    type: 'form',
                                    mode: 'horizontal',
                                    static: true,
                                    body: [
                                        { name: 'applicant', label: '申请人', type: 'static' },
                                        { name: 'requestType', label: '申请类型', type: 'static' },
                                        { name: 'reason', label: '申请理由', type: 'static' },
                                        { name: 'createdAt', label: '申请时间', type: 'static' }
                                    ]
                                }
                            },
                            {
                                type: 'steps',
                                source: '${steps}',
                                status: 'process',
                                labelPlacement: 'vertical'
                            },
                            {
                                type: 'panel',
                                title: '当前处理任务',
                                body: [
                                    {
                                        type: 'form',
                                        title: '审批意见',
                                        api: 'POST:/api/workflow/user-approval/1/process',
                                        body: [
                                            {
                                                type: 'radios',
                                                name: 'action',
                                                label: '审批操作',
                                                required: true,
                                                options: [
                                                    { label: '✅ 同意', value: 'approve' },
                                                    { label: '❌ 拒绝', value: 'reject' },
                                                    { label: '🔄 驳回修改', value: 'return' }
                                                ]
                                            },
                                            {
                                                type: 'textarea',
                                                name: 'comment',
                                                label: '处理意见',
                                                rows: 3,
                                                placeholder: '请填写处理意见...'
                                            },
                                            {
                                                type: 'input-file',
                                                name: 'attachments',
                                                label: '附件',
                                                multiple: true,
                                                accept: '.pdf,.doc,.docx,.jpg,.png'
                                            }
                                        ],
                                        actions: [
                                            {
                                                type: 'button',
                                                label: '提交处理',
                                                level: 'primary',
                                                actionType: 'submit'
                                            },
                                            {
                                                type: 'button',
                                                label: '保存草稿',
                                                level: 'info',
                                                actionType: 'ajax',
                                                api: 'POST:/api/workflow/user-approval/1/draft'
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                type: 'panel',
                                title: '处理历史',
                                body: {
                                    type: 'timeline',
                                    source: '${history}',
                                    itemTitleTpl: '${processor} - ${action}',
                                    itemDetailTpl: '${comment}<br/><small style="color: #999;">${processedAt}</small>'
                                }
                            }
                        ]
                    }
                ]
            };
            renderContent();
            showStatus('工作流屏幕已生成', 'success');
        }

        // 加载仪表板模板
        function loadDashboard() {
            currentSchema = {
                type: 'page',
                title: 'DDD数据仪表板',
                body: [
                    {
                        type: 'alert',
                        level: 'info',
                        body: '🎯 欢迎使用DDD平台数据仪表板'
                    },
                    {
                        type: 'grid',
                        columns: [
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '24',
                                    label: '📁 活跃项目',
                                    color: '#1890ff'
                                }
                            },
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '156',
                                    label: '🏗️ 领域模型',
                                    color: '#52c41a'
                                }
                            },
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '89',
                                    label: '⚡ 聚合根',
                                    color: '#fa8c16'
                                }
                            },
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '234',
                                    label: '💎 值对象',
                                    color: '#722ed1'
                                }
                            }
                        ]
                    },
                    {
                        type: 'card',
                        header: { title: '📈 项目活跃度趋势' },
                        body: '这里是图表区域（占位符）'
                    }
                ]
            };
            renderContent();
            showStatus('仪表板模板已加载！', 'success');
        }

        // 加载表单模板
        function loadForm() {
            currentSchema = {
                type: 'page',
                title: '📝 DDD实体配置表单',
                body: [
                    {
                        type: 'alert',
                        level: 'info',
                        body: '🎯 请填写领域实体的基本信息'
                    },
                    {
                        type: 'form',
                        title: '实体基本信息',
                        body: [
                            { type: 'input-text', label: '实体名称', name: 'entityName', required: true, placeholder: '例如：User' },
                            { type: 'input-text', label: '实体描述', name: 'description', placeholder: '实体的业务含义描述' },
                            { type: 'select', label: '所属域', name: 'domain', options: [
                                { label: '用户域', value: 'user' },
                                { label: '订单域', value: 'order' },
                                { label: '产品域', value: 'product' },
                                { label: '支付域', value: 'payment' }
                            ]},
                            { type: 'select', label: '实体类型', name: 'entityType', options: [
                                { label: '聚合根', value: 'aggregate' },
                                { label: '实体', value: 'entity' },
                                { label: '值对象', value: 'valueObject' }
                            ]},
                            { type: 'textarea', label: '业务规则', name: 'businessRules', rows: 4, placeholder: '描述该实体的核心业务规则...' }
                        ]
                    },
                    {
                        type: 'form',
                        title: '属性配置',
                        body: [
                            { type: 'input-text', label: '属性名称', name: 'propertyName', placeholder: '例如：name' },
                            { type: 'select', label: '属性类型', name: 'propertyType', options: [
                                { label: 'String', value: 'string' },
                                { label: 'Integer', value: 'integer' },
                                { label: 'Long', value: 'long' },
                                { label: 'Boolean', value: 'boolean' },
                                { label: 'Date', value: 'date' },
                                { label: 'BigDecimal', value: 'decimal' }
                            ]},
                            { type: 'textarea', label: '属性描述', name: 'propertyDesc', rows: 2 }
                        ]
                    }
                ]
            };
            renderContent();
            showStatus('DDD表单模板已加载！', 'success');
        }

        // 加载CRUD模板
        function loadCrudTemplate() {
            currentSchema = {
                type: 'page',
                title: '🔧 DDD实体CRUD管理',
                body: [
                    {
                        type: 'alert',
                        level: 'success',
                        body: '🎯 领域实体数据管理界面'
                    },
                    {
                        type: 'grid',
                        columns: [
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '23',
                                    label: '📊 总实体数',
                                    color: '#1890ff'
                                }
                            },
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '156',
                                    label: '🔄 活跃记录',
                                    color: '#52c41a'
                                }
                            },
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '5',
                                    label: '⏸️ 待审核',
                                    color: '#faad14'
                                }
                            }
                        ]
                    },
                    {
                        type: 'crud',
                        title: '用户实体管理',
                        columns: [
                            { name: 'id', label: 'ID' },
                            { name: 'name', label: '用户名' },
                            { name: 'email', label: '邮箱' },
                            { name: 'domain', label: '所属域' },
                            { name: 'entityType', label: '实体类型' },
                            { name: 'status', label: '状态' },
                            { name: 'createdAt', label: '创建时间' },
                            { name: 'action', label: '操作' }
                        ]
                    }
                ]
            };
            renderContent();
            showStatus('DDD CRUD模板已加载！', 'success');
        }

        // 加载DDD模板
        async function loadTemplate(templateName) {
            try {
                const response = await fetch(`./templates/${templateName}.json`);
                if (response.ok) {
                    const template = await response.json();
                    currentSchema = template;
                    
                    // 替换模板变量为示例数据
                    const mockValues = {
                        projectCount: '24',
                        domainCount: '8',
                        aggregateCount: '23',
                        entityCount: '156',
                        valueObjectCount: '89',
                        domainServiceCount: '12',
                        modelScore: '85',
                        complexityLevel: '中',
                        couplingScore: '低',
                        cohesionScore: '高',
                        startTime: '2025-01-01 08:00:00',
                        memoryUsage: '256MB',
                        onlineUsers: '15',
                        analysisTime: '2025-01-01 14:30:00',
                        modelVersion: 'v1.2.0',
                        totalIssues: '8',
                        criticalIssues: '2'
                    };
                    
                    // 递归替换模板变量
                    function replaceTemplateVars(obj) {
                        if (typeof obj === 'string') {
                            return obj.replace(/\$\{([^}]+)\}/g, (match, key) => mockValues[key] || match);
                        } else if (Array.isArray(obj)) {
                            return obj.map(replaceTemplateVars);
                        } else if (obj && typeof obj === 'object') {
                            const result = {};
                            for (const [key, value] of Object.entries(obj)) {
                                result[key] = replaceTemplateVars(value);
                            }
                            return result;
                        }
                        return obj;
                    }
                    
                    currentSchema = replaceTemplateVars(currentSchema);
                    
                    // 更新schema编辑器
                    const schemaEditor = document.getElementById('schema-editor');
                    if (schemaEditor) {
                        schemaEditor.value = JSON.stringify(currentSchema, null, 2);
                    }
                    
                    renderContent();
                    showStatus(`${template.title} 模板已加载！`, 'success');
                } else {
                    showStatus(`模板 ${templateName} 加载失败`, 'error');
                }
            } catch (error) {
                console.error('模板加载错误:', error);
                showStatus('模板加载失败: ' + error.message, 'error');
            }
        }

        // 实时预览功能增强

        // 切换属性面板
        function togglePropertyPanel() {
            const panel = document.getElementById('property-panel');
            panel.classList.toggle('active');
            showStatus('属性面板已' + (panel.classList.contains('active') ? '显示' : '隐藏'), 'info');
        }

        // 选择组件
        function selectComponent(componentElement, componentData, index) {
            // 清除之前的选择
            const previousSelected = document.querySelector('.component-editable.selected');
            if (previousSelected) {
                previousSelected.classList.remove('selected');
            }

            // 设置新的选择
            componentElement.classList.add('selected');
            selectedComponent = componentData;
            selectedComponentIndex = index;

            // 显示属性面板
            showPropertyPanel(componentData, index);
            
            // 如果属性检查器已打开，自动加载新选择组件的属性
            if (propertyInspectorVisible) {
                loadComponentProperties(componentData);
            }
            
            // 确保属性面板可见
            const panel = document.getElementById('property-panel');
            if (!panel.classList.contains('active')) {
                panel.classList.add('active');
            }
        }

        // 显示属性编辑面板
        function showPropertyPanel(component, index) {
            const propertyContent = document.getElementById('property-content');
            
            let formHTML = `
                <div class="property-form">
                    <h4>组件: ${component.type}</h4>
                    <label>组件类型:</label>
                    <input type="text" value="${component.type}" readonly style="background: #f5f5f5;">
                </div>
            `;

            // 根据组件类型添加不同的属性编辑字段
            if (component.type === 'alert') {
                const alertLevelSelect = createSelectWithOptions([
                    { value: 'info', text: '信息', selected: component.level === 'info' },
                    { value: 'success', text: '成功', selected: component.level === 'success' },
                    { value: 'warning', text: '警告', selected: component.level === 'warning' },
                    { value: 'error', text: '错误', selected: component.level === 'error' }
                ], 'prop-level');
                
                formHTML += `
                    <div class="property-form">
                        <label>消息内容:</label>
                        <input type="text" id="prop-body" value="${component.body || ''}" placeholder="输入消息内容">
                    </div>
                    <div class="property-form">
                        <label>级别:</label>
                        <div id="level-select-container"></div>
                    </div>
                `;
                
                // 在添加HTML后，插入select元素
                setTimeout(() => {
                    const container = document.getElementById('level-select-container');
                    if (container) {
                        container.appendChild(alertLevelSelect);
                    }
                }, 0);
            } else if (component.type === 'card') {
                formHTML += `
                    <div class="property-form">
                        <label>标题:</label>
                        <input type="text" id="prop-title" value="${component.header?.title || ''}" placeholder="输入卡片标题">
                    </div>
                    <div class="property-form">
                        <label>内容:</label>
                        <textarea id="prop-body" rows="3" placeholder="输入卡片内容">${component.body || ''}</textarea>
                    </div>
                `;
            } else if (component.type === 'stat-card') {
                formHTML += `
                    <div class="property-form">
                        <label>数值:</label>
                        <input type="text" id="prop-number" value="${component.number || ''}" placeholder="输入统计数值">
                    </div>
                    <div class="property-form">
                        <label>标签:</label>
                        <input type="text" id="prop-label" value="${component.label || ''}" placeholder="输入统计标签">
                    </div>
                    <div class="property-form">
                        <label>颜色:</label>
                        <input type="color" id="prop-color" value="${component.color || '#1890ff'}">
                    </div>
                `;
            } else if (component.type === 'input-text' || component.type === 'input-email' || component.type === 'input-password') {
                formHTML += `
                    <div class="property-form">
                        <label>标签:</label>
                        <input type="text" id="prop-label" value="${component.label || ''}" placeholder="输入字段标签">
                    </div>
                    <div class="property-form">
                        <label>占位符:</label>
                        <input type="text" id="prop-placeholder" value="${component.placeholder || ''}" placeholder="输入占位符文本">
                    </div>
                    <div class="property-form">
                        <label>是否必填:</label>
                        <div id="required-select-container"></div>
                    </div>
                `;
                
                // 在添加HTML后，插入required选择框
                setTimeout(() => {
                    const requiredSelect = createSelectWithOptions([
                        { value: 'false', text: '否', selected: !component.required },
                        { value: 'true', text: '是', selected: component.required }
                    ], 'prop-required');
                    
                    const container = document.getElementById('required-select-container');
                    if (container) {
                        container.appendChild(requiredSelect);
                    }
                }, 0);
            } else if (component.type === 'form') {
                formHTML += `
                    <div class="property-form">
                        <label>表单标题:</label>
                        <input type="text" id="prop-title" value="${component.title || ''}" placeholder="输入表单标题">
                    </div>
                `;
            } else if (component.type === 'table' || component.type === 'crud') {
                formHTML += `
                    <div class="property-form">
                        <label>表格标题:</label>
                        <input type="text" id="prop-title" value="${component.title || ''}" placeholder="输入表格标题">
                    </div>
                `;
            }

            formHTML += `
                <div style="margin-top: 20px;">
                    <button class="btn primary" onclick="updateComponent(${index})" style="width: 100%; margin-bottom: 8px;">✅ 更新组件</button>
                    <button class="btn" onclick="deleteComponent(${index})" style="width: 100%; background: #ff4d4f; color: white;">🗑️ 删除组件</button>
                </div>
            `;

            propertyContent.innerHTML = formHTML;
        }

        // 更新组件
        function updateComponent(index) {
            if (index === -1 || index === null || !currentSchema.body[index]) return;

            const component = currentSchema.body[index];
            
            // 根据组件类型更新属性
            if (component.type === 'alert') {
                const body = document.getElementById('prop-body')?.value;
                const level = document.getElementById('prop-level')?.value;
                if (body !== undefined) component.body = body;
                if (level) component.level = level;
            } else if (component.type === 'card') {
                const title = document.getElementById('prop-title')?.value;
                const body = document.getElementById('prop-body')?.value;
                if (title !== undefined) {
                    if (!component.header) component.header = {};
                    component.header.title = title;
                }
                if (body !== undefined) component.body = body;
            } else if (component.type === 'stat-card') {
                const number = document.getElementById('prop-number')?.value;
                const label = document.getElementById('prop-label')?.value;
                const color = document.getElementById('prop-color')?.value;
                if (number !== undefined) component.number = number;
                if (label !== undefined) component.label = label;
                if (color) component.color = color;
            } else if (['input-text', 'input-email', 'input-password'].includes(component.type)) {
                const label = document.getElementById('prop-label')?.value;
                const placeholder = document.getElementById('prop-placeholder')?.value;
                const required = document.getElementById('prop-required')?.value === 'true';
                if (label !== undefined) component.label = label;
                if (placeholder !== undefined) component.placeholder = placeholder;
                component.required = required;
            } else if (component.type === 'form' || component.type === 'table' || component.type === 'crud') {
                const title = document.getElementById('prop-title')?.value;
                if (title !== undefined) component.title = title;
            }

            // 重新渲染内容
            renderContent();
            showStatus('组件已更新', 'success');
        }

        // 删除组件
        function deleteComponent(index) {
            if (index === -1 || index === null || !currentSchema.body[index]) return;
            
            if (confirm('确定要删除这个组件吗？')) {
                currentSchema.body.splice(index, 1);
                renderContent();
                
                // 隐藏属性面板
                document.getElementById('property-content').innerHTML = '<p style="color: #666; text-align: center; margin-top: 40px;">选择一个组件来编辑其属性</p>';
                
                showStatus('组件已删除', 'success');
            }
        }

        // 清空内容
        function clearContent() {
            currentSchema.body = [];
            renderContent();
            showStatus('内容已清空', 'success');
        }

        // 应用Schema
        function applySchema() {
            try {
                const schemaText = document.getElementById('schema-editor').value;
                const newSchema = JSON.parse(schemaText);
                currentSchema = newSchema;
                renderContent();
                showStatus('Schema已应用！', 'success');
            } catch (error) {
                showStatus('Schema格式错误: ' + error.message, 'error');
            }
        }

        // 连接后端
        async function connectBackend() {
            try {
                showStatus('正在连接后端...', 'success');
                
                const response = await fetch('http://localhost:8100/amis/dashboard');
                if (response.ok) {
                    const result = await response.json();
                    showStatus('后端连接成功！', 'success');
                    console.log('后端返回数据:', result);
                    
                    // 检查后端返回的数据格式
                    console.log('完整后端响应:', JSON.stringify(result, null, 2));
                    
                    if (result.code === 200 && result.data) {
                        currentSchema = result.data;
                        console.log('使用result.data作为schema:', JSON.stringify(currentSchema, null, 2));
                        
                        // 更新schema编辑器
                        const schemaEditor = document.getElementById('schema-editor');
                        if (schemaEditor) {
                            schemaEditor.value = JSON.stringify(currentSchema, null, 2);
                        }
                        
                        renderContent();
                        showStatus('后端数据已加载！', 'success');
                    } else if (result.schema) {
                        // 兼容直接返回schema的格式
                        currentSchema = result.schema;
                        console.log('使用result.schema作为schema:', JSON.stringify(currentSchema, null, 2));
                        
                        // 更新schema编辑器
                        const schemaEditor = document.getElementById('schema-editor');
                        if (schemaEditor) {
                            schemaEditor.value = JSON.stringify(currentSchema, null, 2);
                        }
                        
                        renderContent();
                        showStatus('后端数据已加载！', 'success');
                    } else {
                        showStatus('后端返回数据格式不正确', 'error');
                        console.log('数据格式错误:', result);
                    }
                } else {
                    showStatus('后端服务未响应', 'error');
                }
            } catch (error) {
                console.error('连接失败:', error);
                showStatus('无法连接后端: ' + error.message, 'error');
            }
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>

    <!-- 状态显示 -->
    <div id="status" class="status"></div>

    <!-- 加载指示器 -->
    <div id="loading">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">正在加载...</div>
        </div>
    </div>
    <!-- 属性检查器 -->
    <div class="property-inspector" id="propertyInspector">
        <div class="inspector-header">
            <h3>🔧 组件属性检查器</h3>
            <button class="close-btn" onclick="closePropertyInspector()">×</button>
        </div>
        <div class="inspector-body">
            <div class="property-tabs">
                <div class="property-tab active" onclick="switchInspectorTab(this, 'basic')">基础</div>
                <div class="property-tab" onclick="switchInspectorTab(this, 'style')">样式</div>
                <div class="property-tab" onclick="switchInspectorTab(this, 'data')">数据</div>
                <div class="property-tab" onclick="switchInspectorTab(this, 'events')">事件</div>
            </div>
            
            <!-- 基础属性 -->
            <div class="tab-content active" id="basic-tab">
                <div class="inspector-section">
                    <h4>基础信息</h4>
                    <div class="property-item">
                        <label>组件类型</label>
                        <input type="text" id="component-type" readonly style="background: #f5f5f5;">
                    </div>
                    <div class="property-item">
                        <label>组件名称</label>
                        <input type="text" id="component-name" placeholder="输入组件名称">
                    </div>
                    <div class="property-item">
                        <label>标题</label>
                        <input type="text" id="component-title" placeholder="输入标题">
                    </div>
                    <div class="property-item">
                        <label>描述</label>
                        <textarea id="component-description" placeholder="输入描述信息"></textarea>
                    </div>
                </div>
                
                <div class="inspector-section">
                    <h4>显示控制</h4>
                    <div class="property-checkbox">
                        <input type="checkbox" id="component-visible">
                        <label for="component-visible">显示组件</label>
                    </div>
                    <div class="property-checkbox">
                        <input type="checkbox" id="component-disabled">
                        <label for="component-disabled">禁用组件</label>
                    </div>
                    <div class="property-checkbox">
                        <input type="checkbox" id="component-hidden">
                        <label for="component-hidden">隐藏组件</label>
                    </div>
                </div>
            </div>
            
            <!-- 样式属性 -->
            <div class="tab-content" id="style-tab">
                <div class="inspector-section">
                    <h4>布局样式</h4>
                    <div class="property-item">
                        <label>CSS类名</label>
                        <input type="text" id="component-class" placeholder="输入CSS类名">
                    </div>
                    <div class="property-item">
                        <label>内联样式</label>
                        <textarea id="component-style" placeholder='{"color": "red", "fontSize": "14px"}'></textarea>
                    </div>
                    <div class="property-item">
                        <label>宽度</label>
                        <input type="text" id="component-width" placeholder="auto, 100px, 50%">
                    </div>
                    <div class="property-item">
                        <label>高度</label>
                        <input type="text" id="component-height" placeholder="auto, 100px, 300px">
                    </div>
                </div>
                
                <div class="inspector-section">
                    <h4>外观设置</h4>
                    <div class="property-item">
                        <label>背景颜色</label>
                        <div class="color-picker-container">
                            <input type="color" id="component-bg-color" value="#ffffff">
                            <div class="color-preview" onclick="document.getElementById('component-bg-color').click()"></div>
                        </div>
                    </div>
                    <div class="property-item">
                        <label>文字颜色</label>
                        <div class="color-picker-container">
                            <input type="color" id="component-text-color" value="#333333">
                            <div class="color-preview" onclick="document.getElementById('component-text-color').click()"></div>
                        </div>
                    </div>
                    <div class="property-item">
                        <label>边框</label>
                        <input type="text" id="component-border" placeholder="1px solid #ddd">
                    </div>
                    <div class="property-item">
                        <label>圆角</label>
                        <input type="text" id="component-radius" placeholder="4px">
                    </div>
                </div>
            </div>
            
            <!-- 数据绑定 -->
            <div class="tab-content" id="data-tab">
                <div class="inspector-section">
                    <h4>数据源</h4>
                    <div class="property-item">
                        <label>API地址</label>
                        <input type="text" id="component-api" placeholder="/api/data">
                    </div>
                    <div class="property-item">
                        <label>数据字段</label>
                        <input type="text" id="component-source" placeholder="data.items">
                    </div>
                    <div class="property-item">
                        <label>初始数据</label>
                        <textarea id="component-data" placeholder='{"key": "value"}'></textarea>
                    </div>
                </div>
                
                <div class="inspector-section">
                    <h4>字段绑定</h4>
                    <div id="field-bindings">
                        <p style="color: #999; font-size: 13px;">点击"添加绑定"创建字段映射</p>
                    </div>
                    <div class="binding-actions">
                        <button class="mini-btn" onclick="addFieldBinding()">添加绑定</button>
                        <button class="mini-btn" onclick="clearBindings()">清空绑定</button>
                    </div>
                </div>
            </div>
            
            <!-- 事件处理 -->
            <div class="tab-content" id="events-tab">
                <div class="inspector-section">
                    <h4>交互事件</h4>
                    <div class="property-item">
                        <label>点击事件</label>
                        <textarea id="component-onclick" placeholder="console.log('clicked')"></textarea>
                    </div>
                    <div class="property-item">
                        <label>双击事件</label>
                        <textarea id="component-ondblclick" placeholder="console.log('double clicked')"></textarea>
                    </div>
                    <div class="property-item">
                        <label>悬停事件</label>
                        <textarea id="component-onhover" placeholder="console.log('hovered')"></textarea>
                    </div>
                </div>
                
                <div class="inspector-section">
                    <h4>表单事件</h4>
                    <div class="property-item">
                        <label>值变化</label>
                        <textarea id="component-onchange" placeholder="console.log('value changed:', value)"></textarea>
                    </div>
                    <div class="property-item">
                        <label>获得焦点</label>
                        <textarea id="component-onfocus" placeholder="console.log('focused')"></textarea>
                    </div>
                    <div class="property-item">
                        <label>失去焦点</label>
                        <textarea id="component-onblur" placeholder="console.log('blurred')"></textarea>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="inspector-footer" style="padding: 16px; border-top: 1px solid #e8e8e8;">
            <button class="btn" onclick="applyInspectorChanges()" style="width: 100%; margin-bottom: 8px;">应用更改</button>
            <button class="btn" onclick="resetInspectorProperties()" style="width: 100%;">重置属性</button>
        </div>
    </div>

    <!-- 代码生成器 -->
    <div class="code-generator" id="codeGenerator">
        <div class="generator-overlay">
            <div class="generator-modal">
                <div class="generator-header">
                    <h3>⚙️ 智能代码生成器</h3>
                    <button class="close-btn" onclick="closeCodeGenerator()" style="color: white;">×</button>
                </div>
                <div class="generator-body">
                    <div class="generator-sidebar">
                        <div class="generator-config">
                            <div class="config-section">
                                <h4>🎯 生成目标</h4>
                                <div class="config-item">
                                    <label>输出类型</label>
                                    <select id="output-type" onchange="updateGeneratorOptions()">
                                        <option value="react">React 组件</option>
                                        <option value="vue">Vue 组件</option>
                                        <option value="angular">Angular 组件</option>
                                        <option value="html">HTML 页面</option>
                                        <option value="api">API 接口</option>
                                        <option value="model">数据模型</option>
                                    </select>
                                </div>
                                <div class="config-item">
                                    <label>框架版本</label>
                                    <select id="framework-version">
                                        <option value="latest">最新版本</option>
                                        <option value="stable">稳定版本</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="config-section">
                                <h4>🔧 配置选项</h4>
                                <div class="config-item">
                                    <label>命名风格</label>
                                    <select id="naming-style">
                                        <option value="camelCase">驼峰命名</option>
                                        <option value="PascalCase">帕斯卡命名</option>
                                        <option value="kebab-case">短横线命名</option>
                                        <option value="snake_case">下划线命名</option>
                                    </select>
                                </div>
                                <div class="config-item">
                                    <label>TypeScript</label>
                                    <select id="typescript-enabled">
                                        <option value="true">启用</option>
                                        <option value="false">禁用</option>
                                    </select>
                                </div>
                                <div class="config-item">
                                    <label>样式方案</label>
                                    <select id="styling-solution">
                                        <option value="css-modules">CSS Modules</option>
                                        <option value="styled-components">Styled Components</option>
                                        <option value="emotion">Emotion</option>
                                        <option value="tailwind">Tailwind CSS</option>
                                        <option value="antd">Ant Design</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="config-section">
                                <h4>📦 功能特性</h4>
                                <div class="property-checkbox">
                                    <input type="checkbox" id="include-tests" checked>
                                    <label for="include-tests">包含测试文件</label>
                                </div>
                                <div class="property-checkbox">
                                    <input type="checkbox" id="include-stories" checked>
                                    <label for="include-stories">包含 Storybook</label>
                                </div>
                                <div class="property-checkbox">
                                    <input type="checkbox" id="include-docs">
                                    <label for="include-docs">生成文档</label>
                                </div>
                                <div class="property-checkbox">
                                    <input type="checkbox" id="responsive-design" checked>
                                    <label for="responsive-design">响应式设计</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="generator-main">
                        <div class="generator-tabs">
                            <div class="generator-tab active" onclick="switchGeneratorTab(this, 'component')">组件代码</div>
                            <div class="generator-tab" onclick="switchGeneratorTab(this, 'style')">样式代码</div>
                            <div class="generator-tab" onclick="switchGeneratorTab(this, 'test')">测试代码</div>
                            <div class="generator-tab" onclick="switchGeneratorTab(this, 'story')">Story代码</div>
                            <div class="generator-tab" onclick="switchGeneratorTab(this, 'api')">API代码</div>
                        </div>
                        
                        <div class="generator-content">
                            <div class="code-output">
                                <textarea class="code-editor" id="generated-code" readonly placeholder="生成的代码将显示在这里..."></textarea>
                            </div>
                            
                            <div class="generation-options">
                                <button class="generate-btn" onclick="generateCode()">🚀 生成代码</button>
                                <button class="btn" onclick="copyGeneratedCode()">📋 复制代码</button>
                                <button class="btn" onclick="downloadGeneratedCode()">💾 下载文件</button>
                                <button class="btn" onclick="previewGenerated()">👀 预览效果</button>
                                <span style="margin-left: auto; color: #666; font-size: 12px;">
                                    代码行数: <span id="code-line-count">0</span> | 
                                    文件大小: <span id="code-size">0 KB</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 模型验证面板 -->
    <div class="validation-panel" id="validationPanel">
        <div class="validation-header">
            <h3>✅ Schema 模型验证器</h3>
            <button class="close-btn" onclick="closeValidationPanel()" style="color: white;">×</button>
        </div>
        <div class="validation-body">
            <div class="validation-stats">
                <div class="stat-item">
                    <div class="stat-number" id="total-components">0</div>
                    <div class="stat-label">总组件数</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="validation-errors">0</div>
                    <div class="stat-label">错误</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="validation-warnings">0</div>
                    <div class="stat-label">警告</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="validation-score">100</div>
                    <div class="stat-label">质量评分</div>
                </div>
            </div>
            
            <div id="validation-results">
                <div class="validation-result">
                    <div class="result-title">✅ 验证完成</div>
                    <div class="result-message">点击"开始验证"按钮进行 Schema 模型验证...</div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="generate-btn" onclick="validateSchema()">🔍 开始验证</button>
                <button class="btn" onclick="exportValidationReport()">📄 导出报告</button>
                <button class="btn" onclick="autoFixIssues()">🔧 自动修复</button>
            </div>
        </div>
    </div>

</body>
</html>
